System.register(["jimu-core/emotion","jimu-core","jimu-ui","jimu-core/react-dom"],function(e,t){var i={},l={},n={},o={};return{setters:[function(e){i.Fragment=e.Fragment,i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){l.DataSourceComponent=e.DataSourceComponent,l.DataSourceManager=e.DataSourceManager,l.Immutable=e.Immutable,l.React=e.React},function(e){n.Button=e.Button},function(e){o.createPortal=e.createPortal}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=l},321:e=>{"use strict";e.exports=n},386:e=>{"use strict";e.exports=i},581:e=>{"use strict";e.exports=o}},t={};function r(i){var l=t[i];if(void 0!==l)return l.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var a={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(a),r.d(a,{__set_webpack_public_path__:()=>J,default:()=>H});var e=r(386),t=r(244),i=r(321),l=r(581);const n={roleCode:"DT",buttonText:"Prendi in carico",takeColor:"#0078da",integrazioneColor:"#e75a05",approvaColor:"#328c54",respingiColor:"#d13438",trasmettiColor:"#6f42c1",panelBg:"#ffffff",panelBorderColor:"#e5e7eb",panelBorderWidth:1,panelBorderRadius:10,panelPadding:12,maskBg:"#ffffff",maskBorderColor:"#e5e7eb",maskBorderWidth:1,maskBorderRadius:10,maskInnerPadding:12,maskOuterOffset:12,dividerColor:"#e5e7eb",titleFontSize:14,statusFontSize:13,msgFontSize:15,detailTitlePrefix:"Dettaglio rapporto n.",detailTitleHeight:28,detailTitlePaddingBottom:10,detailTitlePaddingLeft:0,detailTitleFontSize:14,detailTitleFontWeight:600,detailTitleColor:"rgba(0,0,0,0.85)",rejectReasons:["Mancanza requisiti","Documentazione incompleta","Dati incoerenti","Richiesta non ammissibile","Altro"],reasonsZebraOddBg:"#ffffff",reasonsZebraEvenBg:"#f6f7f9",reasonsRowBorderColor:"rgba(0,0,0,0.10)",reasonsRowBorderWidth:1,reasonsRowRadius:8,tabs:[{id:"anagrafica",label:"Anagrafica",fields:[],hideEmpty:!1},{id:"violazione",label:"Violazione",fields:[],hideEmpty:!0},{id:"iter",label:"Iter",fields:[],isIterTab:!0,hideEmpty:!1},{id:"allegati",label:"Allegati",fields:[],hideEmpty:!0},{id:"azioni",label:"Azioni",fields:[],locked:!0}],showEditButtons:!0,editOverlayColor:"#7c3aed",editPageColor:"#5b21b6",editPageId:"editing-ti",fieldStatoTI:"stato_TI",fieldPresaTI:"presa_in_carico_TI",editMinStato:2,editMaxStato:2,editPresaRequiredVal:2,presets:[],activePresetId:""};(0,t.Immutable)(n);var o=function(e,t,i,l){return new(i||(i=Promise))(function(n,o){function r(e){try{d(l.next(e))}catch(e){o(e)}}function a(e){try{d(l.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,a)}d((l=l.apply(e,t||[])).next())})},d=function(e,t){var i={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(l=Object.getOwnPropertySymbols(e);n<l.length;n++)t.indexOf(l[n])<0&&Object.prototype.propertyIsEnumerable.call(e,l[n])&&(i[l[n]]=e[l[n]])}return i};function s(e){return e&&(e.layer||e)||null}function u(e){return o(this,void 0,void 0,function*(){var i,l,n,o,r,a,d;if(!e)return null;const u=[],c=e=>{e&&!u.includes(e)&&u.push(e)};c(e);try{const i=t.DataSourceManager.getInstance();c((null==e?void 0:e.id)?i.getDataSource(e.id):null);const l=null==e?void 0:e.belongToDataSource;"string"==typeof l&&l&&c(i.getDataSource(l))}catch(e){}for(const e of u){const t=e,o=s(null!==(n=null!==(l=null!==(i="function"==typeof t.getLayer?t.getLayer():null)&&void 0!==i?i:"function"==typeof t.getJsApiLayer?t.getJsApiLayer():null)&&void 0!==l?l:"function"==typeof t.getJSAPILayer?t.getJSAPILayer():null)&&void 0!==n?n:t.layer);if(o&&"function"==typeof o.queryAttachments)return o}try{const t=e,i=null!==(a=null===(r=null===(o=null==t?void 0:t.getDataSourceJson)||void 0===o?void 0:o.call(t))||void 0===r?void 0:r.url)&&void 0!==a?a:null===(d=null==t?void 0:t.dataSourceJson)||void 0===d?void 0:d.url;if(!i||"string"!=typeof i)return null;const l=new(yield(g="esri/layers/FeatureLayer",new Promise((e,t)=>{const i=window.require;if(i)try{i([g],t=>e(t),e=>t(e))}catch(e){t(e)}else t(new Error("AMD require non disponibile"))})))({url:i});if("function"==typeof(null==l?void 0:l.load)&&(yield l.load().catch(()=>{})),l&&"function"==typeof l.queryAttachments)return l}catch(e){}var g;return null})}function c(e){return String(null!=e?e:"").trim().toLowerCase()}function g(e){return String(null!=e?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g," ").trim().replace(/\s+/g," ")}function f(e){return null==e||("string"==typeof e?""===e.trim():!!Array.isArray(e)&&0===e.length)}function p(e,t){const i=g(e),l=g(t);if(!l)return!1;var n;return new RegExp(`(^| )${n=l,n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}( |$)`).test(i)}function v(e,t){const i=c(t),l=c(e),n=i||l;return n?n.includes("fisica")||"pf"==n||n.startsWith("pf ")?"PF":n.includes("giurid")||"pg"==n||n.startsWith("pg ")?"PG":"1"==l?"PF":"2"==l?"PG":null:null}function b(e){return o(this,void 0,void 0,function*(){if(!e)return;let t=e;try{for(;t&&t.belongToDataSource;)t=t.belongToDataSource}catch(e){}const i=[];t&&i.push(t);try{const e=(null==t?void 0:t.getAllDerivedDataSources)?t.getAllDerivedDataSources():[];e&&e.length&&i.push(...e)}catch(e){}for(const e of i)try{const t=e.getCurrentQueryParams?e.getCurrentQueryParams():null;e.clearSourceRecords&&e.clearSourceRecords(),e.addVersion&&e.addVersion(),e.load&&(t?yield e.load(t):yield e.load())}catch(e){}})}function y(e,t){const i={fontSize:t,lineHeight:1.35,whiteSpace:"normal"};return"ok"===e?Object.assign(Object.assign({},i),{color:"#1a7f37"}):"err"===e?Object.assign(Object.assign({},i),{color:"#b42318"}):Object.assign(Object.assign({},i),{color:"#4b5563"})}function m(e,t){var i,l,n,o;return String(null!==(o=null!==(n=null!==(l=null!==(i=null==e?void 0:e.dataSourceId)&&void 0!==i?i:null==e?void 0:e.mainDataSourceId)&&void 0!==l?l:null==e?void 0:e.rootDataSourceId)&&void 0!==n?n:null==e?void 0:e.outputDataSourceId)&&void 0!==o?o:`ds_${t}`)}function h(i){const{widgetId:l,uds:n,dsKey:o,watchFields:r,onUpdate:a}=i;return(0,e.jsx)(t.DataSourceComponent,{useDataSource:n,widgetId:l,children:t=>(0,e.jsx)(x,{ds:t,dsKey:o,watchFields:r,onUpdate:a})})}function x(e){var i,l;const{ds:n,dsKey:o,watchFields:r,onUpdate:a}=e;t.React.useEffect(()=>{var e;try{null===(e=null==n?void 0:n.setListenSelection)||void 0===e||e.call(n,!0)}catch(e){}},[n]);const d=(null===(i=null==n?void 0:n.getSelectedRecords)||void 0===i?void 0:i.call(n))||[],s=d.length?d[0]:null;let u=(null==s?void 0:s.getData)?s.getData():null;const g=function(e){var t;try{const i=null===(t=null==e?void 0:e.getSchema)||void 0===t?void 0:t.call(e),l=(null==i?void 0:i.fields)||{},n=Object.keys(l);if(!n.length)return null;const o=["tipo_soggetto","TIPO_SOGGETTO","tipoSoggetto","TipoSoggetto","tipo_sogg","TIPO_SOGG","tipo","TIPO"];for(const e of o)if(e&&l[e])return e;for(const e of n){const t=l[e],i=c((null==t?void 0:t.alias)||(null==t?void 0:t.label)||(null==t?void 0:t.title)||""),n=c(e);if(n.includes("tipo")&&n.includes("sogg")||i.includes("tipo soggetto")||i.includes("tipologia soggetto"))return e}return n.find(e=>{const t=c(e);return t.includes("tipo")&&t.includes("sogg")})||null}catch(e){return null}}(n);let f=null,p=null,b=null;try{g&&(null==s?void 0:s.getFieldValue)&&(f=s.getFieldValue(g))}catch(e){}try{g&&null!=f&&(p=function(e,t,i){var l,n,o,r,a;try{const d=null===(l=null==e?void 0:e.getSchema)||void 0===l?void 0:l.call(e),s=null===(n=null==d?void 0:d.fields)||void 0===n?void 0:n[t],u=null===(o=null==s?void 0:s.domain)||void 0===o?void 0:o.codedValues;if(!u||!Array.isArray(u))return null;for(const e of u){const t=null==e?void 0:e.code;if(t==i)return String(null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"");if(String(t)===String(i))return String(null!==(a=null==e?void 0:e.name)&&void 0!==a?a:"")}return null}catch(e){return null}}(n,g,f))}catch(e){}b=v(f,p),g&&(u=Object.assign(Object.assign({},u||{}),{__tipo_soggetto_field:g,__tipo_soggetto_raw:f,__tipo_soggetto_label:p,__tipo_soggetto_kind:b}));const y=(null==n?void 0:n.getIdField)?n.getIdField():"OBJECTID",m=function(e,t){var i,l,n,o;return e?t&&null!=e[t]?e[t]:null!==(o=null!==(n=null!==(l=null!==(i=e.OBJECTID)&&void 0!==i?i:e.ObjectId)&&void 0!==l?l:e.objectid)&&void 0!==n?n:e.objectId)&&void 0!==o?o:null:null}(u,y),h=null!=m?Number(m):null,x=[];x.push(String(null!=h?h:""));for(const e of r)x.push(String(null!==(l=null==u?void 0:u[e])&&void 0!==l?l:""));const S=x.join("|");return t.React.useEffect(()=>{a(o,{ds:n,oid:null!=h&&Number.isFinite(h)?h:null,idFieldName:y,data:null!=h&&Number.isFinite(h)?u:null,sig:S})},[o,n,y,S]),null}function S(t){return(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:12,alignItems:"baseline"},children:[(0,e.jsx)("div",{style:{fontSize:t.labelSize,color:"#6b7280",textAlign:"left"},children:t.label}),(0,e.jsx)("div",{style:{fontSize:t.valueSize,fontWeight:600,wordBreak:"break-word"},children:null!=t.value&&""!==t.value?String(t.value):"\u2014"})]})}function j(i){const[n,o]=t.React.useState(!1),[r,a]=t.React.useState(null),d=t.React.useRef(null),s=t.React.useRef(null),u=Array.isArray(i.options)?i.options:[],c=i.value?i.value:i.placeholder||"\u2014 seleziona \u2014",g=`${Math.max(0,Number(i.borderWidth)||0)}px solid ${i.borderColor||"rgba(0,0,0,0.10)"}`,f=t.React.useCallback(()=>{const e=d.current;if(!e)return;const t=(e.querySelector("button")||e).getBoundingClientRect(),i=window.innerHeight-t.bottom-8,l=t.top-8,n=i<180&&l>i,o=Math.min(280,Math.max(140,(n?l:i)-12));a({left:t.left,width:t.width,openUp:n,top:t.bottom+6,bottom:window.innerHeight-t.top+6,maxHeight:o})},[]);t.React.useEffect(()=>{if(!n)return;f();const e=e=>{const t=d.current,i=s.current;if(!t||!i)return;const l=e.target;t.contains(l)||i.contains(l)||o(!1)},t=e=>{"Escape"===(null==e?void 0:e.key)&&o(!1)},i=()=>f(),l=()=>f();return document.addEventListener("mousedown",e,!0),document.addEventListener("keydown",t,!0),window.addEventListener("resize",i,!0),window.addEventListener("scroll",l,!0),()=>{document.removeEventListener("mousedown",e,!0),document.removeEventListener("keydown",t,!0),window.removeEventListener("resize",i,!0),window.removeEventListener("scroll",l,!0)}},[n,f]);const p=n&&!i.disabled&&r?(0,l.createPortal)((0,e.jsxs)("div",{ref:s,style:{position:"fixed",left:r.left,width:r.width,top:r.openUp?"auto":r.top,bottom:r.openUp?r.bottom:"auto",zIndex:2e5,border:g,borderRadius:Math.max(0,Number(i.radius)||0),overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.12)",background:"#ffffff",maxHeight:r.maxHeight,overflowY:"auto"},children:[(0,e.jsx)("div",{onClick:()=>{i.onChange(""),o(!1)},style:{padding:"8px 10px",cursor:"pointer",fontSize:i.fontSize,backgroundColor:i.evenBg||"#ffffff",borderBottom:g,opacity:.9},title:"Svuota selezione",children:"\u2014 seleziona \u2014"}),u.map((t,l)=>{const n=l%2==0?i.evenBg||"#f6f7f9":i.oddBg||"#ffffff",r=String(t)===String(i.value||"");return(0,e.jsx)("div",{onClick:()=>{i.onChange(String(t)),o(!1)},style:{padding:"8px 10px",cursor:"pointer",fontSize:i.fontSize,backgroundColor:n,borderBottom:l===u.length-1?"none":g,fontWeight:r?700:400},children:String(t)},`${t}-${l}`)})]}),document.body):null,v=i.isError?"1px solid #b42318":"1px solid rgba(0,0,0,0.20)";return(0,e.jsxs)("div",{ref:d,style:{position:"relative",width:"100%"},children:[(0,e.jsxs)("button",{type:"button",disabled:!!i.disabled,onClick:()=>{i.disabled||o(e=>{const t=!e;return t&&f(),t})},style:{width:"100%",padding:"8px 10px",borderRadius:8,border:v,background:i.disabled?"#f3f4f6":"#ffffff",color:i.disabled?"#9ca3af":"#111827",cursor:i.disabled?"not-allowed":"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:10},children:[(0,e.jsx)("span",{style:{flex:1,fontSize:i.fontSize},children:c}),(0,e.jsx)("span",{style:{fontSize:i.fontSize,opacity:.75},children:"\u25be"})]}),p]})}const w=1;function z(i){const{oid:n,data:r,ds:a,idFieldName:d,cfg:s,ui:u,onClose:c}=i,[g,f]=t.React.useState({}),[p,v]=t.React.useState([]),[b,y]=t.React.useState(!1);t.React.useEffect(()=>{let e=!1;return(()=>{o(this,void 0,void 0,function*(){var t,i,l;try{const i=null===(t=null==a?void 0:a.getSchema)||void 0===t?void 0:t.call(a),l=(null==i?void 0:i.fields)||{},n={};for(const e of Object.keys(l)){const t=l[e];n[e]=String((null==t?void 0:t.alias)||(null==t?void 0:t.label)||(null==t?void 0:t.title)||e)}!e&&Object.keys(n).length&&f(n)}catch(e){}try{const t=(null===(i=null==a?void 0:a.getLayer)||void 0===i?void 0:i.call(a))||(null===(l=null==a?void 0:a.getJSAPILayer)||void 0===l?void 0:l.call(a))||(null==a?void 0:a.layer)||null,n=yield Promise.resolve(t),o=n&&(n.layer||n)||null,r=(null==o?void 0:o.fields)||[];if(r.length&&!e){const e={},t=[];for(const i of r)(null==i?void 0:i.name)&&(e[i.name]=String((null==i?void 0:i.alias)||i.name),t.push({name:i.name,type:i.type||"",domain:i.domain||null}));f(e),v(t)}}catch(e){}e||y(!0)})})(),()=>{e=!0}},[a]);const[m,h]=t.React.useState(Object.assign({},r)),[x,S]=t.React.useState(!1),[j,w]=t.React.useState(null),[z,T]=t.React.useState(!1),[R,C]=t.React.useState("anagrafica"),I=(e,t)=>h(i=>Object.assign(Object.assign({},i),{[e]:t})),_=[],N=[],A=Object.keys(r||{}).filter(e=>!(e.startsWith("__")||/^objectid$/i.test(e)||/^globalid$/i.test(e)||/^shape/i.test(e)||/^stato_/i.test(e)||/^esito_/i.test(e)||/^presa_in_carico/i.test(e)||/^dt_/i.test(e)||/^GII_/i.test(e)||/^origine_pratica$/i.test(e))),k=/ditta|denom|ragione|nome|cognome|cf|cod.*fisc|piva|partita|indir|via|cap|comune|prov|telefono|cell|mail|pec|tipologia_sogg|tipo_sogg/i,D=/viol|infraz|descr|art|norm|tipo_preliev|sanz|acqua|volume|turno|utenza|contatore|circostanz|fatti|ufficio|settore|area_cod/i;for(const e of A)k.test(e)?_.push(e):D.test(e)&&N.push(e);const F=new Set([..._,...N]);for(const e of A)F.has(e)||N.push(e);const B=t=>{if(!b)return null;const i=p.find(e=>e.name===t),l=g[t]||t,n=(null==i?void 0:i.type)||"esriFieldTypeString",o=(null==i?void 0:i.domain)||null,r=m[t],a=n.toLowerCase().includes("date"),d=n.toLowerCase().includes("integer")||n.toLowerCase().includes("double");if((null==o?void 0:o.codedValues)&&Array.isArray(o.codedValues))return(0,e.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,e.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:l}),(0,e.jsxs)("select",{value:null!=r?r:"",disabled:x,onChange:e=>I(t,""===e.target.value?null:d?Number(e.target.value):e.target.value),style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",background:x?"#f3f4f6":"#fff"},children:[(0,e.jsx)("option",{value:"",children:"\u2014 seleziona \u2014"}),o.codedValues.map(t=>(0,e.jsx)("option",{value:String(t.code),children:t.name},String(t.code)))]})]},t);if(a){const i=e=>{if(!e)return"";try{const t=Number(e),i=Number.isFinite(t)&&t>0?new Date(t):new Date(String(e));return Number.isNaN(i.getTime())?"":`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`}catch(e){return""}};return(0,e.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,e.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:l}),(0,e.jsx)("input",{type:"date",value:i(r),disabled:x,onChange:e=>{const i=new Date(e.target.value);I(t,Number.isNaN(i.getTime())?null:i.getTime())},style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",background:x?"#f3f4f6":"#fff"}})]},t)}const s=/descr|note|fatti|circostanz/i.test(t);return(0,e.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,e.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:l}),s?(0,e.jsx)("textarea",{value:null!=r?String(r):"",disabled:x,rows:3,onChange:e=>I(t,e.target.value||null),style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",resize:"vertical",background:x?"#f3f4f6":"#fff",boxSizing:"border-box"}}):(0,e.jsx)("input",{type:"text",value:null!=r?String(r):"",disabled:x,onChange:e=>I(t,""===e.target.value?null:d?Number(e.target.value):e.target.value),style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",background:x?"#f3f4f6":"#fff",boxSizing:"border-box"}})]},t)},E=(()=>{var e;const t=null!==(e=null==r?void 0:r.origine_pratica)&&void 0!==e?e:null==r?void 0:r.Origine_pratica;return`${2===t||"2"===t?"TI":"TR"}-${n}`})(),P=(0,e.jsxs)("div",{style:{position:"fixed",inset:0,zIndex:99999,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,e.jsxs)("div",{style:{background:"#fff",borderRadius:12,width:"88vw",maxWidth:860,height:"85vh",maxHeight:"85vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[(0,e.jsxs)("div",{style:{flex:"0 0 auto",padding:"14px 20px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[(0,e.jsxs)("div",{style:{fontWeight:700,fontSize:15},children:["\u270f\ufe0f Modifica pratica\xa0",(0,e.jsx)("span",{style:{color:"#2f6fed"},children:E})]}),(0,e.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[j&&(0,e.jsx)("span",{style:{fontSize:13,color:"ok"===j.kind?"#1a7f37":"#b42318"},children:j.text}),(0,e.jsx)("button",{type:"button",disabled:x,onClick:()=>o(this,void 0,void 0,function*(){var e,i,l,r;S(!0),w(null);try{const s=yield function(e){return o(this,void 0,void 0,function*(){var i,l,n,o;if(!e)return null;try{const t=(null===(i=null==e?void 0:e.getLayer)||void 0===i?void 0:i.call(e))||(null===(l=null==e?void 0:e.getJSAPILayer)||void 0===l?void 0:l.call(e))||(null===(n=null==e?void 0:e.getJsApiLayer)||void 0===n?void 0:n.call(e))||(null==e?void 0:e.layer)||null,o=yield Promise.resolve(t),r=o&&(o.layer||o)||null;if(r&&"function"==typeof r.applyEdits)return r}catch(e){}try{const i=t.DataSourceManager.getInstance(),l=(null==e?void 0:e.id)?i.getDataSource(e.id):null;if(l){const e=(null===(o=null==l?void 0:l.getLayer)||void 0===o?void 0:o.call(l))||(null==l?void 0:l.layer)||null,t=yield Promise.resolve(e),i=t&&(t.layer||t)||null;if(i&&"function"==typeof i.applyEdits)return i}}catch(e){}return null})}(a);if(!(null==s?void 0:s.applyEdits))throw new Error("Layer non raggiungibile.");if("function"==typeof s.load)try{yield s.load()}catch(e){}const u={[d]:n};for(const[e,t]of Object.entries(m))e.startsWith("__")||(u[e]=t);const g=function(e,t){const i=(null==t?void 0:t.fields)||[];if(!i.length)return e;const l=new Set(i.map(e=>String(e.name))),n={};for(const t of Object.keys(e))l.has(t)&&(n[t]=e[t]);return n}(u,s),f=yield s.applyEdits({updateFeatures:[{attributes:g}]}),p=(null===(e=null==f?void 0:f.updateFeatureResults)||void 0===e?void 0:e[0])||(null===(i=null==f?void 0:f.updateResults)||void 0===i?void 0:i[0])||null,v=null==p?void 0:p.error;if(!(!v&&(!0===(null==p?void 0:p.success)||null!=(null==p?void 0:p.objectId)||null==(null==p?void 0:p.success)))){const e=v?`${null!==(l=v.code)&&void 0!==l?l:""}: ${null!==(r=v.message)&&void 0!==r?r:""}`:JSON.stringify(f);throw new Error(e)}yield function(e){return o(this,void 0,void 0,function*(){var t,i;if(!e)return;let l=e;try{for(;null==l?void 0:l.belongToDataSource;)l=l.belongToDataSource}catch(e){}const n=l?[l]:[];try{const e=(null===(t=null==l?void 0:l.getAllDerivedDataSources)||void 0===t?void 0:t.call(l))||[];(null==e?void 0:e.length)&&n.push(...e)}catch(e){}for(const e of n)try{const t=(null===(i=e.getCurrentQueryParams)||void 0===i?void 0:i.call(e))||null;e.clearSourceRecords&&e.clearSourceRecords(),e.addVersion&&e.addVersion(),e.load&&(t?yield e.load(t):yield e.load())}catch(e){}})}(a),w({kind:"ok",text:"Salvato."}),S(!1),window.setTimeout(()=>c(!0),1e3)}catch(e){S(!1),w({kind:"err",text:`Errore: ${(null==e?void 0:e.message)||String(e)}`})}}),style:{padding:"8px 18px",borderRadius:8,border:"none",background:x?"#e5e7eb":"#1a7f37",color:x?"#9ca3af":"#fff",fontWeight:700,fontSize:13,cursor:x?"not-allowed":"pointer"},children:x?"Salvataggio\u2026":"\u{1f4be} Salva"}),(0,e.jsx)("button",{type:"button",disabled:x,onClick:()=>T(!0),style:{padding:"8px 18px",borderRadius:8,border:"1px solid #d13438",background:"#fff",color:"#d13438",fontWeight:700,fontSize:13,cursor:x?"not-allowed":"pointer"},children:"\u2715 Annulla"})]})]}),(0,e.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",gap:8,padding:"10px 20px",borderBottom:"1px solid #e5e7eb"},children:[["anagrafica","violazione"].map(t=>(0,e.jsx)("button",{type:"button",disabled:x,onClick:()=>C(t),style:{padding:"8px 14px",borderRadius:10,border:"1px solid "+(R===t?"#2f6fed":"rgba(0,0,0,0.12)"),background:R===t?"#eaf2ff":"rgba(0,0,0,0.02)",color:R===t?"#1d4ed8":"#111827",fontWeight:700,fontSize:12,cursor:x?"not-allowed":"pointer"},children:t.charAt(0).toUpperCase()+t.slice(1)},t)),(0,e.jsx)("div",{style:{fontSize:12,color:"#9ca3af",alignSelf:"center",marginLeft:8},children:'Per localizzazione e allegati usa "Modifica (pagina)"'})]}),(0,e.jsx)("div",{style:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},children:b?(0,e.jsxs)("div",{style:{display:"grid",gap:14},children:["anagrafica"===R&&(_.length?_.map(e=>B(e)):(0,e.jsx)("div",{style:{color:"#6b7280",fontSize:13},children:"Nessun campo rilevato automaticamente. Usare la pagina di editing completa."})),"violazione"===R&&(N.length?N.map(e=>B(e)):(0,e.jsx)("div",{style:{color:"#6b7280",fontSize:13},children:"Nessun campo rilevato automaticamente. Usare la pagina di editing completa."}))]}):(0,e.jsx)("div",{style:{color:"#6b7280",fontSize:13},children:"Caricamento schema campi\u2026"})})]}),z&&(0,e.jsx)("div",{style:{position:"fixed",inset:0,zIndex:1e5,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,e.jsxs)("div",{style:{background:"#fff",borderRadius:12,padding:28,maxWidth:380,width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.25)"},children:[(0,e.jsx)("div",{style:{fontWeight:700,fontSize:16,marginBottom:10},children:"Annullare le modifiche?"}),(0,e.jsx)("div",{style:{fontSize:13,color:"#4b5563",marginBottom:20},children:"Le modifiche non salvate andranno perse."}),(0,e.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,e.jsx)("button",{type:"button",onClick:()=>{T(!1),c(!1)},style:{padding:"8px 18px",borderRadius:8,border:"none",background:"#d13438",color:"#fff",fontWeight:700,fontSize:13,cursor:"pointer"},children:"S\xec, annulla"}),(0,e.jsx)("button",{type:"button",onClick:()=>T(!1),style:{padding:"8px 18px",borderRadius:8,border:"1px solid rgba(0,0,0,0.15)",background:"#fff",color:"#111827",fontWeight:600,fontSize:13,cursor:"pointer"},children:"Torna all'editing"})]})]})})]});return(0,l.createPortal)(P,document.body)}const T=2,R=1,C=2,I=3,_=4,N=5,A=1,k=2,D=3;function F(e){return e===A?I:e===k?_:e===D?N:null}function B(e,t){const i=String(null!=e?e:"").trim();return i&&function(e){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test((e||"").trim())}(i)?i:t}function E(e,t){return t?{backgroundColor:"#e5e7eb",borderColor:"#e5e7eb",color:"#9ca3af",cursor:"not-allowed"}:{backgroundColor:e,borderColor:e,color:"#ffffff"}}function P(l){var n,r,a,d,u,c;const{active:g,roleCode:f,buttonText:p,buttonColors:v,ui:m}=l,h=String(f||"DT").trim().toUpperCase(),x=m.titleFontSize,B=m.msgFontSize,P=`presa_in_carico_${h}`,O=`dt_presa_in_carico_${h}`,$=`stato_${h}`,L=`dt_stato_${h}`,W=`esito_${h}`,M=`dt_esito_${h}`,G=`note_${h}`,H="stato_DA",J="dt_stato_DA",U="presa_in_carico_DA",[V,Z]=t.React.useState(!1),[q,K]=t.React.useState({kind:"info",text:"Selezionare una riga."}),[Y,Q]=t.React.useState(null),[X,ee]=t.React.useState(!1),[te,ie]=t.React.useState(""),[le,ne]=t.React.useState(""),oe=t.React.useRef(""),re=t.React.useRef(null),ae=t.React.useCallback(e=>{if(e)try{e.style.height="auto";const t=Math.min(e.scrollHeight||42,118);e.style.height=`${t}px`,e.style.overflowY=e.scrollHeight>118?"auto":"hidden"}catch(e){}},[]),de=null!=(null===(n=null==g?void 0:g.state)||void 0===n?void 0:n.oid)?`${g.key}:${g.state.oid}`:null,se=t.React.useRef(de);t.React.useEffect(()=>{se.current=de},[de]);const ue=null===(r=null==g?void 0:g.state)||void 0===r?void 0:r.ds,ce=(null===(a=null==g?void 0:g.state)||void 0===a?void 0:a.data)||null,ge=null!==(u=null===(d=null==g?void 0:g.state)||void 0===d?void 0:d.oid)&&void 0!==u?u:null,fe=(null===(c=null==g?void 0:g.state)||void 0===c?void 0:c.idFieldName)||"OBJECTID",pe=null!=ge&&Number.isFinite(ge),ve=l.editConfig,[be,ye]=t.React.useState(!1),me=ce?ce[ve.fieldStatoTI]:null,he=ce?ce[ve.fieldPresaTI]:null,xe=null!=me&&""!==String(me)?Number(me):null,Se=null!=he&&""!==String(he)?Number(he):null,je=pe&&!V&&null===Y&&ve.show&&Se===ve.presaRequiredVal&&null!=xe&&xe>=ve.minStato&&xe<=ve.maxStato,we=ce?ce[P]:null,ze=ce?ce[$]:null,Te=ce?ce[W]:null,Re=ce?ce[H]:null,Ce=null!=we&&""!==String(we)?Number(we):null,Ie=null!=ze&&""!==String(ze)?Number(ze):null,_e=null!=Re&&""!==String(Re)?Number(Re):null,Ne="DT"===h&&null!=_e&&_e>=1;t.React.useEffect(()=>{if(!de)return K({kind:"info",text:"Selezionare una riga."}),Q(null),Z(!1),ee(!1),oe.current="",ie(""),void ne("");K(null),Q(null),Z(!1),ee(!1);const e=ce&&null!=ce[G]?String(ce[G]):"";oe.current=e,ie(e),ne(""),window.setTimeout(()=>ae(re.current),0)},[de]),t.React.useEffect(()=>{const e=window.setTimeout(()=>ae(re.current),0);return()=>window.clearTimeout(e)},[te,ae]);const Ae=(null!=Y||V)&&pe,ke=pe&&!V&&!Ne&&null===Y&&(null==Ce||Ce===w)&&(null==Ie||Ie===R),De=pe&&!V&&!Ne&&null===Y&&Ce===T&&Ie===C,Fe="DT"===h&&pe&&!V&&!Ne&&null===Y&&(Ie===I||Ie===_||Ie===N)&&(null==_e||0===_e),Be="INTEGRAZIONE"===Y||"RESPINGI"===Y,Ee=Be&&pe&&!V&&!Ne,Pe=String(null!=te?te:"").trim(),Oe=String(null!=le?le:"").trim(),$e=/\baltro\b/i.test(Oe),Le="INTEGRAZIONE"===Y||"RESPINGI"===Y&&$e,We=X&&("RESPINGI"===Y&&!Oe),Me=X&&(Le&&!Pe),Ge=e=>{pe&&(Ne||("TAKE"!==e||ke)&&("TAKE"===e||"TRASMETTI"===e||De)&&("TRASMETTI"!==e||Fe)&&(Q(e),K(null),ee(!1),ne(""),"INTEGRAZIONE"===e&&window.setTimeout(()=>{var e,t;try{null===(t=null===(e=re.current)||void 0===e?void 0:e.focus)||void 0===t||t.call(e)}catch(e){}ae(re.current)},0)))},He=e=>{let t=e;try{for(;null==t?void 0:t.belongToDataSource;)t=t.belongToDataSource}catch(e){}return t||e},Je=e=>o(this,void 0,void 0,function*(){var t,i,l,n,o,r;const a=He(e),d=(null===(t=null==a?void 0:a.getLayer)||void 0===t?void 0:t.call(a))||(null===(i=null==a?void 0:a.getJSAPILayer)||void 0===i?void 0:i.call(a))||(null==a?void 0:a.layer)||(null===(l=null==a?void 0:a.createJSAPILayerByDataSource)||void 0===l?void 0:l.call(a))||(null===(n=null==e?void 0:e.getLayer)||void 0===n?void 0:n.call(e))||(null===(o=null==e?void 0:e.getJSAPILayer)||void 0===o?void 0:o.call(e))||(null==e?void 0:e.layer)||(null===(r=null==e?void 0:e.createJSAPILayerByDataSource)||void 0===r?void 0:r.call(e))||null;return{root:a,layer:s(yield Promise.resolve(d))}}),Ue=(e,t)=>o(this,void 0,void 0,function*(){var i,l,n,o,r,a;if(!ue)throw new Error("DataSource non disponibile.");if(!pe||null==ge)throw new Error("Selezione non valida.");const d=se.current;Z(!0),K({kind:"info",text:"Aggiorno\u2026"});try{const{root:s,layer:u}=yield Je(ue);if(!(null==u?void 0:u.applyEdits))throw new Error("Layer non disponibile (applyEdits).");if("function"==typeof u.load)try{yield u.load()}catch(e){}const c=((null===(i=He(ue))||void 0===i?void 0:i.getIdField)?He(ue).getIdField():null)||((null==ue?void 0:ue.getIdField)?ue.getIdField():null)||u.objectIdField||fe||"OBJECTID",g=function(e,t){const i=(null==t?void 0:t.fields)||[];if(!i.length)return e;const l=new Set(i.map(e=>String(e.name))),n={};for(const t of Object.keys(e))l.has(t)&&(n[t]=e[t]);return n}(Object.assign({[c]:ge},e),u),f=yield u.applyEdits({updateFeatures:[{attributes:g}]}),p=(null===(l=null==f?void 0:f.updateFeatureResults)||void 0===l?void 0:l[0])||(null===(n=null==f?void 0:f.updateResults)||void 0===n?void 0:n[0])||null,v=null==p?void 0:p.error;if(!(!v&&(!0===(null==p?void 0:p.success)||null!=(null==p?void 0:p.objectId)||null!=(null==p?void 0:p.globalId)||null==(null==p?void 0:p.success)))){const e=v?`code=${null!==(o=v.code)&&void 0!==o?o:""} name=${null!==(r=v.name)&&void 0!==r?r:""} message=${null!==(a=v.message)&&void 0!==a?a:""}`:JSON.stringify(f||p);throw new Error(e)}if(se.current!==d)return K(null),void Z(!1);K({kind:"ok",text:t}),yield b(s),yield b(ue),window.setTimeout(()=>{se.current===d&&K(null)},4500),Z(!1)}catch(e){throw Z(!1),e}}),Ve=(e,t)=>o(this,void 0,void 0,function*(){try{const i=F(e),l={[W]:e,[M]:Date.now()};null!=i&&(l[$]=i,l[L]=Date.now()),yield Ue(l,`Esito salvato: ${t}.`),Q(null),ee(!1)}catch(e){const t=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${t}`})}}),Ze=(e,t)=>e?{fontSize:m.statusFontSize,color:t?"#b42318":"#6b7280"}:{display:"none"};return(0,e.jsxs)("div",{children:[Ae&&(0,e.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.10)",zIndex:1e3}}),(0,e.jsxs)("div",{style:{position:"relative",zIndex:1001,display:"flex",flexDirection:"column",gap:12,boxSizing:"border-box",width:"100%",height:"100%",minHeight:0},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[(0,e.jsxs)("div",{style:{fontSize:x,fontWeight:700},children:["Azioni (",h,")"]}),q&&(0,e.jsx)("div",{style:y(q.kind,B),title:q.text,children:q.text})]}),(0,e.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,e.jsx)(S,{label:"N.pratica (OID)",value:ge,labelSize:m.statusFontSize,valueSize:x}),(0,e.jsx)(S,{label:P,value:we,labelSize:m.statusFontSize,valueSize:x}),(0,e.jsx)(S,{label:$,value:ze,labelSize:m.statusFontSize,valueSize:x}),(0,e.jsx)(S,{label:W,value:Te,labelSize:m.statusFontSize,valueSize:x}),(0,e.jsx)(S,{label:H,value:Re,labelSize:m.statusFontSize,valueSize:x})]}),(0,e.jsx)("div",{style:{height:1,background:m.dividerColor,margin:"2px 0"}}),null===Y&&(0,e.jsx)("div",{style:{display:"flex",alignItems:"baseline",gap:10},children:(0,e.jsx)("div",{style:{fontSize:x,fontWeight:700},children:"Azioni"})}),null===Y&&(0,e.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[(0,e.jsx)(i.Button,{type:"primary",onClick:()=>Ge("TAKE"),disabled:!ke,style:E(v.take,!ke),children:p}),(0,e.jsx)(i.Button,{type:"primary",onClick:()=>Ge("INTEGRAZIONE"),disabled:!De,style:E(v.integrazione,!De),children:"Integrazione"}),(0,e.jsx)(i.Button,{type:"primary",onClick:()=>Ge("APPROVA"),disabled:!De,style:E(v.approva,!De),children:"Approva"}),(0,e.jsx)(i.Button,{type:"primary",onClick:()=>Ge("RESPINGI"),disabled:!De,style:E(v.respingi,!De),children:"Respingi"}),"DT"===h&&(0,e.jsx)(i.Button,{type:"primary",onClick:()=>Ge("TRASMETTI"),disabled:!Fe,style:E(v.trasmetti,!Fe),children:"Trasmetti a DA"}),ve.show&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{width:"100%",height:1,background:m.dividerColor,margin:"4px 0"}}),(0,e.jsx)("button",{type:"button",disabled:!je,onClick:()=>{var e,t,i,l;if(je){try{window.__giiEdit={oid:ge,data:Object.assign({},ce),idFieldName:(null===(e=null==g?void 0:g.state)||void 0===e?void 0:e.idFieldName)||"OBJECTID",dsId:null!==(l=null===(i=null===(t=null==g?void 0:g.state)||void 0===t?void 0:t.ds)||void 0===i?void 0:i.id)&&void 0!==l?l:null,ts:Date.now()}}catch(e){}ye(!0)}},title:je?"Apre il pannello di editing nella pagina corrente":"Modifica non disponibile: verifica stato e presa in carico TI",style:{padding:"8px 16px",borderRadius:8,border:"none",background:je?ve.overlayColor:"#e5e7eb",color:je?"#fff":"#9ca3af",fontWeight:700,fontSize:13,cursor:je?"pointer":"not-allowed",display:"flex",alignItems:"center",gap:6},children:"\u270f\ufe0f Modifica (overlay)"}),(0,e.jsx)("button",{type:"button",disabled:!je,onClick:()=>{var e,t,i,l,n,o;if(je){try{window.__giiEdit={oid:ge,data:Object.assign({},ce),idFieldName:(null===(e=null==g?void 0:g.state)||void 0===e?void 0:e.idFieldName)||"OBJECTID",dsId:null!==(l=null===(i=null===(t=null==g?void 0:g.state)||void 0===t?void 0:t.ds)||void 0===i?void 0:i.id)&&void 0!==l?l:null,ts:Date.now()}}catch(e){}try{const e=String(ve.pageId||"editing-ti").trim(),t=null===(n=window.jimuCore)||void 0===n?void 0:n.getAppStore;if(t){const i=t();return void(null===(o=null==i?void 0:i.dispatch)||void 0===o||o.call(i,{type:"APP_NAVIGATE",uri:e}))}}catch(e){}try{const e=String(ve.pageId||"editing-ti").trim();window.location.hash=`#${e}`}catch(e){}}},title:je?`Apre la pagina di editing: ${ve.pageId}`:"Modifica non disponibile: verifica stato e presa in carico TI",style:{padding:"8px 16px",borderRadius:8,border:`2px solid ${je?ve.pageColor:"#e5e7eb"}`,background:"#fff",color:je?ve.pageColor:"#9ca3af",fontWeight:700,fontSize:13,cursor:je?"pointer":"not-allowed",display:"flex",alignItems:"center",gap:6},children:"\u2197 Modifica (pagina)"})]})]}),be&&pe&&null!=ge&&null!=ce&&(0,e.jsx)(z,{oid:ge,data:ce,ds:ue,idFieldName:fe,cfg:ve,ui:m,onClose:e=>{ye(!1),e&&(K({kind:"ok",text:"Pratica modificata."}),window.setTimeout(()=>K(null),4e3))}}),null!==Y&&(0,e.jsxs)("div",{style:{display:"grid",gap:10},children:["RESPINGI"===Y&&(0,e.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[(0,e.jsx)("div",{style:{fontSize:x,fontWeight:700},children:"Motivazione"}),(0,e.jsx)("div",{style:Ze(!0,We),children:"(obbligatoria)"})]}),(0,e.jsx)(j,{value:le,options:m.rejectReasons||[],placeholder:"\u2014 seleziona \u2014",disabled:V||!pe||Ne,onChange:e=>{const t=String(null!=e?e:"");ne(t),X&&ee(!1)},evenBg:m.reasonsZebraEvenBg,oddBg:m.reasonsZebraOddBg,borderColor:m.reasonsRowBorderColor,borderWidth:m.reasonsRowBorderWidth,radius:m.reasonsRowRadius,fontSize:m.statusFontSize,isError:We})]}),Be&&(0,e.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[(0,e.jsx)("div",{style:{fontSize:x,fontWeight:700},children:"Note"}),"INTEGRAZIONE"===Y&&(0,e.jsx)("div",{style:Ze(!0,Me),children:"(obbligatoria)"}),"RESPINGI"===Y&&Le&&(0,e.jsx)("div",{style:Ze(!0,Me),children:"(obbligatoria)"})]}),(0,e.jsx)("textarea",{ref:re,value:te,onChange:e=>{var t;const i=String(null!==(t=e.target.value)&&void 0!==t?t:"");ie(i),ae(e.target)},placeholder:"INTEGRAZIONE"===Y?"Scrivi la richiesta di integrazione\u2026":Le?"Specifica il motivo (Altro)\u2026":"Nota facoltativa (eventuali dettagli)\u2026",style:{width:"100%",minHeight:42,maxHeight:118,overflowY:"hidden",resize:"none",padding:"8px 10px",borderRadius:8,border:Me?"1px solid #b42318":"1px solid rgba(0,0,0,0.20)",fontSize:m.statusFontSize,outline:"none",boxSizing:"border-box"},disabled:!Ee})]}),(0,e.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:["TAKE"===Y&&(0,e.jsx)(i.Button,{type:"primary",onClick:()=>o(this,void 0,void 0,function*(){try{yield Ue({[P]:T,[O]:Date.now(),[$]:C,[L]:Date.now()},"Presa in carico salvata."),Q(null),ee(!1)}catch(e){const t=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${t}`})}}),disabled:V,style:E(v.take,!!V),children:V?"Aggiorno\u2026":"Conferma presa in carico"}),"INTEGRAZIONE"===Y&&(0,e.jsx)(i.Button,{type:"primary",onClick:()=>o(this,void 0,void 0,function*(){if(ee(!0),Pe)try{const e=F(A);yield Ue({[W]:A,[M]:Date.now(),[$]:null!=e?e:I,[L]:Date.now(),[G]:Pe},"Integrazione richiesta salvata."),Q(null),ee(!1)}catch(e){const t=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${t}`})}}),disabled:V,style:E(v.integrazione,!!V),children:V?"Aggiorno\u2026":"Conferma integrazione"}),"APPROVA"===Y&&(0,e.jsx)(i.Button,{type:"primary",onClick:()=>Ve(k,"Approvata"),disabled:V,style:E(v.approva,!!V),children:V?"Aggiorno\u2026":"Conferma approvazione"}),"RESPINGI"===Y&&(0,e.jsx)(i.Button,{type:"primary",onClick:()=>o(this,void 0,void 0,function*(){if(ee(!0),Oe&&(!Le||Pe))try{const e=F(D),t=$e?`Motivazione: ${Oe}\n\n${Pe}`:`Motivazione: ${Oe}`+(Pe?`\n\n${Pe}`:""),i={[W]:D,[M]:Date.now(),[G]:t};null!=e&&(i[$]=e,i[L]=Date.now()),yield Ue(i,"Esito salvato: Respinta."),Q(null),ee(!1)}catch(e){const t=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${t}`})}}),disabled:V,style:E(v.respingi,!!V),children:V?"Aggiorno\u2026":"Conferma respinta"}),"TRASMETTI"===Y&&(0,e.jsx)(i.Button,{type:"primary",onClick:()=>o(this,void 0,void 0,function*(){try{yield Ue({[H]:R,[J]:Date.now(),[U]:w},"Trasmesso a DA."),Q(null),ee(!1)}catch(e){const t=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${t}`})}}),disabled:V,style:E(v.trasmetti,!!V),children:V?"Aggiorno\u2026":"Conferma trasmissione"}),(0,e.jsx)(i.Button,{type:"default",onClick:()=>{Q(null),Z(!1),K(null),ee(!1),ie(oe.current),ne("")},disabled:V,children:"Annulla"})]})]}),Ne&&pe&&(0,e.jsx)("div",{style:Object.assign(Object.assign({},y("info",B)),{marginTop:4}),children:"Pratica gi\xe0 trasmessa a DA: azioni non disponibili."})]})]})}function O(e){if(null==e||""===e)return"\u2014";try{const t=Number(e),i=Number.isFinite(t)&&t>0?new Date(t):new Date(String(e));if(Number.isNaN(i.getTime()))return String(e);const l=String(i.getDate()).padStart(2,"0"),n=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getFullYear()),r=String(i.getHours()).padStart(2,"0");return`${l}/${n}/${o} ${r}:${String(i.getMinutes()).padStart(2,"0")}`}catch(t){return String(e)}}function $(e){if(!e)return[];const t=(null==e?void 0:e.asMutable)?e.asMutable({deep:!0}):e;return(Array.isArray(t)?t:[]).map(e=>String(e)).filter(Boolean)}function L(e,t){let i=[];return i=Array.isArray(t)&&t.length>0?t:[{id:"anagrafica",label:"Anagrafica",fields:(null==e?void 0:e.anagrafica)||[]},{id:"violazione",label:"Violazione",fields:(null==e?void 0:e.violazione)||[]},{id:"iter",label:"Iter",fields:(null==e?void 0:e.iterExtra)||[],isIterTab:!0},{id:"allegati",label:"Allegati",fields:(null==e?void 0:e.allegati)||[]},{id:"azioni",label:"Azioni",fields:[]}],i.map(e=>{const t=null!=e.hideEmpty?Boolean(e.hideEmpty):"violazione"===e.id||"allegati"===e.id;if("azioni"===e.id){const t=e,{locked:i}=t,l=d(t,["locked"]);return Object.assign(Object.assign({},l),{hideEmpty:!1})}return Object.assign(Object.assign({},e),{hideEmpty:t})})}function W(t){const i=t.active?"#eaf2ff":"rgba(0,0,0,0.02)",l=t.active?"#2f6fed":"rgba(0,0,0,0.12)",n=t.active?"#1d4ed8":"#111827";return(0,e.jsx)("button",{type:"button",disabled:!!t.disabled,onClick:t.onClick,style:{padding:"8px 10px",borderRadius:10,border:`1px solid ${l}`,background:i,color:n,fontWeight:700,fontSize:12,cursor:t.disabled?"not-allowed":"pointer",opacity:t.disabled?.55:1},children:t.label})}function M(t){var i;const l=null!==(i=t.ui)&&void 0!==i?i:{},n=Number.isFinite(Number(l.titleFontSize))?Number(l.titleFontSize):14,o=Number.isFinite(Number(l.msgFontSize))?Number(l.msgFontSize):12;Number.isFinite(Number(l.statusFontSize))&&Number(l.statusFontSize);return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column",minHeight:0},children:[(0,e.jsx)("div",{style:{fontWeight:800,fontSize:n,marginBottom:10},children:t.title}),t.rows.length?(0,e.jsx)("div",{style:{display:"grid",gap:8},children:t.rows.map((t,i)=>(0,e.jsx)(S,{label:t.label,value:t.value,labelSize:12,valueSize:13},i))}):(0,e.jsx)("div",{style:Object.assign({},y("info",o)),children:t.emptyText||"Configura i campi nelle impostazioni."})]})}function G(i){var l,n,r,a,d,c,b,y,m,h,x,S,j;const{active:w,ui:z}=i,T=t.React.useMemo(()=>L(i.tabFields,i.tabs),[i.tabs,i.tabFields]),R=(null!=(null===(l=null==w?void 0:w.state)||void 0===l?void 0:l.oid)&&(w.key,w.state.oid),null===(n=null==w?void 0:w.state)||void 0===n?void 0:n.ds),C=(null===(r=null==w?void 0:w.state)||void 0===r?void 0:r.data)||null,I=null!==(d=null===(a=null==w?void 0:w.state)||void 0===a?void 0:a.oid)&&void 0!==d?d:null,_=null!=I&&Number.isFinite(I),N=t.React.useMemo(()=>{var e,t;if(!_||!C)return"";const i=null!==(t=null!==(e=C.origine_pratica)&&void 0!==e?e:C.Origine_pratica)&&void 0!==t?t:C.ORIGINE_PRATICA;let l="TR";return 2===i||"2"===i||"TI"===String(i).toUpperCase()?l="TI":1!==i&&"1"!==i&&"TR"!==String(i).toUpperCase()||(l="TR"),`${l}-${I}`},[_,C,I]),[A,k]=t.React.useState((null===(c=T[0])||void 0===c?void 0:c.id)||"anagrafica"),D=_&&null!=I?Number(I):null,[F,B]=t.React.useState(null),[E,$]=t.React.useState([]),[G,H]=t.React.useState(!1),[J,U]=t.React.useState(null),V=t.React.useCallback(e=>{if(null==e||isNaN(Number(e)))return"";const t=Number(e);if(t<1024)return`${t} B`;const i=t/1024;if(i<1024)return`${i.toFixed(1)} KB`;const l=i/1024;if(l<1024)return`${l.toFixed(1)} MB`;return`${(l/1024).toFixed(1)} GB`},[]),Z=t.React.useCallback(()=>o(this,void 0,void 0,function*(){if(D)try{H(!0),U(null);const e=R,t=yield u(e);if(!t)return $([]),B(D),void U("Non riesco a risalire al FeatureLayer per leggere gli allegati (datasource/vista non espone il layer JS API).");const i=yield t.queryAttachments({objectIds:[D],returnMetadata:!0,returnUrl:!0}),l=e=>e?Array.isArray(e)?e:Array.isArray(e.attachmentInfos)?e.attachmentInfos:Array.isArray(e.attachments)?e.attachments:[]:[];let n=[];if(Array.isArray(i))for(const e of i){if(!e)continue;if((null!=e.parentObjectId?e.parentObjectId:null!=e.objectId?e.objectId:null)===D){n=l(e);break}}else if(i&&"object"==typeof i)if(Array.isArray(i.attachmentGroups))for(const e of i.attachmentGroups){if((e&&null!=e.parentObjectId?e.parentObjectId:e&&null!=e.objectId?e.objectId:null)===D){n=l(e);break}}else i[D]?n=l(i[D]):i[String(D)]?n=l(i[String(D)]):i.attachmentInfos&&(n=l(i));const o=(n||[]).map(e=>({id:Number(e.id),name:e.name,size:e.size,contentType:e.contentType,url:e.url})).filter(e=>e&&!isNaN(e.id));$(o),B(D)}catch(e){$([]),B(D),U((null==e?void 0:e.message)||String(e))}finally{H(!1)}}),[R,D]);t.React.useEffect(()=>{"allegati"===A&&null!=D&&F!==D&&Z()},[A,D,F]);const[q,K]=t.React.useState({}),[Y,Q]=t.React.useState(!1);t.React.useEffect(()=>{var e;let t=!1;Q(!1);try{const i=null===(e=null==R?void 0:R.getSchema)||void 0===e?void 0:e.call(R),l=(null==i?void 0:i.fields)||{},n={};for(const e of Object.keys(l)){const t=l[e],i=String((null==t?void 0:t.alias)||(null==t?void 0:t.label)||(null==t?void 0:t.title)||e);n[e]=i}!t&&Object.keys(n).length&&(K(n),Q(!0))}catch(e){}return(()=>{o(this,void 0,void 0,function*(){var e,i,l;if(R)try{const n=(null===(e=null==R?void 0:R.getLayer)||void 0===e?void 0:e.call(R))||(null===(i=null==R?void 0:R.getJSAPILayer)||void 0===i?void 0:i.call(R))||(null==R?void 0:R.layer)||(null===(l=null==R?void 0:R.createJSAPILayerByDataSource)||void 0===l?void 0:l.call(R))||null,o=s(yield Promise.resolve(n)),r=(null==o?void 0:o.fields)||[],a={};for(const e of r){const t=String((null==e?void 0:e.name)||"");t&&(a[t]=String((null==e?void 0:e.alias)||(null==e?void 0:e.label)||(null==e?void 0:e.title)||t))}t||(Object.keys(a).length&&K(a),Q(!0))}catch(e){t||Q(!0)}else t||(K({}),Q(!0))})})(),()=>{t=!0}},[R]);const X=t.React.useCallback(e=>{const t=null==q?void 0:q[e];return Y?t?`${t}`:e:""},[q,Y]),ee=t.React.useCallback((e,t)=>v(e,t),[]),te=t.React.useCallback(e=>{const t=`${g(e)} ${g((null==q?void 0:q[e])||"")}`.trim(),i=p(t,"nome")||t.startsWith("nome "),l=p(t,"cognome")||t.startsWith("cognome "),n=p(t,"cf")||p(t,"c f")||p(t,"c f ")||p(t,"codice fiscale")||t.includes("cod")&&t.includes("fisc");return Boolean(i||l||n)},[q]),ie=t.React.useCallback(e=>{const t=`${g(e)} ${g((null==q?void 0:q[e])||"")}`.trim(),i=p(t,"ragione sociale")||p(t,"denominazione")||t.includes("ragione")&&t.includes("social"),l=p(t,"partita iva")||p(t,"p iva")||p(t,"piva")||t.includes("partita")&&t.includes("iva");return Boolean(i||l)},[q]),le=t.React.useCallback((e,t,i)=>{const l=e&&e.length?e:function(e,t){if(!e)return[];const i=Object.keys(e).filter(e=>!/^objectid$/i.test(e)&&!/^globalid$/i.test(e)&&!/^shape/i.test(e)),l=e=>i.filter(t=>e.test(t));if("ANAGRAFICA"===t)return l(/ditta|denom|ragione|nome|cognome|cf|cod.*fisc|piva|partita|indir|via|cap|comune|prov|telefono|cell|mail|pec/i).slice(0,16);if("VIOLAZIONE"===t)return l(/viol|infraz|descr|art|norm|tipo|sanz|import|acqua|volume|turno|utenza|contatore/i).slice(0,16);if("ALLEGATI"===t)return l(/alleg|foto|doc|file|url|link|pdf|jpg|png/i).slice(0,16);return[]}(C,t),n=C&&null!=C.__tipo_soggetto_raw?C.__tipo_soggetto_raw:C&&null!=C.tipo_soggetto?C.tipo_soggetto:null,o=C&&null!=C.__tipo_soggetto_label?C.__tipo_soggetto_label:null,r="ANAGRAFICA"===t?ee(n,o):null,a="ANAGRAFICA"===t&&r?l.filter(e=>!!e&&(("PF"!==r||!ie(e))&&("PG"!==r||!te(e)))):l,d=[];for(const e of a){if(!e)continue;const t=C?C[e]:null;i&&f(t)||d.push({label:X(e),value:t})}return d},[C,X,ee,te,ie]),ne=C?C.presa_in_carico_DT:null,oe=C?C.dt_presa_in_carico_DT:null,re=C?C.stato_DT:null,ae=C?C.dt_stato_DT:null,de=C?C.esito_DT:null,se=C?C.dt_esito_DT:null,ue=C?C.note_DT:null,ce=C?C.presa_in_carico_DA:null,ge=C?C.dt_presa_in_carico_DA:null,fe=C?C.stato_DA:null,pe=C?C.dt_stato_DA:null,ve=C?C.esito_DA:null,be=C?C.dt_esito_DA:null,ye=C?C.note_DA:null,me=(0,e.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,padding:"8px 12px",alignItems:"center",borderBottom:"1px solid rgba(0,0,0,0.08)",background:"var(--bs-body-bg, #fff)",marginTop:-z.panelPadding,marginLeft:-z.panelPadding,marginRight:-z.panelPadding,width:`calc(100% + ${2*z.panelPadding}px)`,borderTopLeftRadius:z.panelBorderRadius,borderTopRightRadius:z.panelBorderRadius},children:T.map(t=>(0,e.jsx)(W,{active:A===t.id,label:t.label,onClick:()=>k(t.id),disabled:!_},t.id))}),he={width:"100%",height:"100%",flex:"1 1 auto",display:"flex",flexDirection:"column",minHeight:0,boxSizing:"border-box",background:z.panelBg,border:`${z.panelBorderWidth}px solid ${z.panelBorderColor}`,borderRadius:z.panelBorderRadius,padding:z.panelPadding};let xe=null;if(_){const t=T.find(e=>e.id===A);if("azioni"===(null==t?void 0:t.id))xe=(0,e.jsx)(P,{active:w,roleCode:i.roleCode,buttonText:i.buttonText,buttonColors:i.buttonColors,ui:i.ui,editConfig:i.editConfig});else if(null==t?void 0:t.isIterTab){const i=[];i.push({label:"DT - Presa in carico",value:ne}),i.push({label:"DT - Data presa in carico",value:O(oe)}),i.push({label:"DT - Stato",value:re}),i.push({label:"DT - Data stato",value:O(ae)}),i.push({label:"DT - Esito",value:de}),i.push({label:"DT - Data esito",value:O(se)}),i.push({label:"DT - Note",value:ue}),i.push({label:"DA - Presa in carico",value:ce}),i.push({label:"DA - Data presa in carico",value:O(ge)}),i.push({label:"DA - Stato",value:fe}),i.push({label:"DA - Data stato",value:O(pe)}),i.push({label:"DA - Esito",value:ve}),i.push({label:"DA - Data esito",value:O(be)}),i.push({label:"DA - Note",value:ye});(Y?le(t.fields,t.id.toUpperCase(),Boolean(t.hideEmpty)):[]).forEach(e=>i.push(e)),xe=(0,e.jsx)(M,{title:t.label,ui:z,rows:i})}else if(t){const i=Y?le(t.fields,t.id.toUpperCase(),Boolean(t.hideEmpty)):[];if("allegati"===t.id){const l=R,n=s((l&&"function"==typeof l.getLayer?l.getLayer():null)||(l&&"function"==typeof l.getJsApiLayer?l.getJsApiLayer():null)||l&&l.layer||l),o=n&&n.url?String(n.url):"",r=e=>e&&e.url?String(e.url):o&&null!=D&&e&&null!=e.id?`${o}/${D}/attachments/${e.id}`:null;xe=(0,e.jsxs)("div",{style:{marginTop:8},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[(0,e.jsx)("div",{style:{fontWeight:700,fontSize:13},children:"Allegati"}),(0,e.jsx)("button",{type:"button",onClick:()=>Z(),disabled:!_||G,onMouseEnter:e=>{_&&!G&&(e.currentTarget.style.background="#eaf2ff",e.currentTarget.style.borderColor="#2f6fed",e.currentTarget.style.color="#1d4ed8")},onMouseLeave:e=>{_&&!G&&(e.currentTarget.style.background="#fff",e.currentTarget.style.borderColor="rgba(0,0,0,0.12)",e.currentTarget.style.color="#111827")},style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.12)",background:"#fff",color:"#111827",cursor:!_||G?"not-allowed":"pointer",fontSize:12,fontWeight:600,transition:"all 0.15s ease"},children:"Aggiorna"})]}),!_&&(0,e.jsx)("div",{style:{opacity:.75,fontSize:12},children:"Selezionare un rapporto per vedere gli allegati."}),_&&G&&(0,e.jsx)("div",{style:{opacity:.75,fontSize:12},children:"Caricamento allegati\u2026"}),_&&!G&&J&&(0,e.jsx)("div",{style:{color:"#b00020",fontSize:12},children:J}),_&&!G&&!J&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:E&&E.length?E.map(t=>{const i=r(t),l=[t.contentType,V(t.size)].filter(Boolean).join(" \u2022 ");return(0,e.jsxs)("div",{style:{border:"1px solid rgba(0,0,0,0.08)",borderRadius:12,padding:"8px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[(0,e.jsxs)("div",{style:{minWidth:0},children:[(0,e.jsx)("div",{style:{fontWeight:600,fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name||`Allegato #${t.id}`}),l?(0,e.jsx)("div",{style:{opacity:.7,fontSize:11},children:l}):null]}),i?(0,e.jsx)("a",{href:i,target:"_blank",rel:"noreferrer",onMouseEnter:e=>{e.currentTarget.style.background="#eaf2ff",e.currentTarget.style.borderColor="#2f6fed",e.currentTarget.style.color="#1d4ed8"},onMouseLeave:e=>{e.currentTarget.style.background="#fff",e.currentTarget.style.borderColor="rgba(0,0,0,0.12)",e.currentTarget.style.color="#111827"},style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.12)",background:"#fff",color:"#111827",textDecoration:"none",fontSize:12,fontWeight:600,whiteSpace:"nowrap",transition:"all 0.15s ease"},children:"Apri"}):(0,e.jsx)("span",{style:{opacity:.6,fontSize:12,whiteSpace:"nowrap"},children:"URL non disponibile"})]},t.id)}):(0,e.jsx)("div",{style:{opacity:.75,fontSize:12},children:"Nessun allegato."})}),i&&i.length>0&&(0,e.jsxs)("div",{style:{marginTop:12},children:[(0,e.jsx)("div",{style:{fontWeight:700,fontSize:13,marginBottom:6},children:"Attributi"}),(0,e.jsx)(M,{title:t.label,rows:i,emptyText:_?"Nessun campo configurato per questa tab.":"Selezionare un rapporto."})]})]})}else xe=(0,e.jsx)(M,{title:t.label,rows:i,emptyText:_?"Nessun campo configurato per questa tab.":"Selezionare un rapporto."})}}else xe=(0,e.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",minHeight:200,fontWeight:700,fontSize:14,color:"rgba(0,0,0,0.6)"},children:"Selezionare un rapporto nell'elenco"});return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",minHeight:0,boxSizing:"border-box"},children:[(0,e.jsx)("div",{style:{height:null!==(b=z.detailTitleHeight)&&void 0!==b?b:28,paddingBottom:null!==(y=z.detailTitlePaddingBottom)&&void 0!==y?y:10,paddingLeft:null!==(m=z.detailTitlePaddingLeft)&&void 0!==m?m:0,display:"flex",alignItems:"center",boxSizing:"border-box",flex:"0 0 auto"},children:(0,e.jsxs)("span",{style:{fontSize:null!==(h=z.detailTitleFontSize)&&void 0!==h?h:14,fontWeight:null!==(x=z.detailTitleFontWeight)&&void 0!==x?x:600,color:_&&N?null!==(S=z.detailTitleColor)&&void 0!==S?S:"rgba(0,0,0,0.85)":"rgba(0,0,0,0.40)"},children:[String(null!==(j=z.detailTitlePrefix)&&void 0!==j?j:"Dettaglio rapporto n.")," ",_&&N?N:"\u2013"]})}),(0,e.jsxs)("div",{style:he,children:[(0,e.jsx)("div",{style:{flex:"0 0 auto"},children:me}),(0,e.jsx)("div",{style:{flex:"1 1 auto",minHeight:0,overflowY:"auto"},children:xe})]})]})}function H(i){var l,o,r,a,d,s,u,c,g,f,p,v,b,y,x,S,j,w,z,T,R,C,I;const _=i.config&&i.config.asMutable?i.config.asMutable({deep:!0}):i.config||{},N=Object.assign(Object.assign({},n),_),[A,k]=t.React.useState("");t.React.useEffect(()=>{var e;try{const t=null===(e=window.__giiUserRole)||void 0===e?void 0:e.ruoloLabel;t&&"ADMIN"!==t&&k(String(t).toUpperCase())}catch(e){}let t=0;const i=setInterval(()=>{var e;t++;try{const t=null===(e=window.__giiUserRole)||void 0===e?void 0:e.ruoloLabel;t&&"ADMIN"!==t&&(k(String(t).toUpperCase()),clearInterval(i))}catch(e){}t>=20&&clearInterval(i)},500);return()=>clearInterval(i)},[]);const D=A||String(N.roleCode||"DT").toUpperCase(),F=String(N.buttonText||"Prendi in carico"),E={take:B(N.takeColor,n.takeColor),integrazione:B(N.integrazioneColor,n.integrazioneColor),approva:B(N.approvaColor,n.approvaColor),respingi:B(N.respingiColor,n.respingiColor),trasmetti:B(N.trasmettiColor,n.trasmettiColor)},P={panelBg:String(null!==(r=null!==(o=null!==(l=N.maskBg)&&void 0!==l?l:N.panelBg)&&void 0!==o?o:n.maskBg)&&void 0!==r?r:n.panelBg),panelBorderColor:String(null!==(s=null!==(d=null!==(a=N.maskBorderColor)&&void 0!==a?a:N.panelBorderColor)&&void 0!==d?d:n.maskBorderColor)&&void 0!==s?s:n.panelBorderColor),panelBorderWidth:Number.isFinite(Number(null!==(u=N.maskBorderWidth)&&void 0!==u?u:N.panelBorderWidth))?Number(null!==(c=N.maskBorderWidth)&&void 0!==c?c:N.panelBorderWidth):null!==(g=n.maskBorderWidth)&&void 0!==g?g:n.panelBorderWidth,panelBorderRadius:Number.isFinite(Number(null!==(f=N.maskBorderRadius)&&void 0!==f?f:N.panelBorderRadius))?Number(null!==(p=N.maskBorderRadius)&&void 0!==p?p:N.panelBorderRadius):null!==(v=n.maskBorderRadius)&&void 0!==v?v:n.panelBorderRadius,panelPadding:Number.isFinite(Number(null!==(b=N.maskInnerPadding)&&void 0!==b?b:N.panelPadding))?Number(null!==(y=N.maskInnerPadding)&&void 0!==y?y:N.panelPadding):null!==(x=n.maskInnerPadding)&&void 0!==x?x:n.panelPadding,dividerColor:String(null!==(S=N.dividerColor)&&void 0!==S?S:n.dividerColor),titleFontSize:Number.isFinite(Number(N.titleFontSize))?Number(N.titleFontSize):n.titleFontSize,statusFontSize:Number.isFinite(Number(N.statusFontSize))?Number(N.statusFontSize):n.statusFontSize,msgFontSize:Number.isFinite(Number(N.msgFontSize))?Number(N.msgFontSize):n.msgFontSize,rejectReasons:Array.isArray(N.rejectReasons)?N.rejectReasons.map(e=>String(e)):n.rejectReasons,reasonsZebraOddBg:String(null!==(j=N.reasonsZebraOddBg)&&void 0!==j?j:n.reasonsZebraOddBg),reasonsZebraEvenBg:String(null!==(w=N.reasonsZebraEvenBg)&&void 0!==w?w:n.reasonsZebraEvenBg),reasonsRowBorderColor:String(null!==(z=N.reasonsRowBorderColor)&&void 0!==z?z:n.reasonsRowBorderColor),reasonsRowBorderWidth:Number.isFinite(Number(N.reasonsRowBorderWidth))?Number(N.reasonsRowBorderWidth):n.reasonsRowBorderWidth,reasonsRowRadius:Number.isFinite(Number(N.reasonsRowRadius))?Number(N.reasonsRowRadius):n.reasonsRowRadius,detailTitlePrefix:String(null!==(T=N.detailTitlePrefix)&&void 0!==T?T:n.detailTitlePrefix),detailTitleHeight:Number.isFinite(Number(N.detailTitleHeight))?Number(N.detailTitleHeight):n.detailTitleHeight,detailTitlePaddingBottom:Number.isFinite(Number(N.detailTitlePaddingBottom))?Number(N.detailTitlePaddingBottom):n.detailTitlePaddingBottom,detailTitlePaddingLeft:Number.isFinite(Number(N.detailTitlePaddingLeft))?Number(N.detailTitlePaddingLeft):n.detailTitlePaddingLeft,detailTitleFontSize:Number.isFinite(Number(N.detailTitleFontSize))?Number(N.detailTitleFontSize):n.detailTitleFontSize,detailTitleFontWeight:Number.isFinite(Number(N.detailTitleFontWeight))?Number(N.detailTitleFontWeight):n.detailTitleFontWeight,detailTitleColor:String(null!==(R=N.detailTitleColor)&&void 0!==R?R:n.detailTitleColor)},O={anagrafica:$(N.anagraficaFields),violazione:$(N.violazioneFields),allegati:$(N.allegatiFields),iterExtra:$(N.iterExtraFields)},W=L(O,N.tabs||[]),M={show:!1!==N.showEditButtons,overlayColor:B(N.editOverlayColor,"#7c3aed"),pageColor:B(N.editPageColor,"#5b21b6"),pageId:String(N.editPageId||"editing-ti"),fieldStatoTI:String(N.fieldStatoTI||"stato_TI"),fieldPresaTI:String(N.fieldPresaTI||"presa_in_carico_TI"),minStato:Number.isFinite(Number(N.editMinStato))?Number(N.editMinStato):2,maxStato:Number.isFinite(Number(N.editMaxStato))?Number(N.editMaxStato):2,presaRequiredVal:Number.isFinite(Number(N.editPresaRequiredVal))?Number(N.editPresaRequiredVal):2};if(!i.useDataSources||!i.useDataSources.length)return(0,e.jsx)("div",{style:{padding:Number.isFinite(Number(null!==(C=N.maskOuterOffset)&&void 0!==C?C:0))?Number(N.maskOuterOffset):0},children:"Configura il data source nelle impostazioni del widget."});const H=["presa_in_carico_DT","dt_presa_in_carico_DT","stato_DT","dt_stato_DT","esito_DT","dt_esito_DT","note_DT","presa_in_carico_DA","dt_presa_in_carico_DA","stato_DA","dt_stato_DA","esito_DA","dt_esito_DA","note_DA"],[J,U]=t.React.useState({}),[V,Z]=t.React.useState(null),q=t.React.useCallback((e,t)=>{U(i=>{const l=i[e];return l&&l.sig===t.sig&&l.ds===t.ds&&l.idFieldName===t.idFieldName?i:Object.assign(Object.assign({},i),{[e]:t})}),null!=t.oid&&Z(e)},[]),K=t.React.useMemo(()=>{var e;if(V&&null!=(null===(e=J[V])||void 0===e?void 0:e.oid))return{key:V,state:J[V]};for(let e=0;e<i.useDataSources.length;e++){const t=m(i.useDataSources[e],e),l=J[t];if(l&&null!=l.oid)return{key:t,state:l}}return null},[i.useDataSources,J,V]);return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",minHeight:0,boxSizing:"border-box",padding:Number.isFinite(Number(null!==(I=N.maskOuterOffset)&&void 0!==I?I:0))?Number(N.maskOuterOffset):0},children:[i.useDataSources.map((t,l)=>{const n=m(t,l);return(0,e.jsx)(h,{widgetId:i.id,uds:t,dsKey:n,watchFields:H,onUpdate:q},n)}),(0,e.jsx)(G,{active:K,roleCode:D,buttonText:F,buttonColors:E,ui:P,tabFields:O,tabs:W,editConfig:M})]})}function J(e){r.p=e}})(),a})())}}});