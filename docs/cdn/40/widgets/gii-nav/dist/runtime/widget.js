System.register(["jimu-core/emotion","jimu-core"],function(e,o){var r={},t={};return{setters:[function(e){r.jsx=e.jsx,r.jsxs=e.jsxs},function(e){t.Immutable=e.Immutable,t.React=e.React,t.SessionManager=e.SessionManager,t.UrlManager=e.UrlManager,t.getAppStore=e.getAppStore}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=t},386:e=>{"use strict";e.exports=r}},o={};function n(r){var t=o[r];if(void 0!==t)return t.exports;var i=o[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,o)=>{for(var r in o)n.o(o,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},n.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var i={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(i),n.d(i,{__set_webpack_public_path__:()=>b,default:()=>m});var e=n(386),o=n(244);const r={direction:"vertical",gap:8,itemBorderRadius:12,itemPadding:14,labelSize:14,labelWeight:600,labelFont:"'Trebuchet MS', sans-serif",items:[{id:"nav_home",visible:!0,order:1,label:"Home",hashPage:"home",colorBg:"#0d2444",colorAccent:"#60a5fa",colorBgRest:"rgba(255,255,255,0.05)",colorBgHover:"#0d2444",roles:["*"],icon:"home"},{id:"nav_elenco",visible:!0,order:2,label:"Elenco Pratiche",hashPage:"elenco",colorBg:"#0c329d",colorAccent:"#6fa5fb",colorBgRest:"rgba(255,255,255,0.05)",colorBgHover:"#0c329dee",roles:["*"],icon:"elenco"},{id:"nav_nuova",visible:!0,order:3,label:"Nuova Pratica",hashPage:"nuova",colorBg:"#7c2d12",colorAccent:"#f97316",colorBgRest:"rgba(255,255,255,0.05)",colorBgHover:"#7c2d12ee",roles:["TI","ADMIN"],icon:"nuova"},{id:"nav_mappa",visible:!0,order:4,label:"Mappa",hashPage:"mappa",colorBg:"#14532d",colorAccent:"#22c55e",colorBgRest:"rgba(255,255,255,0.05)",colorBgHover:"#14532dee",roles:["*"],icon:"mappa"},{id:"nav_dashboard",visible:!0,order:5,label:"Dashboard",hashPage:"dashboard",colorBg:"#858519",colorAccent:"#fefe2a",colorBgRest:"rgba(255,255,255,0.05)",colorBgHover:"#858519ee",roles:["RI","DT","DA","ADMIN"],icon:"dashboard"},{id:"nav_report",visible:!0,order:6,label:"Report",hashPage:"report",colorBg:"#4a1d96",colorAccent:"#b79ffe",colorBgRest:"rgba(255,255,255,0.05)",colorBgHover:"#4a1d96ee",roles:["RI","DT","DA","ADMIN"],icon:"report"}]};(0,o.Immutable)(r);var t=function(e,o,r,t){return new(r||(r=Promise))(function(n,i){function l(e){try{s(t.next(e))}catch(e){i(e)}}function a(e){try{s(t.throw(e))}catch(e){i(e)}}function s(e){var o;e.done?n(e.value):(o=e.value,o instanceof r?o:new r(function(e){e(o)})).then(l,a)}s((t=t.apply(e,o||[])).next())})};const l="https://cbsm-hub.maps.arcgis.com",a="https://services2.arcgis.com/vH5RykSdaAwiEGOJ/arcgis/rest/services/GII_uteniti/FeatureServer/0",s={1:"TR",2:"TI",3:"RZ",4:"RI",5:"DT",6:"DA"},c={TR:"Tecnico Rilevatore",TI:"Tecnico Istruttore",RZ:"Responsabile di Zona",RI:"Responsabile Istruttore",DT:"Direttore Tecnico",DA:"Direttore Amministrativo",ADMIN:"Amministratore"},u={1:"AMM",2:"AGR",3:"TEC"};function d(e){return new Promise((o,r)=>{const t=window.require;if(t)try{t([e],e=>o(e),e=>r(e))}catch(e){r(e)}else r(new Error("AMD"))})}function g(){return t(this,void 0,void 0,function*(){var e,r,n;const i=window.__giiUserRole;if(null==i?void 0:i.username){const o=i.ruoloLabel||(null!==(e=s[i.ruolo])&&void 0!==e?e:"ADMIN");return{username:i.username,fullName:i.fullName||i.username,ruoloLabel:o,ruoloFull:c[o]||o,area:u[i.area]||"",isAdmin:i.isAdmin||!1}}try{const e=yield function(){return t(this,void 0,void 0,function*(){var e,r;try{const t=o.SessionManager.getInstance(),n=(null===(e=null==t?void 0:t.getMainSession)||void 0===e?void 0:e.call(t))||(null===(r=null==t?void 0:t.getSessionByUrl)||void 0===r?void 0:r.call(t,l));if(n){const e="string"==typeof n.token?n.token:null;if(e)return e;if("function"==typeof n.getToken)return String((yield n.getToken(`${l}/sharing/rest`))||"")}}catch(e){}try{const e=((yield d("esri/identity/IdentityManager")).credentials||[]).slice().sort((e,o)=>((null==o?void 0:o.expires)||0)-((null==e?void 0:e.expires)||0))[0];if(null==e?void 0:e.token)return e.token}catch(e){}return""})}();if(!e)return null;const i=yield fetch(`${l}/sharing/rest/community/self?f=json&token=${encodeURIComponent(e)}`),g=yield i.json(),v=(null==g?void 0:g.username)||"";if(!v)return null;const p=(null==g?void 0:g.fullName)||v,h="org_admin"===(null==g?void 0:g.role),f=new(yield d("esri/layers/FeatureLayer"))({url:a});yield f.load().catch(()=>{});const m=yield f.queryFeatures({where:`username = '${v.replace(/'/g,"''")}'`,outFields:["ruolo","area","full_name"],returnGeometry:!1}),b=null===(r=null==m?void 0:m.features)||void 0===r?void 0:r[0];if(!b&&h)return{username:v,fullName:p,ruoloLabel:"ADMIN",ruoloFull:"Amministratore",area:"",isAdmin:!0};if(!b)return{username:v,fullName:p,ruoloLabel:"",ruoloFull:"",area:"",isAdmin:!1};const y=b.attributes,x=null!=y.ruolo?Number(y.ruolo):null,w=x?null!==(n=s[x])&&void 0!==n?n:"":h?"ADMIN":"";return{username:v,fullName:String(y.full_name||p),ruoloLabel:w,ruoloFull:c[w]||w,area:u[y.area]||"",isAdmin:h}}catch(e){return null}})}function v(e){var r,t,n,i;const l=(e||"").trim();if(!l)return null;let a=l.replace(/^#+\/?/,"").replace(/^\/+/,"");a.startsWith("page/")&&(a=a.slice(5));try{const e=null===(t=null===(r=(0,o.getAppStore)())||void 0===r?void 0:r.getState)||void 0===t?void 0:t.call(r),l=null==e?void 0:e.appConfig,s=null!==(n=null==l?void 0:l.pages)&&void 0!==n?n:{},c=(null==s?void 0:s.asMutable)?s.asMutable({deep:!0}):(null==s?void 0:s.toJS)?s.toJS():s;if(c&&c[a])return a;const u=(null===(i=null==l?void 0:l.historyLabels)||void 0===i?void 0:i.page)||{};for(const[e,o]of Object.entries(c||{}))if(o){if(o.name===a)return e;if(u&&u[e]===a)return e;if(o.label===a||o.title===a)return e}}catch(e){}return null}const p={home:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>',elenco:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="3"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>',nuova:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>',mappa:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>',dashboard:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="13" width="8" height="8" rx="1.5"/><rect x="14" y="13" width="8" height="8" rx="1.5"/><rect x="2" y="3" width="8" height="8" rx="1.5"/><rect x="14" y="3" width="8" height="8" rx="1.5"/></svg>',report:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>'},h='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/></svg>';function f(r){const{item:t,cfg:n,currentPageId:i}=r,[l,a]=o.React.useState(!1),s=t.hashPage?v(t.hashPage):null,c=l||!!i&&!!s&&i===s,u=p[t.icon]||h;return(0,e.jsxs)("div",{onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:()=>{t.hashPage&&function(e){const r=v(e);if(r)return void o.UrlManager.getInstance().changePage(r);const t=(e||"").trim().replace(/^#+\/?/,"").replace(/^\/+/,""),n=t.startsWith("page/")?t.slice(5):t;window.location.hash=`#/page/${n}`}(t.hashPage)},style:{cursor:"pointer",borderRadius:n.itemBorderRadius,border:`1.5px solid ${c?t.colorAccent:"rgba(255,255,255,0.10)"}`,background:c?t.colorBgHover||`linear-gradient(135deg,${t.colorBg}ee 0%,${t.colorBg}cc 100%)`:t.colorBgRest||"rgba(255,255,255,0.05)",backdropFilter:"blur(12px)",padding:n.itemPadding,display:"flex",flexDirection:"row",alignItems:"center",gap:10,transition:"all 0.25s cubic-bezier(0.4,0,0.2,1)",transform:l?"translateY(-2px)":"translateY(0)",boxShadow:l?`0 20px 40px rgba(0,0,0,0.3),0 0 0 1px ${t.colorAccent}44`:"0 4px 16px rgba(0,0,0,0.15)",animationName:"fadeInUp",animationDuration:"0.5s",animationDelay:80*r.idx+"ms",animationFillMode:"both",animationTimingFunction:"cubic-bezier(0.4,0,0.2,1)"},children:[(0,e.jsx)("div",{style:{width:28,height:28,borderRadius:7,flexShrink:0,background:l?`${t.colorAccent}33`:"rgba(255,255,255,0.08)",display:"flex",alignItems:"center",justifyContent:"center",color:l?t.colorAccent:"rgba(255,255,255,0.7)",transition:"background 0.25s",padding:4,boxSizing:"border-box"},children:(0,e.jsx)("div",{style:{width:"100%",height:"100%"},dangerouslySetInnerHTML:{__html:u}})}),(0,e.jsx)("span",{style:{fontFamily:n.labelFont,fontSize:n.labelSize,fontWeight:n.labelWeight,color:l?"#fff":"rgba(255,255,255,0.90)",transition:"color 0.2s",textAlign:"left",lineHeight:1.25},children:t.label})]})}function m(t){const n=Object.assign(Object.assign({},r),t.config),i=Array.isArray(n.items)?n.items:r.items,l=()=>{var e,r,t;try{const n=null===(r=null===(e=(0,o.getAppStore)())||void 0===e?void 0:e.getState)||void 0===r?void 0:r.call(e),i=null===(t=null==n?void 0:n.appRuntimeInfo)||void 0===t?void 0:t.currentPageId;if(i)return i}catch(e){}const n=(window.location.hash||"").match(/#\/page\/([^/?#]+)/),i=n?decodeURIComponent(n[1]):"";return i?v(i)||i:null},[a,s]=o.React.useState(()=>l());o.React.useEffect(()=>{const e=()=>s(l());return e(),window.addEventListener("hashchange",e),window.addEventListener("popstate",e),()=>{window.removeEventListener("hashchange",e),window.removeEventListener("popstate",e)}},[]);const[c,u]=o.React.useState(null),[d,p]=o.React.useState(!0);o.React.useEffect(()=>{g().then(e=>{u(e),p(!1)});const e=()=>g().then(e=>u(e));return window.addEventListener("gii:userLoaded",e),()=>window.removeEventListener("gii:userLoaded",e)},[]);const h=[...i].sort((e,o)=>e.order-o.order).filter(e=>!!e.visible&&(!!e.roles.includes("*")||!d&&(!!c&&(!!c.isAdmin||e.roles.includes(c.ruoloLabel)))));return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"horizontal"===n.direction?"row":"column",gap:n.gap,padding:8,boxSizing:"border-box",overflow:"auto"},children:[(0,e.jsx)("style",{children:"\n        @import url('https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap');\n        @keyframes fadeInUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }\n      "}),h.map((o,r)=>(0,e.jsx)(f,{item:o,cfg:n,idx:r,currentPageId:a},o.id))]})}function b(e){n.p=e}})(),i})())}}});