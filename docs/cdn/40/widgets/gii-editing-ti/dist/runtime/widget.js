System.register(["jimu-core/emotion","jimu-core","jimu-arcgis","jimu-ui","jimu-core/react-dom"],function(e,i){var t={},l={},n={},o={},a={};return{setters:[function(e){t.Fragment=e.Fragment,t.jsx=e.jsx,t.jsxs=e.jsxs},function(e){l.DataSourceComponent=e.DataSourceComponent,l.DataSourceManager=e.DataSourceManager,l.Immutable=e.Immutable,l.React=e.React},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){o.Button=e.Button},function(e){a.createPortal=e.createPortal}],execute:function(){e((()=>{var e={244:e=>{"use strict";e.exports=l},321:e=>{"use strict";e.exports=o},386:e=>{"use strict";e.exports=t},581:e=>{"use strict";e.exports=a},686:e=>{"use strict";e.exports=n}},i={};function r(t){var l=i[t];if(void 0!==l)return l.exports;var n=i[t]={exports:{}};return e[t](n,n.exports,r),n.exports}r.d=(e,i)=>{for(var t in i)r.o(i,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:i[t]})},r.o=(e,i)=>Object.prototype.hasOwnProperty.call(e,i),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var d={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(d),r.d(d,{__set_webpack_public_path__:()=>de,default:()=>re});var e=r(386),i=r(244),t=r(686),l=r(321),n=r(581);const o={roleCode:"DT",buttonText:"Prendi in carico",takeColor:"#0078da",integrazioneColor:"#e75a05",approvaColor:"#328c54",respingiColor:"#d13438",trasmettiColor:"#6f42c1",btnBorderRadius:8,btnFontSize:13,btnFontWeight:600,btnPaddingX:16,btnPaddingY:8,panelBg:"#ffffff",panelBorderColor:"#e5e7eb",panelBorderWidth:1,panelBorderRadius:10,panelPadding:12,maskBg:"#ffffff",maskBorderColor:"#e5e7eb",maskBorderWidth:1,maskBorderRadius:10,maskInnerPadding:12,maskOuterOffset:12,dividerColor:"#e5e7eb",titleFontSize:14,statusFontSize:13,msgFontSize:15,detailTitlePrefix:"Dettaglio rapporto n.",detailTitleBg:"transparent",detailTitleHeight:28,detailTitlePaddingBottom:10,detailTitlePaddingLeft:0,detailTitleFontSize:14,detailTitleFontWeight:600,detailTitleColor:"rgba(0,0,0,0.85)",rejectReasons:["Mancanza requisiti","Documentazione incompleta","Dati incoerenti","Richiesta non ammissibile","Altro"],reasonsZebraOddBg:"#ffffff",reasonsZebraEvenBg:"#f6f7f9",reasonsRowBorderColor:"rgba(0,0,0,0.10)",reasonsRowBorderWidth:1,reasonsRowRadius:8,tabs:[{id:"anagrafica",label:"Anagrafica",fields:[],hideEmpty:!1},{id:"violazione",label:"Violazione",fields:[],hideEmpty:!0},{id:"iter",label:"Iter",fields:[],isIterTab:!0,hideEmpty:!1},{id:"allegati",label:"Allegati",fields:[],hideEmpty:!0},{id:"azioni",label:"Azioni",fields:[],locked:!0}],showEditButtons:!0,editOverlayColor:"#7c3aed",editPageColor:"#5b21b6",editPageId:"editing-ti",fieldStatoTI:"stato_TI",fieldPresaTI:"presa_in_carico_TI",editMinStato:2,editMaxStato:2,editPresaRequiredVal:2,showDatiGenerali:!1,enableCreateWithoutSelection:!0,useMapWidgetIds:[],officeLonWgs84:0,officeLatWgs84:0,presets:[],activePresetId:""};(0,i.Immutable)(o);var a=function(e,i,t,l){return new(t||(t=Promise))(function(n,o){function a(e){try{d(l.next(e))}catch(e){o(e)}}function r(e){try{d(l.throw(e))}catch(e){o(e)}}function d(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(a,r)}d((l=l.apply(e,i||[])).next())})},s=function(e,i){var t={};for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&i.indexOf(l)<0&&(t[l]=e[l]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(l=Object.getOwnPropertySymbols(e);n<l.length;n++)i.indexOf(l[n])<0&&Object.prototype.propertyIsEnumerable.call(e,l[n])&&(t[l[n]]=e[l[n]])}return t};function u(e){return e&&(e.layer||e)||null}function c(e){return new Promise((i,t)=>{const l=window.require;if(l)try{l([e],e=>i(e),e=>t(e))}catch(e){t(e)}else t(new Error("AMD require non disponibile"))})}function g(e){return"number"==typeof e&&Number.isFinite(e)}function p(e,i){return{x:e,y:i,spatialReference:{wkid:4326}}}function v(e){return String(null!=e?e:"").trim().toLowerCase()}function f(e){return String(null!=e?e:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g," ").trim().replace(/\s+/g," ")}const b=new Set(["Art12","Art27","Art28","Art30","Art31","Art32","Art33","Art34","Art35","Art36","Art37","Art39"]);function h(e){var i,t;const l=String(null!==(i=null==e?void 0:e.norma15_parziale)&&void 0!==i?i:""),n=String(null!==(t=null==e?void 0:e.norma15_totale)&&void 0!==t?t:"");if("Art15.1"===l||"Art15.2"===l)return 1;if("Art15.3"===n||"Art15.4"===n)return 1;var o;return((o=null==e?void 0:e.norma_violata3)?Array.isArray(o)?o.map(String):String(o).split(/\s+/).filter(Boolean):[]).some(e=>b.has(e))?1:0}function m(e){return null==e||("string"==typeof e?""===e.trim():!!Array.isArray(e)&&0===e.length)}function y(e,i){const t=f(e),l=f(i);if(!l)return!1;var n;return new RegExp(`(^| )${n=l,n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}( |$)`).test(t)}function x(e,i){const t=v(i),l=v(e),n=t||l;return n?n.includes("fisica")||"pf"==n||n.startsWith("pf ")?"PF":n.includes("giurid")||"pg"==n||n.startsWith("pg ")?"PG":"1"==l?"PF":"2"==l?"PG":null:null}function S(e){return a(this,void 0,void 0,function*(){if(!e)return;let i=e;try{for(;i&&i.belongToDataSource;)i=i.belongToDataSource}catch(e){}const t=[];i&&t.push(i);try{const e=(null==i?void 0:i.getAllDerivedDataSources)?i.getAllDerivedDataSources():[];e&&e.length&&t.push(...e)}catch(e){}for(const e of t)try{const i=e.getCurrentQueryParams?e.getCurrentQueryParams():null;e.clearSourceRecords&&e.clearSourceRecords(),e.addVersion&&e.addVersion(),e.load&&(i?yield e.load(i):yield e.load())}catch(e){}})}function j(e,i){const t={fontSize:i,lineHeight:1.35,whiteSpace:"normal"};return"ok"===e?Object.assign(Object.assign({},t),{color:"#1a7f37"}):"err"===e?Object.assign(Object.assign({},t),{color:"#b42318"}):Object.assign(Object.assign({},t),{color:"#4b5563"})}function _(e,i){var t,l,n,o;return String(null!==(o=null!==(n=null!==(l=null!==(t=null==e?void 0:e.dataSourceId)&&void 0!==t?t:null==e?void 0:e.mainDataSourceId)&&void 0!==l?l:null==e?void 0:e.rootDataSourceId)&&void 0!==n?n:null==e?void 0:e.outputDataSourceId)&&void 0!==o?o:`ds_${i}`)}function z(t){const{widgetId:l,uds:n,dsKey:o,watchFields:a,onUpdate:r}=t,d=i.React.useCallback(e=>{if(!e)return;const i=(null==e?void 0:e.getIdField)?e.getIdField():"OBJECTID";r(o,{ds:e,oid:null,idFieldName:i,data:null,sig:"ds_ready"})},[o,r]);return(0,e.jsx)(i.DataSourceComponent,{useDataSource:n,widgetId:l,onDataSourceCreated:d,children:i=>(0,e.jsx)(w,{ds:i,dsKey:o,watchFields:a,onUpdate:r})})}function w(e){var t,l;const{ds:n,dsKey:o,watchFields:a,onUpdate:r}=e;i.React.useEffect(()=>{var e;try{null===(e=null==n?void 0:n.setListenSelection)||void 0===e||e.call(n,!0)}catch(e){}},[n]);const d=(null===(t=null==n?void 0:n.getSelectedRecords)||void 0===t?void 0:t.call(n))||[],s=d.length?d[0]:null;let u=(null==s?void 0:s.getData)?s.getData():null;const c=function(e){var i;try{const t=null===(i=null==e?void 0:e.getSchema)||void 0===i?void 0:i.call(e),l=(null==t?void 0:t.fields)||{},n=Object.keys(l);if(!n.length)return null;const o=["tipo_soggetto","TIPO_SOGGETTO","tipoSoggetto","TipoSoggetto","tipo_sogg","TIPO_SOGG","tipo","TIPO"];for(const e of o)if(e&&l[e])return e;for(const e of n){const i=l[e],t=v((null==i?void 0:i.alias)||(null==i?void 0:i.label)||(null==i?void 0:i.title)||""),n=v(e);if(n.includes("tipo")&&n.includes("sogg")||t.includes("tipo soggetto")||t.includes("tipologia soggetto"))return e}return n.find(e=>{const i=v(e);return i.includes("tipo")&&i.includes("sogg")})||null}catch(e){return null}}(n);let g=null,p=null,f=null;try{c&&(null==s?void 0:s.getFieldValue)&&(g=s.getFieldValue(c))}catch(e){}try{c&&null!=g&&(p=function(e,i,t){var l,n,o,a,r;try{const d=null===(l=null==e?void 0:e.getSchema)||void 0===l?void 0:l.call(e),s=null===(n=null==d?void 0:d.fields)||void 0===n?void 0:n[i],u=null===(o=null==s?void 0:s.domain)||void 0===o?void 0:o.codedValues;if(!u||!Array.isArray(u))return null;for(const e of u){const i=null==e?void 0:e.code;if(i==t)return String(null!==(a=null==e?void 0:e.name)&&void 0!==a?a:"");if(String(i)===String(t))return String(null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"")}return null}catch(e){return null}}(n,c,g))}catch(e){}f=x(g,p),c&&(u=Object.assign(Object.assign({},u||{}),{__tipo_soggetto_field:c,__tipo_soggetto_raw:g,__tipo_soggetto_label:p,__tipo_soggetto_kind:f}));const b=(null==n?void 0:n.getIdField)?n.getIdField():"OBJECTID",h=function(e,i){var t,l,n,o;return e?i&&null!=e[i]?e[i]:null!==(o=null!==(n=null!==(l=null!==(t=e.OBJECTID)&&void 0!==t?t:e.ObjectId)&&void 0!==l?l:e.objectid)&&void 0!==n?n:e.objectId)&&void 0!==o?o:null:null}(u,b),m=null!=h?Number(h):null,y=[];y.push(String(null!=m?m:""));for(const e of a)y.push(String(null!==(l=null==u?void 0:u[e])&&void 0!==l?l:""));const S=y.join("|");return i.React.useEffect(()=>{r(o,{ds:n,oid:null!=m&&Number.isFinite(m)?m:null,idFieldName:b,data:null!=m&&Number.isFinite(m)?u:null,sig:S})},[o,n,b,S]),null}function A(i){return(0,e.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"200px 1fr",gap:12,alignItems:"baseline"},children:[(0,e.jsx)("div",{style:{fontSize:i.labelSize,color:"#6b7280",textAlign:"left"},children:i.label}),(0,e.jsx)("div",{style:{fontSize:i.valueSize,fontWeight:600,wordBreak:"break-word"},children:null!=i.value&&""!==i.value?String(i.value):"\u2014"})]})}function C(t){const[l,o]=i.React.useState(!1),[a,r]=i.React.useState(null),d=i.React.useRef(null),s=i.React.useRef(null),u=Array.isArray(t.options)?t.options:[],c=t.value?t.value:t.placeholder||"\u2014 seleziona \u2014",g=`${Math.max(0,Number(t.borderWidth)||0)}px solid ${t.borderColor||"rgba(0,0,0,0.10)"}`,p=i.React.useCallback(()=>{const e=d.current;if(!e)return;const i=(e.querySelector("button")||e).getBoundingClientRect(),t=window.innerHeight-i.bottom-8,l=i.top-8,n=t<180&&l>t,o=Math.min(280,Math.max(140,(n?l:t)-12));r({left:i.left,width:i.width,openUp:n,top:i.bottom+6,bottom:window.innerHeight-i.top+6,maxHeight:o})},[]);i.React.useEffect(()=>{if(!l)return;p();const e=e=>{const i=d.current,t=s.current;if(!i||!t)return;const l=e.target;i.contains(l)||t.contains(l)||o(!1)},i=e=>{"Escape"===(null==e?void 0:e.key)&&o(!1)},t=()=>p(),n=()=>p();return document.addEventListener("mousedown",e,!0),document.addEventListener("keydown",i,!0),window.addEventListener("resize",t,!0),window.addEventListener("scroll",n,!0),()=>{document.removeEventListener("mousedown",e,!0),document.removeEventListener("keydown",i,!0),window.removeEventListener("resize",t,!0),window.removeEventListener("scroll",n,!0)}},[l,p]);const v=l&&!t.disabled&&a?(0,n.createPortal)((0,e.jsxs)("div",{ref:s,style:{position:"fixed",left:a.left,width:a.width,top:a.openUp?"auto":a.top,bottom:a.openUp?a.bottom:"auto",zIndex:2e5,border:g,borderRadius:Math.max(0,Number(t.radius)||0),overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.12)",background:"#ffffff",maxHeight:a.maxHeight,overflowY:"auto"},children:[(0,e.jsx)("div",{onClick:()=>{t.onChange(""),o(!1)},style:{padding:"8px 10px",cursor:"pointer",fontSize:t.fontSize,backgroundColor:t.evenBg||"#ffffff",borderBottom:g,opacity:.9},title:"Svuota selezione",children:"\u2014 seleziona \u2014"}),u.map((i,l)=>{const n=l%2==0?t.evenBg||"#f6f7f9":t.oddBg||"#ffffff",a=String(i)===String(t.value||"");return(0,e.jsx)("div",{onClick:()=>{t.onChange(String(i)),o(!1)},style:{padding:"8px 10px",cursor:"pointer",fontSize:t.fontSize,backgroundColor:n,borderBottom:l===u.length-1?"none":g,fontWeight:a?700:400},children:String(i)},`${i}-${l}`)})]}),document.body):null,f=t.isError?"1px solid #b42318":"1px solid rgba(0,0,0,0.20)";return(0,e.jsxs)("div",{ref:d,style:{position:"relative",width:"100%"},children:[(0,e.jsxs)("button",{type:"button",disabled:!!t.disabled,onClick:()=>{t.disabled||o(e=>{const i=!e;return i&&p(),i})},style:{width:"100%",padding:"8px 10px",borderRadius:8,border:f,background:t.disabled?"#f3f4f6":"#ffffff",color:t.disabled?"#9ca3af":"#111827",cursor:t.disabled?"not-allowed":"pointer",textAlign:"left",display:"flex",alignItems:"center",gap:10},children:[(0,e.jsx)("span",{style:{flex:1,fontSize:t.fontSize},children:c}),(0,e.jsx)("span",{style:{fontSize:t.fontSize,opacity:.75},children:"\u25be"})]}),v]})}const R=1;function T(e,i){const t=(null==i?void 0:i.fields)||[];if(!t.length)return e;const l=new Set(t.map(e=>String(e.name))),n={};for(const i of Object.keys(e))l.has(i)&&(n[i]=e[i]);return n}function I(e){return a(this,void 0,void 0,function*(){var t,l,n,o;if(!e)return null;try{const i=(null===(t=null==e?void 0:e.getLayer)||void 0===t?void 0:t.call(e))||(null===(l=null==e?void 0:e.getJSAPILayer)||void 0===l?void 0:l.call(e))||(null===(n=null==e?void 0:e.getJsApiLayer)||void 0===n?void 0:n.call(e))||(null==e?void 0:e.layer)||null,o=yield Promise.resolve(i),a=o&&(o.layer||o)||null;if(a&&"function"==typeof a.applyEdits)return a}catch(e){}try{const t=i.DataSourceManager.getInstance(),l=(null==e?void 0:e.id)?t.getDataSource(e.id):null;if(l){const e=(null===(o=null==l?void 0:l.getLayer)||void 0===o?void 0:o.call(l))||(null==l?void 0:l.layer)||null,i=yield Promise.resolve(e),t=i&&(i.layer||i)||null;if(t&&"function"==typeof t.applyEdits)return t}}catch(e){}return null})}function N(e){return a(this,void 0,void 0,function*(){var i,t;if(!e)return;let l=e;try{for(;null==l?void 0:l.belongToDataSource;)l=l.belongToDataSource}catch(e){}const n=l?[l]:[];try{const e=(null===(i=null==l?void 0:l.getAllDerivedDataSources)||void 0===i?void 0:i.call(l))||[];(null==e?void 0:e.length)&&n.push(...e)}catch(e){}for(const e of n)try{const i=(null===(t=e.getCurrentQueryParams)||void 0===t?void 0:t.call(e))||null;e.clearSourceRecords&&e.clearSourceRecords(),e.addVersion&&e.addVersion(),e.load&&(i?yield e.load(i):yield e.load())}catch(e){}})}function k(t){const{oid:l,data:o,ds:r,idFieldName:d,cfg:s,ui:u,onClose:c}=t,[g,p]=i.React.useState({}),[v,f]=i.React.useState([]),[b,h]=i.React.useState(!1);i.React.useEffect(()=>{let e=!1;return(()=>{a(this,void 0,void 0,function*(){var i,t,l;try{const t=null===(i=null==r?void 0:r.getSchema)||void 0===i?void 0:i.call(r),l=(null==t?void 0:t.fields)||{},n={};for(const e of Object.keys(l)){const i=l[e];n[e]=String((null==i?void 0:i.alias)||(null==i?void 0:i.label)||(null==i?void 0:i.title)||e)}!e&&Object.keys(n).length&&p(n)}catch(e){}try{const i=(null===(t=null==r?void 0:r.getLayer)||void 0===t?void 0:t.call(r))||(null===(l=null==r?void 0:r.getJSAPILayer)||void 0===l?void 0:l.call(r))||(null==r?void 0:r.layer)||null,n=yield Promise.resolve(i),o=n&&(n.layer||n)||null,a=(null==o?void 0:o.fields)||[];if(a.length&&!e){const e={},i=[];for(const t of a)(null==t?void 0:t.name)&&(e[t.name]=String((null==t?void 0:t.alias)||t.name),i.push({name:t.name,type:t.type||"",domain:t.domain||null}));p(e),f(i)}}catch(e){}e||h(!0)})})(),()=>{e=!0}},[r]);const[m,y]=i.React.useState(Object.assign({},o)),[x,S]=i.React.useState(!1),[j,_]=i.React.useState(null),[z,w]=i.React.useState(!1),[A,C]=i.React.useState("anagrafica"),R=(e,i)=>y(t=>Object.assign(Object.assign({},t),{[e]:i})),k=[],D=[],F=Object.keys(o||{}).filter(e=>!(e.startsWith("__")||/^objectid$/i.test(e)||/^globalid$/i.test(e)||/^shape/i.test(e)||/^stato_/i.test(e)||/^esito_/i.test(e)||/^presa_in_carico/i.test(e)||/^dt_/i.test(e)||/^GII_/i.test(e)||/^origine_pratica$/i.test(e))),P=/ditta|denom|ragione|nome|cognome|cf|cod.*fisc|piva|partita|indir|via|cap|comune|prov|telefono|cell|mail|pec|tipologia_sogg|tipo_sogg/i,B=/viol|infraz|descr|art|norm|tipo_preliev|sanz|acqua|volume|turno|utenza|contatore|circostanz|fatti|ufficio|settore|area_cod/i;for(const e of F)P.test(e)?k.push(e):B.test(e)&&D.push(e);const E=new Set([...k,...D]);for(const e of F)E.has(e)||D.push(e);const O=i=>{if(!b)return null;const t=v.find(e=>e.name===i),l=g[i]||i,n=(null==t?void 0:t.type)||"esriFieldTypeString",o=(null==t?void 0:t.domain)||null,a=m[i],r=n.toLowerCase().includes("date"),d=n.toLowerCase().includes("integer")||n.toLowerCase().includes("double");if((null==o?void 0:o.codedValues)&&Array.isArray(o.codedValues))return(0,e.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,e.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:l}),(0,e.jsxs)("select",{value:null!=a?a:"",disabled:x,onChange:e=>R(i,""===e.target.value?null:d?Number(e.target.value):e.target.value),style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",background:x?"#f3f4f6":"#fff"},children:[(0,e.jsx)("option",{value:"",children:"\u2014 seleziona \u2014"}),o.codedValues.map(i=>(0,e.jsx)("option",{value:String(i.code),children:i.name},String(i.code)))]})]},i);if(r){const t=e=>{if(!e)return"";try{const i=Number(e),t=Number.isFinite(i)&&i>0?new Date(i):new Date(String(e));return Number.isNaN(t.getTime())?"":`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}catch(e){return""}};return(0,e.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,e.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:l}),(0,e.jsx)("input",{type:"date",value:t(a),disabled:x,onChange:e=>{const t=new Date(e.target.value);R(i,Number.isNaN(t.getTime())?null:t.getTime())},style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",background:x?"#f3f4f6":"#fff"}})]},i)}const s=/descr|note|fatti|circostanz/i.test(i);return(0,e.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,e.jsx)("div",{style:{fontSize:12,color:"#6b7280"},children:l}),s?(0,e.jsx)("textarea",{value:null!=a?String(a):"",disabled:x,rows:3,onChange:e=>R(i,e.target.value||null),style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",resize:"vertical",background:x?"#f3f4f6":"#fff",boxSizing:"border-box"}}):(0,e.jsx)("input",{type:"text",value:null!=a?String(a):"",disabled:x,onChange:e=>R(i,""===e.target.value?null:d?Number(e.target.value):e.target.value),style:{padding:"7px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.20)",fontSize:13,width:"100%",background:x?"#f3f4f6":"#fff",boxSizing:"border-box"}})]},i)},W=(()=>{var e;const i=null!==(e=null==o?void 0:o.origine_pratica)&&void 0!==e?e:null==o?void 0:o.Origine_pratica;return`${2===i||"2"===i?"TI":"TR"}-${l}`})(),$=(0,e.jsxs)("div",{style:{position:"fixed",inset:0,zIndex:99999,background:"rgba(0,0,0,0.55)",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,e.jsxs)("div",{style:{background:"#fff",borderRadius:12,width:"88vw",maxWidth:860,height:"85vh",maxHeight:"85vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:[(0,e.jsxs)("div",{style:{flex:"0 0 auto",padding:"14px 20px",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[(0,e.jsxs)("div",{style:{fontWeight:700,fontSize:15},children:["\u270f\ufe0f Modifica pratica\xa0",(0,e.jsx)("span",{style:{color:"#2f6fed"},children:W})]}),(0,e.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[j&&(0,e.jsx)("span",{style:{fontSize:13,color:"ok"===j.kind?"#1a7f37":"#b42318"},children:j.text}),(0,e.jsx)("button",{type:"button",disabled:x,onClick:()=>a(this,void 0,void 0,function*(){var e,i,t,n;S(!0),_(null);try{const o=yield I(r);if(!(null==o?void 0:o.applyEdits))throw new Error("Layer non raggiungibile.");if("function"==typeof o.load)try{yield o.load()}catch(e){}const a={[d]:l};for(const[e,i]of Object.entries(m))e.startsWith("__")||(a[e]=i);const s=T(a,o),u=yield o.applyEdits({updateFeatures:[{attributes:s}]}),g=(null===(e=null==u?void 0:u.updateFeatureResults)||void 0===e?void 0:e[0])||(null===(i=null==u?void 0:u.updateResults)||void 0===i?void 0:i[0])||null,p=null==g?void 0:g.error;if(!(!p&&(!0===(null==g?void 0:g.success)||null!=(null==g?void 0:g.objectId)||null==(null==g?void 0:g.success)))){const e=p?`${null!==(t=p.code)&&void 0!==t?t:""}: ${null!==(n=p.message)&&void 0!==n?n:""}`:JSON.stringify(u);throw new Error(e)}yield N(r),_({kind:"ok",text:"Salvato."}),S(!1),window.setTimeout(()=>c(!0),1e3)}catch(e){S(!1),_({kind:"err",text:`Errore: ${(null==e?void 0:e.message)||String(e)}`})}}),style:{padding:"8px 18px",borderRadius:8,border:"none",background:x?"#e5e7eb":"#1a7f37",color:x?"#9ca3af":"#fff",fontWeight:700,fontSize:13,cursor:x?"not-allowed":"pointer"},children:x?"Salvataggio\u2026":"\u{1f4be} Salva"}),(0,e.jsx)("button",{type:"button",disabled:x,onClick:()=>w(!0),style:{padding:"8px 18px",borderRadius:8,border:"1px solid #d13438",background:"#fff",color:"#d13438",fontWeight:700,fontSize:13,cursor:x?"not-allowed":"pointer"},children:"\u2715 Annulla"})]})]}),(0,e.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",gap:8,padding:"10px 20px",borderBottom:"1px solid #e5e7eb"},children:[["anagrafica","violazione"].map(i=>(0,e.jsx)("button",{type:"button",disabled:x,onClick:()=>C(i),style:{padding:"8px 14px",borderRadius:10,border:"1px solid "+(A===i?"#2f6fed":"rgba(0,0,0,0.12)"),background:A===i?"#eaf2ff":"rgba(0,0,0,0.02)",color:A===i?"#1d4ed8":"#111827",fontWeight:700,fontSize:12,cursor:x?"not-allowed":"pointer"},children:i.charAt(0).toUpperCase()+i.slice(1)},i)),(0,e.jsx)("div",{style:{fontSize:12,color:"#9ca3af",alignSelf:"center",marginLeft:8},children:'Per localizzazione e allegati usa "Modifica (pagina)"'})]}),(0,e.jsx)("div",{style:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"16px 20px"},children:b?(0,e.jsxs)("div",{style:{display:"grid",gap:14},children:["anagrafica"===A&&(k.length?k.map(e=>O(e)):(0,e.jsx)("div",{style:{color:"#6b7280",fontSize:13},children:"Nessun campo rilevato automaticamente. Usare la pagina di editing completa."})),"violazione"===A&&(D.length?D.map(e=>O(e)):(0,e.jsx)("div",{style:{color:"#6b7280",fontSize:13},children:"Nessun campo rilevato automaticamente. Usare la pagina di editing completa."}))]}):(0,e.jsx)("div",{style:{color:"#6b7280",fontSize:13},children:"Caricamento schema campi\u2026"})})]}),z&&(0,e.jsx)("div",{style:{position:"fixed",inset:0,zIndex:1e5,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,e.jsxs)("div",{style:{background:"#fff",borderRadius:12,padding:28,maxWidth:380,width:"90%",boxShadow:"0 8px 32px rgba(0,0,0,0.25)"},children:[(0,e.jsx)("div",{style:{fontWeight:700,fontSize:16,marginBottom:10},children:"Annullare le modifiche?"}),(0,e.jsx)("div",{style:{fontSize:13,color:"#4b5563",marginBottom:20},children:"Le modifiche non salvate andranno perse."}),(0,e.jsxs)("div",{style:{display:"flex",gap:10},children:[(0,e.jsx)("button",{type:"button",onClick:()=>{w(!1),c(!1)},style:{padding:"8px 18px",borderRadius:8,border:"none",background:"#d13438",color:"#fff",fontWeight:700,fontSize:13,cursor:"pointer"},children:"S\xec, annulla"}),(0,e.jsx)("button",{type:"button",onClick:()=>w(!1),style:{padding:"8px 18px",borderRadius:8,border:"1px solid rgba(0,0,0,0.15)",background:"#fff",color:"#111827",fontWeight:600,fontSize:13,cursor:"pointer"},children:"Torna all'editing"})]})]})})]});return(0,n.createPortal)($,document.body)}const D=2,F=1,P=2,B=3,E=4,O=5,W=1,$=2,L=3;function M(e){return e===W?B:e===$?E:e===L?O:null}function G(e,i){const t=String(null!=e?e:"").trim();return t&&function(e){return/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test((e||"").trim())}(t)?t:i}function U(e,i,t){var l,n,o,a,r;const d={borderRadius:null!==(l=null==t?void 0:t.btnBorderRadius)&&void 0!==l?l:8,fontSize:null!==(n=null==t?void 0:t.btnFontSize)&&void 0!==n?n:13,fontWeight:null!==(o=null==t?void 0:t.btnFontWeight)&&void 0!==o?o:600,padding:`${null!==(a=null==t?void 0:t.btnPaddingY)&&void 0!==a?a:8}px ${null!==(r=null==t?void 0:t.btnPaddingX)&&void 0!==r?r:16}px`};return i?Object.assign(Object.assign({},d),{backgroundColor:"#e5e7eb",borderColor:"#e5e7eb",color:"#9ca3af",cursor:"not-allowed"}):Object.assign(Object.assign({},d),{backgroundColor:e,borderColor:e,color:"#ffffff"})}function J(t){var n,o,r,d,s,g;const{active:p,roleCode:v,buttonText:f,buttonColors:b,ui:h}=t,m=String(v||"DT").trim().toUpperCase(),y=h.titleFontSize,x=h.msgFontSize,_=`presa_in_carico_${m}`,z=`dt_presa_in_carico_${m}`,w=`stato_${m}`,T=`dt_stato_${m}`,I=`esito_${m}`,N=`dt_esito_${m}`,G=`note_${m}`,J="stato_DA",H="dt_stato_DA",V="presa_in_carico_DA",[Z,q]=i.React.useState(!1),[Y,K]=i.React.useState({kind:"info",text:"Selezionare una riga."}),[X,Q]=i.React.useState(null),[ee,ie]=i.React.useState(!1),[te,le]=i.React.useState(""),[ne,oe]=i.React.useState(""),ae=i.React.useRef(""),re=i.React.useRef(null),de=i.React.useCallback(e=>{if(e)try{e.style.height="auto";const i=Math.min(e.scrollHeight||42,118);e.style.height=`${i}px`,e.style.overflowY=e.scrollHeight>118?"auto":"hidden"}catch(e){}},[]),se=null!=(null===(n=null==p?void 0:p.state)||void 0===n?void 0:n.oid)?`${p.key}:${p.state.oid}`:null,ue=i.React.useRef(se);i.React.useEffect(()=>{ue.current=se},[se]);const ce=null===(o=null==p?void 0:p.state)||void 0===o?void 0:o.ds,ge=(null===(r=null==p?void 0:p.state)||void 0===r?void 0:r.data)||null,pe=null!==(s=null===(d=null==p?void 0:p.state)||void 0===d?void 0:d.oid)&&void 0!==s?s:null,ve=(null===(g=null==p?void 0:p.state)||void 0===g?void 0:g.idFieldName)||"OBJECTID",fe=null!=pe&&Number.isFinite(pe),be=t.editConfig,[he,me]=i.React.useState(!1),ye=ge?ge[be.fieldStatoTI]:null,xe=ge?ge[be.fieldPresaTI]:null,Se=null!=ye&&""!==String(ye)?Number(ye):null,je=null!=xe&&""!==String(xe)?Number(xe):null,_e=fe&&!Z&&null===X&&be.show&&je===be.presaRequiredVal&&null!=Se&&Se>=be.minStato&&Se<=be.maxStato,ze=ge?ge[_]:null,we=ge?ge[w]:null,Ae=ge?ge[I]:null,Ce=ge?ge[J]:null,Re=null!=ze&&""!==String(ze)?Number(ze):null,Te=null!=we&&""!==String(we)?Number(we):null,Ie=null!=Ce&&""!==String(Ce)?Number(Ce):null,Ne=ge?ge.origine_pratica:null,ke=null!=Ne&&""!==String(Ne)?Number(Ne):null,De="DT"===m&&null!=Ie&&Ie>=1;i.React.useEffect(()=>{if(!se)return K({kind:"info",text:"Selezionare una riga."}),Q(null),q(!1),ie(!1),ae.current="",le(""),void oe("");K(null),Q(null),q(!1),ie(!1);const e=ge&&null!=ge[G]?String(ge[G]):"";ae.current=e,le(e),oe(""),window.setTimeout(()=>de(re.current),0)},[se]),i.React.useEffect(()=>{const e=window.setTimeout(()=>de(re.current),0);return()=>window.clearTimeout(e)},[te,de]);const Fe=(null!=X||Z)&&fe,Pe=ge?(e=>{if(!e)return"";const i=["DA","DT","RI","RZ","TI","TR"],t=i=>{const t=e[`presa_in_carico_${i}`],l=e[`stato_${i}`],n=e[`esito_${i}`];return null!=t&&""!==t||null!=l&&""!==l||null!=n&&""!==n};for(const l of i){if(!t(l))continue;const i=e[`presa_in_carico_${l}`],n=e[`stato_${l}`],o=e[`esito_${l}`],a=(null!=i&&""!==i&&Number(i),null!=n&&""!==n&&Number(n),null!=o&&""!==o?Number(o):null);return null!==a&&Number.isFinite(a),l}const l=e.origine_pratica;return 2===(null!=l&&""!==l?Number(l):null)?"TI":"RZ"})(ge):"",Be=Pe===m,Ee=fe&&!Z&&!De&&null===X&&Be&&!("TI"===m&&2===ke&&null==Re)&&(null==Re||Re===R)&&(null==Te||Te===F),Oe=fe&&!Z&&!De&&null===X&&Be&&Re===D&&Te===P,We="DT"===m&&fe&&!Z&&!De&&null===X&&Be&&(Te===B||Te===E||Te===O)&&(null==Ie||0===Ie),$e="INTEGRAZIONE"===X||"RESPINGI"===X,Le=$e&&fe&&!Z&&!De,Me=String(null!=te?te:"").trim(),Ge=String(null!=ne?ne:"").trim(),Ue=/\baltro\b/i.test(Ge),Je="INTEGRAZIONE"===X||"RESPINGI"===X&&Ue,He=ee&&("RESPINGI"===X&&!Ge),Ve=ee&&(Je&&!Me),Ze=e=>{fe&&(De||("TAKE"!==e||Ee)&&("TAKE"===e||"TRASMETTI"===e||Oe)&&("TRASMETTI"!==e||We)&&(Q(e),K(null),ie(!1),oe(""),"INTEGRAZIONE"===e&&window.setTimeout(()=>{var e,i;try{null===(i=null===(e=re.current)||void 0===e?void 0:e.focus)||void 0===i||i.call(e)}catch(e){}de(re.current)},0)))},qe=e=>{let i=e;try{for(;null==i?void 0:i.belongToDataSource;)i=i.belongToDataSource}catch(e){}return i||e},Ye=e=>a(this,void 0,void 0,function*(){var i,t,l,n,o,a;const r=qe(e),d=(null===(i=null==r?void 0:r.getLayer)||void 0===i?void 0:i.call(r))||(null===(t=null==r?void 0:r.getJSAPILayer)||void 0===t?void 0:t.call(r))||(null==r?void 0:r.layer)||(null===(l=null==r?void 0:r.createJSAPILayerByDataSource)||void 0===l?void 0:l.call(r))||(null===(n=null==e?void 0:e.getLayer)||void 0===n?void 0:n.call(e))||(null===(o=null==e?void 0:e.getJSAPILayer)||void 0===o?void 0:o.call(e))||(null==e?void 0:e.layer)||(null===(a=null==e?void 0:e.createJSAPILayerByDataSource)||void 0===a?void 0:a.call(e))||null;return{root:r,layer:u(yield Promise.resolve(d))}}),Ke=(e,i)=>a(this,void 0,void 0,function*(){var t;let l="";try{const i=yield c("esri/identity/IdentityManager"),t=yield i.getCredential(e);l=(null==t?void 0:t.token)||""}catch(e){}const n=JSON.stringify({attributes:i}),o=new URLSearchParams(Object.assign({f:"json",features:`[${n}]`,rollbackOnFailure:"true"},l?{token:l}:{})),a=`${e.replace(/\/$/,"")}/updateFeatures`,r=yield fetch(a,{method:"POST",body:o});if(!r.ok)throw new Error(`HTTP ${r.status}`);const d=yield r.json();if(d.error)throw new Error(`REST error: code=${d.error.code} \u2013 ${d.error.message}`);const s=null===(t=d.updateResults)||void 0===t?void 0:t[0];if(s&&!s.success){const e=s.error;throw new Error(e?`code=${e.code} \u2013 ${e.description||e.message}`:JSON.stringify(s))}}),Xe=(e,i)=>a(this,void 0,void 0,function*(){var l,n,o,a,r,d;if(!ce)throw new Error("DataSource non disponibile.");if(!fe||null==pe)throw new Error("Selezione non valida.");const s=ue.current;q(!0),K({kind:"info",text:"Aggiorno\u2026"});try{const u=t.motherLayerUrl?String(t.motherLayerUrl).trim():"",c=qe(ce);if(u){const i=ve||"OBJECTID",t=Object.assign({[i]:pe},e);yield Ke(u,t)}else{const{layer:i}=yield Ye(ce);if(!(null==i?void 0:i.applyEdits))throw new Error("Layer non disponibile (applyEdits).");if("function"==typeof i.load)try{yield i.load()}catch(e){}const t=((null===(l=qe(ce))||void 0===l?void 0:l.getIdField)?qe(ce).getIdField():null)||((null==ce?void 0:ce.getIdField)?ce.getIdField():null)||i.objectIdField||ve||"OBJECTID",s=function(e,i){const t=(null==i?void 0:i.fields)||[];if(!t.length)return e;const l=new Set(t.map(e=>String(e.name))),n={};for(const i of Object.keys(e))l.has(i)&&(n[i]=e[i]);return n}(Object.assign({[t]:pe},e),i),u=yield i.applyEdits({updateFeatures:[{attributes:s}]}),c=(null===(n=null==u?void 0:u.updateFeatureResults)||void 0===n?void 0:n[0])||(null===(o=null==u?void 0:u.updateResults)||void 0===o?void 0:o[0])||null,g=null==c?void 0:c.error;if(!(!g&&(!0===(null==c?void 0:c.success)||null!=(null==c?void 0:c.objectId)||null!=(null==c?void 0:c.globalId)||null==(null==c?void 0:c.success)))){const e=g?`code=${null!==(a=g.code)&&void 0!==a?a:""} name=${null!==(r=g.name)&&void 0!==r?r:""} message=${null!==(d=g.message)&&void 0!==d?d:""}`:JSON.stringify(u||c);throw new Error(e)}}if(ue.current!==s)return K(null),void q(!1);K({kind:"ok",text:i}),yield S(c),yield S(ce),window.setTimeout(()=>{ue.current===s&&K(null)},4500),q(!1)}catch(e){throw q(!1),e}}),Qe=(e,i)=>a(this,void 0,void 0,function*(){try{const t=M(e),l={[I]:e,[N]:Date.now()};null!=t&&(l[w]=t,l[T]=Date.now()),yield Xe(l,`Esito salvato: ${i}.`),Q(null),ie(!1)}catch(e){const i=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${i}`})}}),ei=(e,i)=>e?{fontSize:h.statusFontSize,color:i?"#b42318":"#6b7280"}:{display:"none"};return(0,e.jsxs)("div",{children:[Fe&&(0,e.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.10)",zIndex:1e3}}),(0,e.jsxs)("div",{style:{position:"relative",zIndex:1001,display:"flex",flexDirection:"column",gap:12,boxSizing:"border-box",width:"100%",height:"100%",minHeight:0},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[(0,e.jsxs)("div",{style:{fontSize:y,fontWeight:700},children:["Azioni (",m,")"]}),Y&&(0,e.jsx)("div",{style:j(Y.kind,x),title:Y.text,children:Y.text})]}),(0,e.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,e.jsx)(A,{label:"N.pratica (OID)",value:pe,labelSize:h.statusFontSize,valueSize:y}),(0,e.jsx)(A,{label:_,value:ze,labelSize:h.statusFontSize,valueSize:y}),(0,e.jsx)(A,{label:w,value:we,labelSize:h.statusFontSize,valueSize:y}),(0,e.jsx)(A,{label:I,value:Ae,labelSize:h.statusFontSize,valueSize:y}),(0,e.jsx)(A,{label:J,value:Ce,labelSize:h.statusFontSize,valueSize:y})]}),(0,e.jsx)("div",{style:{height:1,background:h.dividerColor,margin:"2px 0"}}),null===X&&(0,e.jsx)("div",{style:{display:"flex",alignItems:"baseline",gap:10},children:(0,e.jsx)("div",{style:{fontSize:y,fontWeight:700},children:"Azioni"})}),null===X&&(0,e.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:[(0,e.jsx)(l.Button,{type:"primary",onClick:()=>Ze("TAKE"),disabled:!Ee,style:U(b.take,!Ee,h),children:f}),(0,e.jsx)(l.Button,{type:"primary",onClick:()=>Ze("INTEGRAZIONE"),disabled:!Oe,style:U(b.integrazione,!Oe,h),children:"Integrazione"}),(0,e.jsx)(l.Button,{type:"primary",onClick:()=>Ze("APPROVA"),disabled:!Oe,style:U(b.approva,!Oe,h),children:"Approva"}),(0,e.jsx)(l.Button,{type:"primary",onClick:()=>Ze("RESPINGI"),disabled:!Oe,style:U(b.respingi,!Oe,h),children:"Respingi"}),"DT"===m&&(0,e.jsx)(l.Button,{type:"primary",onClick:()=>Ze("TRASMETTI"),disabled:!We,style:U(b.trasmetti,!We,h),children:"Trasmetti a DA"}),be.show&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{width:"100%",height:1,background:h.dividerColor,margin:"4px 0"}}),(0,e.jsx)("button",{type:"button",disabled:!_e,onClick:()=>{var e,i,t,l;if(_e){try{window.__giiEdit={oid:pe,data:Object.assign({},ge),idFieldName:(null===(e=null==p?void 0:p.state)||void 0===e?void 0:e.idFieldName)||"OBJECTID",dsId:null!==(l=null===(t=null===(i=null==p?void 0:p.state)||void 0===i?void 0:i.ds)||void 0===t?void 0:t.id)&&void 0!==l?l:null,ts:Date.now()}}catch(e){}me(!0)}},title:_e?"Apre il pannello di editing nella pagina corrente":"Modifica non disponibile: verifica stato e presa in carico TI",style:{padding:"8px 16px",borderRadius:8,border:"none",background:_e?be.overlayColor:"#e5e7eb",color:_e?"#fff":"#9ca3af",fontWeight:700,fontSize:13,cursor:_e?"pointer":"not-allowed",display:"flex",alignItems:"center",gap:6},children:"\u270f\ufe0f Modifica (overlay)"}),(0,e.jsx)("button",{type:"button",disabled:!_e,onClick:()=>{var e,i,t,l,n,o;if(_e){try{window.__giiEdit={oid:pe,data:Object.assign({},ge),idFieldName:(null===(e=null==p?void 0:p.state)||void 0===e?void 0:e.idFieldName)||"OBJECTID",dsId:null!==(l=null===(t=null===(i=null==p?void 0:p.state)||void 0===i?void 0:i.ds)||void 0===t?void 0:t.id)&&void 0!==l?l:null,ts:Date.now()}}catch(e){}try{const e=String(be.pageId||"editing-ti").trim(),i=null===(n=window.jimuCore)||void 0===n?void 0:n.getAppStore;if(i){const t=i();return void(null===(o=null==t?void 0:t.dispatch)||void 0===o||o.call(t,{type:"APP_NAVIGATE",uri:e}))}}catch(e){}try{const e=String(be.pageId||"editing-ti").trim();window.location.hash=`#${e}`}catch(e){}}},title:_e?`Apre la pagina di editing: ${be.pageId}`:"Modifica non disponibile: verifica stato e presa in carico TI",style:{padding:"8px 16px",borderRadius:8,border:`2px solid ${_e?be.pageColor:"#e5e7eb"}`,background:"#fff",color:_e?be.pageColor:"#9ca3af",fontWeight:700,fontSize:13,cursor:_e?"pointer":"not-allowed",display:"flex",alignItems:"center",gap:6},children:"\u2197 Modifica (pagina)"})]})]}),he&&fe&&null!=pe&&null!=ge&&(0,e.jsx)(k,{oid:pe,data:ge,ds:ce,idFieldName:ve,cfg:be,ui:h,onClose:e=>{me(!1),e&&(K({kind:"ok",text:"Pratica modificata."}),window.setTimeout(()=>K(null),4e3))}}),null!==X&&(0,e.jsxs)("div",{style:{display:"grid",gap:10},children:["RESPINGI"===X&&(0,e.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[(0,e.jsx)("div",{style:{fontSize:y,fontWeight:700},children:"Motivazione"}),(0,e.jsx)("div",{style:ei(!0,He),children:"(obbligatoria)"})]}),(0,e.jsx)(C,{value:ne,options:h.rejectReasons||[],placeholder:"\u2014 seleziona \u2014",disabled:Z||!fe||De,onChange:e=>{const i=String(null!=e?e:"");oe(i),ee&&ie(!1)},evenBg:h.reasonsZebraEvenBg,oddBg:h.reasonsZebraOddBg,borderColor:h.reasonsRowBorderColor,borderWidth:h.reasonsRowBorderWidth,radius:h.reasonsRowRadius,fontSize:h.statusFontSize,isError:He})]}),$e&&(0,e.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:8},children:[(0,e.jsx)("div",{style:{fontSize:y,fontWeight:700},children:"Note"}),"INTEGRAZIONE"===X&&(0,e.jsx)("div",{style:ei(!0,Ve),children:"(obbligatoria)"}),"RESPINGI"===X&&Je&&(0,e.jsx)("div",{style:ei(!0,Ve),children:"(obbligatoria)"})]}),(0,e.jsx)("textarea",{ref:re,value:te,onChange:e=>{var i;const t=String(null!==(i=e.target.value)&&void 0!==i?i:"");le(t),de(e.target)},placeholder:"INTEGRAZIONE"===X?"Scrivi la richiesta di integrazione\u2026":Je?"Specifica il motivo (Altro)\u2026":"Nota facoltativa (eventuali dettagli)\u2026",style:{width:"100%",minHeight:42,maxHeight:118,overflowY:"hidden",resize:"none",padding:"8px 10px",borderRadius:8,border:Ve?"1px solid #b42318":"1px solid rgba(0,0,0,0.20)",fontSize:h.statusFontSize,outline:"none",boxSizing:"border-box"},disabled:!Le})]}),(0,e.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center"},children:["TAKE"===X&&(0,e.jsx)(l.Button,{type:"primary",onClick:()=>a(this,void 0,void 0,function*(){try{yield Xe({[_]:D,[z]:Date.now(),[w]:P,[T]:Date.now()},"Presa in carico salvata."),Q(null),ie(!1)}catch(e){const i=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${i}`})}}),disabled:Z,style:U(b.take,!!Z,h),children:Z?"Aggiorno\u2026":"Conferma presa in carico"}),"INTEGRAZIONE"===X&&(0,e.jsx)(l.Button,{type:"primary",onClick:()=>a(this,void 0,void 0,function*(){if(ie(!0),Me)try{const e=M(W);yield Xe({[I]:W,[N]:Date.now(),[w]:null!=e?e:B,[T]:Date.now(),[G]:Me},"Integrazione richiesta salvata."),Q(null),ie(!1)}catch(e){const i=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${i}`})}}),disabled:Z,style:U(b.integrazione,!!Z,h),children:Z?"Aggiorno\u2026":"Conferma integrazione"}),"APPROVA"===X&&(0,e.jsx)(l.Button,{type:"primary",onClick:()=>Qe($,"Approvata"),disabled:Z,style:U(b.approva,!!Z,h),children:Z?"Aggiorno\u2026":"Conferma approvazione"}),"RESPINGI"===X&&(0,e.jsx)(l.Button,{type:"primary",onClick:()=>a(this,void 0,void 0,function*(){if(ie(!0),Ge&&(!Je||Me))try{const e=M(L),i=Ue?`Motivazione: ${Ge}\n\n${Me}`:`Motivazione: ${Ge}`+(Me?`\n\n${Me}`:""),t={[I]:L,[N]:Date.now(),[G]:i};null!=e&&(t[w]=e,t[T]=Date.now()),yield Xe(t,"Esito salvato: Respinta."),Q(null),ie(!1)}catch(e){const i=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${i}`})}}),disabled:Z,style:U(b.respingi,!!Z,h),children:Z?"Aggiorno\u2026":"Conferma respinta"}),"TRASMETTI"===X&&(0,e.jsx)(l.Button,{type:"primary",onClick:()=>a(this,void 0,void 0,function*(){try{yield Xe({[J]:F,[H]:Date.now(),[V]:R},"Trasmesso a DA."),Q(null),ie(!1)}catch(e){const i=(null==e?void 0:e.message)?String(e.message):String(e);K({kind:"err",text:`Errore salvataggio: ${i}`})}}),disabled:Z,style:U(b.trasmetti,!!Z,h),children:Z?"Aggiorno\u2026":"Conferma trasmissione"}),(0,e.jsx)(l.Button,{type:"default",onClick:()=>{Q(null),q(!1),K(null),ie(!1),le(ae.current),oe("")},disabled:Z,children:"Annulla"})]})]}),De&&fe&&(0,e.jsx)("div",{style:Object.assign(Object.assign({},j("info",x)),{marginTop:4}),children:"Pratica gi\xe0 trasmessa a DA: azioni non disponibili."})]})]})}function H(e){if(null==e||""===e)return"\u2014";try{const i=Number(e),t=Number.isFinite(i)&&i>0?new Date(i):new Date(String(e));if(Number.isNaN(t.getTime()))return String(e);const l=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getFullYear()),a=String(t.getHours()).padStart(2,"0");return`${l}/${n}/${o} ${a}:${String(t.getMinutes()).padStart(2,"0")}`}catch(i){return String(e)}}function V(e){if(!e)return[];const i=(null==e?void 0:e.asMutable)?e.asMutable({deep:!0}):e;return(Array.isArray(i)?i:[]).map(e=>String(e)).filter(Boolean)}function Z(e,i){let t=[];return t=Array.isArray(i)&&i.length>0?i:[{id:"anagrafica",label:"Anagrafica",fields:(null==e?void 0:e.anagrafica)||[]},{id:"violazione",label:"Violazione",fields:(null==e?void 0:e.violazione)||[]},{id:"iter",label:"Iter",fields:(null==e?void 0:e.iterExtra)||[],isIterTab:!0},{id:"allegati",label:"Allegati",fields:(null==e?void 0:e.allegati)||[]},{id:"azioni",label:"Azioni",fields:[]}],t.map(e=>{const i=null!=e.hideEmpty?Boolean(e.hideEmpty):"violazione"===e.id||"allegati"===e.id;if("azioni"===e.id){const i=e,{locked:t}=i,l=s(i,["locked"]);return Object.assign(Object.assign({},l),{hideEmpty:!1})}return Object.assign(Object.assign({},e),{hideEmpty:i})})}function q(i){const t=i.active?"#eaf2ff":"rgba(0,0,0,0.02)",l=i.active?"#2f6fed":"rgba(0,0,0,0.12)",n=i.active?"#1d4ed8":"#111827";return(0,e.jsx)("button",{type:"button",disabled:!!i.disabled,onClick:i.onClick,style:{padding:"8px 10px",borderRadius:10,border:`1px solid ${l}`,background:t,color:n,fontWeight:700,fontSize:12,cursor:i.disabled?"not-allowed":"pointer",opacity:i.disabled?.55:1},children:i.label})}function Y(i){var t;const l=null!==(t=i.ui)&&void 0!==t?t:{},n=Number.isFinite(Number(l.titleFontSize))?Number(l.titleFontSize):14,o=Number.isFinite(Number(l.msgFontSize))?Number(l.msgFontSize):12;Number.isFinite(Number(l.statusFontSize))&&Number(l.statusFontSize);return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column",minHeight:0},children:[(0,e.jsx)("div",{style:{fontWeight:800,fontSize:n,marginBottom:10},children:i.title}),i.rows.length?(0,e.jsx)("div",{style:{display:"grid",gap:8},children:i.rows.map((i,t)=>(0,e.jsx)(A,{label:i.label,value:i.value,labelSize:12,valueSize:13},t))}):(0,e.jsx)("div",{style:Object.assign({},j("info",o)),children:i.emptyText||"Configura i campi nelle impostazioni."})]})}const K={tipo_soggetto:[{v:"PF",l:"Persona fisica"},{v:"PG",l:"Persona giuridica"}],ufficio:["Cagliari","Iglesias","Masainas","Quartucciu","San Gavino Monreale","San Giovanni Suergiu","San Sperate","Senorb\xec","Serramanna"].map(e=>({v:e,l:e})),tipo_abuso:[{v:"parziale",l:"Parziale"},{v:"totale",l:"Totale"}],art15_parziale:[{v:"Art15.1",l:"Prima contestazione"},{v:"Art15.2",l:"Recidiva"}],art15_totale:[{v:"Art15.3",l:"Prima contestazione"},{v:"Art15.4",l:"Recidiva"}],art16_17:[{v:"Art16",l:"Art. 16 \u2013 Comunicazione di irrigazione tardiva"},{v:"Art17",l:"Art. 17 \u2013 Comunicazione di variazione o di rinuncia tardiva"}],art17_tipo:[{v:"Art17.1",l:"Variazione tardiva"},{v:"Art17.2",l:"Rinuncia tardiva"}],presenza:[{v:"s\xec",l:"S\xec"},{v:"no",l:"No"}],norma3:[{v:"Art8",l:"Art. 8 \u2013 Violazione servizio reperibilit\xe0"},{v:"Art12",l:"Art. 12 \u2013 Negato accesso ai fondi (al personale consortile)"},{v:"Art27",l:"Art. 27 \u2013 Spreco d'acqua/uso negligente risorsa idrica"},{v:"Art28",l:"Art. 28 \u2013 Violazione prescrizioni del consorzio"},{v:"Art29",l:"Art. 29 \u2013 Violazione termini restituzione attrezzature"},{v:"Art30",l:"Art. 30 \u2013 Danneggiamento e/o perdita attrezzature"},{v:"Art31",l:"Art. 31 \u2013 Mancata segnalazione guasti"},{v:"Art32",l:"Art. 32 \u2013 Negato accesso ai fondi (al consorziato)"},{v:"Art33",l:"Art. 33 \u2013 Inosservanza limiti temporali di prelievo"},{v:"Art34",l:"Art. 34 \u2013 Interferenze"},{v:"Art35",l:"Art. 35 \u2013 Manomissione reti di dispensa e allaccio aspirazione"},{v:"Art36",l:"Art. 36 \u2013 Uso attrezzature non autorizzate"},{v:"Art37",l:"Art. 37 \u2013 Uso sistemi di irrigazione incompatibili"},{v:"Art39",l:"Art. 39 \u2013 Danni strutture irrigue"}]},X={Art8:"v_art08",Art12:"v_art12",Art27:"v_art27",Art28:"v_art28",Art29:"v_art29",Art30:"v_art30",Art31:"v_art31",Art32:"v_art32",Art33:"v_art33",Art34:"v_art34",Art35:"v_art35",Art36:"v_art36",Art37:"v_art37",Art39:"v_art39"},Q={wrap:{width:"100%",height:"100%",display:"flex",flexDirection:"column",minHeight:0,overflowY:"auto",padding:"0 2px"},hdr:{fontSize:11,fontWeight:700,color:"#1d4ed8",textTransform:"uppercase",letterSpacing:1,borderBottom:"2px solid #bfdbfe",paddingBottom:4,marginBottom:12,marginTop:20},lbl:{fontSize:12,color:"#6b7280",marginBottom:4,display:"block"},inp:{width:"100%",padding:"7px 10px",borderRadius:7,border:"1px solid rgba(0,0,0,0.18)",fontSize:13,boxSizing:"border-box",background:"#fff"},inpDis:{width:"100%",padding:"7px 10px",borderRadius:7,border:"1px solid rgba(0,0,0,0.10)",fontSize:13,boxSizing:"border-box",background:"#f3f4f6",color:"#6b7280"},sel:{width:"100%",padding:"7px 10px",borderRadius:7,border:"1px solid rgba(0,0,0,0.18)",fontSize:13,boxSizing:"border-box",background:"#fff",cursor:"pointer"},row2:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},row3:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12},fld:{marginBottom:10},hint:{fontSize:11,color:"#9ca3af",marginTop:3}};function ee(i){return(0,e.jsxs)("div",{style:Q.fld,children:[(0,e.jsx)("label",{style:Q.lbl,children:i.label}),i.children,i.hint&&(0,e.jsx)("div",{style:Q.hint,children:i.hint})]})}function ie(i){return(0,e.jsxs)("select",{value:i.value,onChange:e=>i.onChange(e.target.value),style:i.disabled?Q.inpDis:Q.sel,disabled:i.disabled,children:[(0,e.jsx)("option",{value:"",children:"\u2014 seleziona \u2014"}),i.options.map(i=>(0,e.jsx)("option",{value:i.v,children:i.l},i.v))]})}function te(i){const t=i.disabled?Q.inpDis:Q.inp;return i.multiline?(0,e.jsx)("textarea",{value:i.value,onChange:e=>i.onChange(e.target.value),placeholder:i.placeholder,rows:3,style:Object.assign(Object.assign({},t),{resize:"vertical"}),disabled:i.disabled}):(0,e.jsx)("input",{type:"text",value:i.value,onChange:e=>i.onChange(e.target.value),placeholder:i.placeholder,style:t,disabled:i.disabled})}function le(i){return(0,e.jsx)("input",{type:"number",value:i.value,onChange:e=>i.onChange(e.target.value),style:i.disabled?Q.inpDis:Q.inp,disabled:i.disabled})}function ne(i){return(0,e.jsx)("input",{type:i.withTime?"datetime-local":"date",value:i.value,onChange:e=>i.onChange(e.target.value),style:i.disabled?Q.inpDis:Q.inp,disabled:i.disabled})}function oe(t){var l,n;const{ds:o,cfg:r}=t,[d,s]=i.React.useState({}),[u,v]=i.React.useState(!1),[f,b]=i.React.useState(null),m=(e,i)=>s(t=>Object.assign(Object.assign({},t),{[e]:i})),y=e=>{var i;return null!==(i=d[e])&&void 0!==i?i:""},x=i.React.useMemo(()=>new Set(String(y("norma_violata3")||"").split(" ").filter(Boolean)),[d.norma_violata3]),S=y("tipologia_soggetto"),j=y("tipo_abuso"),_=y("norma16_17"),z=y("art17_tipo"),w=y("norma15_parziale"),A=y("norma15_totale"),C="parziale"===j&&("Art15.1"===w||"Art15.2"===w)||"totale"===j&&("Art15.3"===A||"Art15.4"===A),R=i.React.useMemo(()=>h({norma15_parziale:w,norma15_totale:A,norma_violata3:y("norma_violata3")}),[w,A,d.norma_violata3]),k=Number(null!==(l=r.officeLonWgs84)&&void 0!==l?l:0),D=Number(null!==(n=r.officeLatWgs84)&&void 0!==n?n:0),F=(B=D,!(!g(P=k)||!g(B)||0===Number(P)&&0===Number(B)||Number(P)<-180||Number(P)>180||Number(B)<-90||Number(B)>90));var P,B;const E=i.React.useRef(null),O=i.React.useCallback(()=>a(this,void 0,void 0,function*(){const e=String(r.motherLayerUrl||"").trim();if(e){if(E.current)return E.current;const i=new(yield c("esri/layers/FeatureLayer"))({url:e});if("function"==typeof(null==i?void 0:i.load))try{yield i.load()}catch(e){}return E.current=i,i}return yield I(o)}),[r.motherLayerUrl,o]),W=e=>{if(!e)return null;try{const i=new Date(e);return Number.isNaN(i.getTime())?null:i.getTime()}catch(e){return null}},$=e=>{const i="number"==typeof e?e:parseInt(String(e),10);return Number.isNaN(i)?null:i},[L,M]=i.React.useState("anagrafica"),G=t.showDatiGenerali,U={padding:"7px 16px",borderRadius:8,border:"none",fontWeight:700,fontSize:13,cursor:u?"not-allowed":"pointer"},J=i.React.useMemo(()=>t.clickedPointWgs84?{kind:"ok",text:"Punto impostato da click in mappa."}:0===R&&F?{kind:"info",text:"Nessun click: user\xf2 il punto ufficio (default)."}:0!==R||F?{kind:"err",text:"Localizzazione obbligatoria: fai click in mappa."}:{kind:"err",text:"Nessun click e punto ufficio non configurato: fai click in mappa o imposta Lon/Lat ufficio nel setting."},[t.clickedPointWgs84,R,F]);return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",minHeight:0},children:[(0,e.jsxs)("div",{style:{flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:8,padding:"8px 0",borderBottom:"1px solid rgba(0,0,0,0.08)"},children:[(0,e.jsx)("span",{style:{fontWeight:700,fontSize:14},children:"\u271a Nuova pratica (TI)"}),(0,e.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[f&&(0,e.jsx)("span",{style:{fontSize:12,color:"ok"===f.kind?"#1a7f37":"#b42318"},children:f.text}),(0,e.jsx)("button",{type:"button",disabled:u,onClick:()=>a(this,void 0,void 0,function*(){var e,l,n,r,u,c,g,f,h;v(!0),b(null);try{const m=yield O();if(!(null==m?void 0:m.applyEdits))throw new Error("Layer non raggiungibile (applyEdits non disponibile).");let I=null;if(t.clickedPointWgs84?I=t.clickedPointWgs84:0===R&&F&&(I=p(k,D)),!I){if(1===R)throw new Error("Localizzazione obbligatoria: fai click in mappa per impostare il punto.");throw new Error("Geometria non impostata: configura le coordinate ufficio nel setting oppure fai click in mappa.")}const P="parziale"===j?w:"totale"===j?A:"",B="Art16"===_?"Art16":"Art17"===_&&z?z:_,E="Art16"===_?null!==(e=d.sup_dichiarata_art16)&&void 0!==e?e:null:"Art17.1"===z?null!==(l=d.sup_dichiarata_art17_1)&&void 0!==l?l:null:null!==(n=d.sup_dichiarata_art17_2)&&void 0!==n?n:null,L="Art16"===_||"Art17.2"===z?null!==(r=d.sup_irrigata_art16_17_2)&&void 0!==r?r:null:"Art17.1"===z&&null!==(u=d.sup_irrigata_art17_1)&&void 0!==u?u:null,M={};for(const[e,i]of Object.entries(X))M[i]=x.has(e)?1:null;const G=window.__giiUserRole||{},U=T(Object.assign(Object.assign({origine_pratica:2,stato_TI:1,utente_loggato:String(G.username||G.userId||""),area_cod:String(G.area||""),settore_cod:String(G.settore||""),tecnico_rilevatore:y("tecnico_rilevatore")||null,ufficio_zona:y("ufficio_zona")||null,data_rilevazione:W(y("data_rilevazione")),tipologia_soggetto:S||null,nome:("PF"===S?y("nome"):null)||null,cognome:("PF"===S?y("cognome"):null)||null,ragione_sociale:("PG"===S?y("ragione_sociale"):null)||null,codice_fiscale:("PF"===S?y("codice_fiscale"):null)||null,piva:("PG"===S?y("piva"):null)||null,via:y("via")||null,civico:y("civico")||null,citta:y("citta")||null,cap:y("cap")||null,email:y("email")||null,pec:y("pec")||null,telefono:y("telefono")||null,cellulare:y("cellulare")||null,tipo_abuso:j||null,norma15_parziale:("parziale"===j?w:null)||null,norma15_totale:("totale"===j?A:null)||null,norma_violata1:P||null,sup_dichiarata_art15:C?$(y("sup_dichiarata_art15")):null,sup_irrigata_art15:C?$(y("sup_irrigata_art15")):null,norma16_17:_||null,art17_tipo:("Art17"===_?z:null)||null,norma_violata2:B||null,sup_dichiarata_art17_1:"Art17"===_&&"Art17.1"===z?$(y("sup_dichiarata_art17_1")):null,sup_dichiarata_art16:"Art16"===_?$(y("sup_dichiarata_art16")):null,sup_dichiarata_art17_2:"Art17"===_&&"Art17.2"===z?$(y("sup_dichiarata_art17_2")):null,sup_irrigata_art16_17_2:"Art16"===_||"Art17.2"===z?$(y("sup_irrigata_art16_17_2")):null,sup_irrigata_art17_1:"Art17.1"===z?$(y("sup_irrigata_art17_1")):null,sup_dichiarata_art16_17:$(E),sup_irrigata_art16_17:$(L),norma_violata3:y("norma_violata3")||null},M),{descrizione_fatti:y("descrizione_fatti")||null,circostanze:y("circostanze")||null,presenza_trasgressore:y("presenza_trasgressore")||null,descrizione_luogo:y("descrizione_luogo")||null,data_firma:W(y("data_firma")),req_point:R}),m),J=yield m.applyEdits({addFeatures:[{attributes:U,geometry:I}]}),H=(null===(c=null==J?void 0:J.addFeatureResults)||void 0===c?void 0:c[0])||(null===(g=null==J?void 0:J.addResults)||void 0===g?void 0:g[0])||null,V=null==H?void 0:H.error;if(!(!V&&(null!=(null==H?void 0:H.objectId)||!0===(null==H?void 0:H.success)||null==(null==H?void 0:H.success))))throw new Error(V?`${null!==(f=V.code)&&void 0!==f?f:""}: ${null!==(h=V.message)&&void 0!==h?h:""}`:JSON.stringify(J));const Z=Number(H.objectId);yield N(o),yield function(e,t){return a(this,void 0,void 0,function*(){var l,n,o,a;if(!e||null==t)return;const r=Number(t),d=[["selectRecordsByIds",[[r]]],["selectRecordById",[r]],["setSelectedRecordIds",[[r]]],["setSelectedIds",[[r]]]];for(const[i,t]of d)try{if("function"==typeof e[i])return void(yield e[i](...t))}catch(e){}try{const t=null===(a=null===(o=null===(n=(l=i.DataSourceManager).getInstance)||void 0===n?void 0:n.call(l))||void 0===o?void 0:o.getSelectionManager)||void 0===a?void 0:a.call(o);(null==t?void 0:t.selectRecordByIds)&&(null==e?void 0:e.id)&&t.selectRecordByIds(e.id,[r])}catch(e){}})}(o,Z),b({kind:"ok",text:"Pratica creata."}),v(!1),setTimeout(()=>{s({}),b(null),t.onClearPoint(),t.onSaved(Z)},600)}catch(e){v(!1),b({kind:"err",text:`Errore: ${(null==e?void 0:e.message)||String(e)}`})}}),style:Object.assign(Object.assign({},U),{background:u?"#e5e7eb":"#1a7f37",color:u?"#9ca3af":"#fff"}),children:u?"Salvataggio\u2026":"\u{1f4be} Salva"}),(0,e.jsx)("button",{type:"button",disabled:u,onClick:()=>{s({}),t.onClearPoint()},style:Object.assign(Object.assign({},U),{background:"#fff",border:"1px solid rgba(0,0,0,0.18)",color:"#374151"}),children:"\u21ba Pulisci"})]})]}),(0,e.jsx)("div",{style:{flex:"0 0 auto",display:"flex",gap:6,padding:"8px 0",flexWrap:"wrap",borderBottom:"1px solid rgba(0,0,0,0.08)"},children:[{id:"anagrafica",label:"Anagrafica"},{id:"violazione",label:"Violazione"},{id:"allegati",label:"Allegati"}].map(i=>{return t=i.id,l=i.label,(0,e.jsx)("button",{type:"button",onClick:()=>M(t),style:{padding:"6px 14px",borderRadius:10,border:"1px solid "+(L===t?"#2f6fed":"rgba(0,0,0,0.12)"),background:L===t?"#eaf2ff":"rgba(0,0,0,0.02)",color:L===t?"#1d4ed8":"#374151",fontWeight:700,fontSize:12,cursor:"pointer",whiteSpace:"nowrap"},children:l},t);var t,l})}),(0,e.jsxs)("div",{style:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:"12px 2px"},children:["anagrafica"===L&&(0,e.jsxs)("div",{children:[G&&(0,e.jsxs)("div",{style:{marginBottom:14},children:[(0,e.jsx)("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:8},children:(0,e.jsx)("span",{style:{fontSize:13,color:"#6b7280"},children:"Dati generali (automatici)"})}),(0,e.jsxs)("div",{style:Q.row3,children:[(0,e.jsx)(ee,{label:"Tecnico istruttore",children:(0,e.jsx)(te,{value:y("tecnico_rilevatore"),onChange:()=>{},disabled:!0})}),(0,e.jsx)(ee,{label:"Ufficio di Zona",children:(0,e.jsx)(te,{value:y("ufficio_zona"),onChange:()=>{},disabled:!0})}),(0,e.jsx)(ee,{label:"Data rilevazione",children:(0,e.jsx)(te,{value:y("data_rilevazione"),onChange:()=>{},disabled:!0})})]})]}),(0,e.jsx)("div",{style:Object.assign(Object.assign({},Q.hdr),{marginTop:6}),children:"Trasgressore"}),(0,e.jsxs)("div",{style:Object.assign(Object.assign({},Q.row2),{marginBottom:12}),children:[(0,e.jsx)(ee,{label:"Tipologia soggetto",children:(0,e.jsx)(ie,{value:S,onChange:e=>m("tipologia_soggetto",e),options:K.tipo_soggetto,disabled:u})}),(0,e.jsx)("div",{})]}),"PF"===S&&(0,e.jsxs)("div",{style:Q.row3,children:[(0,e.jsx)(ee,{label:"Nome",children:(0,e.jsx)(te,{value:y("nome"),onChange:e=>m("nome",e),disabled:u})}),(0,e.jsx)(ee,{label:"Cognome",children:(0,e.jsx)(te,{value:y("cognome"),onChange:e=>m("cognome",e),disabled:u})}),(0,e.jsx)(ee,{label:"Codice fiscale",children:(0,e.jsx)(te,{value:y("codice_fiscale"),onChange:e=>m("codice_fiscale",e),disabled:u})})]}),"PG"===S&&(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"Ragione sociale",children:(0,e.jsx)(te,{value:y("ragione_sociale"),onChange:e=>m("ragione_sociale",e),disabled:u})}),(0,e.jsx)(ee,{label:"P. IVA",children:(0,e.jsx)(te,{value:y("piva"),onChange:e=>m("piva",e),disabled:u})})]}),(0,e.jsxs)("div",{style:Q.row3,children:[(0,e.jsx)(ee,{label:"Via",children:(0,e.jsx)(te,{value:y("via"),onChange:e=>m("via",e),disabled:u})}),(0,e.jsx)(ee,{label:"N. civico",children:(0,e.jsx)(te,{value:y("civico"),onChange:e=>m("civico",e),disabled:u})}),(0,e.jsx)(ee,{label:"Citt\xe0",children:(0,e.jsx)(te,{value:y("citta"),onChange:e=>m("citta",e),disabled:u})})]}),(0,e.jsxs)("div",{style:Q.row3,children:[(0,e.jsx)(ee,{label:"CAP",children:(0,e.jsx)(te,{value:y("cap"),onChange:e=>m("cap",e),disabled:u})}),(0,e.jsx)(ee,{label:"Telefono",children:(0,e.jsx)(te,{value:y("telefono"),onChange:e=>m("telefono",e),disabled:u})}),(0,e.jsx)(ee,{label:"Cellulare",children:(0,e.jsx)(te,{value:y("cellulare"),onChange:e=>m("cellulare",e),disabled:u})})]}),(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"E-mail",children:(0,e.jsx)(te,{value:y("email"),onChange:e=>m("email",e),disabled:u})}),(0,e.jsx)(ee,{label:"PEC",children:(0,e.jsx)(te,{value:y("pec"),onChange:e=>m("pec",e),disabled:u})})]})]}),"violazione"===L&&(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{style:{padding:10,borderRadius:10,border:"1px solid rgba(0,0,0,0.10)",background:"rgba(0,0,0,0.02)",marginBottom:12},children:[(0,e.jsxs)("div",{style:{fontWeight:800,fontSize:12,color:"#374151",marginBottom:6},children:["Localizzazione (req_point = ",R,")"]}),(0,e.jsx)("div",{style:{fontSize:12,color:"ok"===J.kind?"#1a7f37":"err"===J.kind?"#b42318":"#6b7280"},children:J.text}),t.clickedPointWgs84&&(0,e.jsxs)("div",{style:{marginTop:6,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[(0,e.jsxs)("span",{style:{fontSize:11,color:"#6b7280"},children:["Lon: ",Number(t.clickedPointWgs84.x).toFixed(6)," \u2014 Lat: ",Number(t.clickedPointWgs84.y).toFixed(6)]}),(0,e.jsx)("button",{type:"button",onClick:t.onClearPoint,style:{padding:"4px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.14)",background:"#fff",fontSize:11,fontWeight:700,cursor:"pointer"},children:"Rimuovi punto"})]})]}),(0,e.jsx)("div",{style:Q.hdr,children:"Art. 15 \u2014 Prelievo abusivo"}),(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"Tipo di abuso",children:(0,e.jsx)(ie,{value:j,onChange:e=>{m("tipo_abuso",e),m("norma15_parziale",""),m("norma15_totale","")},options:K.tipo_abuso,disabled:u})}),"parziale"===j&&(0,e.jsx)(ee,{label:"Seleziona violazione",children:(0,e.jsx)(ie,{value:w,onChange:e=>m("norma15_parziale",e),options:K.art15_parziale,disabled:u})}),"totale"===j&&(0,e.jsx)(ee,{label:"Seleziona violazione",children:(0,e.jsx)(ie,{value:A,onChange:e=>m("norma15_totale",e),options:K.art15_totale,disabled:u})})]}),C&&(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"Superficie dichiarata (ha)",children:(0,e.jsx)(le,{value:y("sup_dichiarata_art15"),onChange:e=>m("sup_dichiarata_art15",e),disabled:u})}),(0,e.jsx)(ee,{label:"Superficie irrigata (ha)",children:(0,e.jsx)(le,{value:y("sup_irrigata_art15"),onChange:e=>m("sup_irrigata_art15",e),disabled:u})})]}),(0,e.jsx)("div",{style:Q.hdr,children:"Artt. 16 e 17 \u2014 Inosservanza termini"}),(0,e.jsx)(ee,{label:"Tipo di inosservanza",children:(0,e.jsx)(ie,{value:_,onChange:e=>{m("norma16_17",e),m("art17_tipo","")},options:K.art16_17,disabled:u})}),"Art17"===_&&(0,e.jsx)(ee,{label:"Seleziona violazione Art. 17",children:(0,e.jsx)(ie,{value:z,onChange:e=>m("art17_tipo",e),options:K.art17_tipo,disabled:u})}),"Art16"===_&&(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"Superficie dichiarata (ha)",children:(0,e.jsx)(le,{value:y("sup_dichiarata_art16"),onChange:e=>m("sup_dichiarata_art16",e),disabled:u})}),(0,e.jsx)(ee,{label:"Superficie irrigata (ha)",children:(0,e.jsx)(le,{value:y("sup_irrigata_art16_17_2"),onChange:e=>m("sup_irrigata_art16_17_2",e),disabled:u})})]}),"Art17"===_&&"Art17.1"===z&&(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"Superficie dichiarata (ha)",children:(0,e.jsx)(le,{value:y("sup_dichiarata_art17_1"),onChange:e=>m("sup_dichiarata_art17_1",e),disabled:u})}),(0,e.jsx)(ee,{label:"Superficie variata (ha)",children:(0,e.jsx)(le,{value:y("sup_irrigata_art17_1"),onChange:e=>m("sup_irrigata_art17_1",e),disabled:u})})]}),"Art17"===_&&"Art17.2"===z&&(0,e.jsxs)("div",{style:Q.row2,children:[(0,e.jsx)(ee,{label:"Superficie dichiarata (ha)",children:(0,e.jsx)(le,{value:y("sup_dichiarata_art17_2"),onChange:e=>m("sup_dichiarata_art17_2",e),disabled:u})}),(0,e.jsx)(ee,{label:"Superficie irrigata (ha)",children:(0,e.jsx)(le,{value:y("sup_irrigata_art16_17_2"),onChange:e=>m("sup_irrigata_art16_17_2",e),disabled:u})})]}),(0,e.jsx)("div",{style:Q.hdr,children:"Altre violazioni"}),(0,e.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:K.norma3.map(i=>(0,e.jsxs)("label",{style:{display:"flex",alignItems:"flex-start",gap:8,fontSize:12,color:"#374151",cursor:u?"not-allowed":"pointer",padding:"4px 0"},children:[(0,e.jsx)("input",{type:"checkbox",checked:x.has(i.v),onChange:()=>!u&&(e=>{const i=new Set(x);i.has(e)?i.delete(e):i.add(e),m("norma_violata3",Array.from(i).join(" "))})(i.v),style:{marginTop:2,flexShrink:0}}),i.l]},i.v))}),(0,e.jsx)("div",{style:Q.hdr,children:"Descrizione"}),(0,e.jsx)(ee,{label:"Descrizione dettagliata della violazione",children:(0,e.jsx)(te,{value:y("descrizione_fatti"),onChange:e=>m("descrizione_fatti",e),multiline:!0,disabled:u})}),(0,e.jsx)(ee,{label:"Circostanze rilevanti",children:(0,e.jsx)(te,{value:y("circostanze"),onChange:e=>m("circostanze",e),multiline:!0,disabled:u})}),(0,e.jsx)(ee,{label:"Il trasgressore era presente?",children:(0,e.jsx)(ie,{value:y("presenza_trasgressore"),onChange:e=>m("presenza_trasgressore",e),options:K.presenza,disabled:u})}),(0,e.jsx)("div",{style:Q.hdr,children:"Descrizione del luogo"}),(0,e.jsx)(ee,{label:"Descrizione del luogo",children:(0,e.jsx)(te,{value:y("descrizione_luogo"),onChange:e=>m("descrizione_luogo",e),multiline:!0,disabled:u})}),(0,e.jsx)("div",{style:Q.hdr,children:"Fine compilazione"}),(0,e.jsx)(ee,{label:"Data e ora di compilazione",children:(0,e.jsx)(ne,{value:y("data_firma"),onChange:e=>m("data_firma",e),withTime:!0,disabled:u})})]}),"allegati"===L&&(0,e.jsxs)("div",{style:{padding:12,borderRadius:10,border:"1px dashed rgba(0,0,0,0.18)",background:"rgba(0,0,0,0.01)"},children:[(0,e.jsx)("div",{style:{fontWeight:800,fontSize:13,marginBottom:6},children:"Allegati"}),(0,e.jsxs)("div",{style:{fontSize:12,color:"#6b7280",lineHeight:1.5},children:["Gli allegati si gestiscono ",(0,e.jsx)("b",{children:"dopo il salvataggio"})," della pratica (serve l'OBJECTID). Dopo aver creato la pratica, comparir\xe0 nell'Elenco: selezionala e usa la tab ",(0,e.jsx)("b",{children:"Allegati"})," in modalit\xe0 modifica."]})]})]})]})}function ae(t){var l,n,o,r,d,s,g,p,v,b,h,S,j;const{active:_,ui:z}=t,w=i.React.useMemo(()=>Z(t.tabFields,t.tabs),[t.tabs,t.tabFields]),A=(null!=(null===(l=null==_?void 0:_.state)||void 0===l?void 0:l.oid)&&(_.key,_.state.oid),null===(n=null==_?void 0:_.state)||void 0===n?void 0:n.ds),C=(null===(o=null==_?void 0:_.state)||void 0===o?void 0:o.data)||null,R=null!==(d=null===(r=null==_?void 0:_.state)||void 0===r?void 0:r.oid)&&void 0!==d?d:null,T=null!=R&&Number.isFinite(R),I=i.React.useMemo(()=>{var e,i;if(!T||!C)return"";const t=null!==(i=null!==(e=C.origine_pratica)&&void 0!==e?e:C.Origine_pratica)&&void 0!==i?i:C.ORIGINE_PRATICA;let l="TR";return 2===t||"2"===t||"TI"===String(t).toUpperCase()?l="TI":1!==t&&"1"!==t&&"TR"!==String(t).toUpperCase()||(l="TR"),`${l}-${R}`},[T,C,R]),[N,k]=i.React.useState((null===(s=w[0])||void 0===s?void 0:s.id)||"anagrafica"),D=T&&null!=R?Number(R):null,[F,P]=i.React.useState(null),[B,E]=i.React.useState([]),[O,W]=i.React.useState(!1),[$,L]=i.React.useState(null),M=i.React.useCallback(e=>{if(null==e||isNaN(Number(e)))return"";const i=Number(e);if(i<1024)return`${i} B`;const t=i/1024;if(t<1024)return`${t.toFixed(1)} KB`;const l=t/1024;if(l<1024)return`${l.toFixed(1)} MB`;return`${(l/1024).toFixed(1)} GB`},[]),G=i.React.useCallback(()=>a(this,void 0,void 0,function*(){if(D)try{W(!0),L(null);const e=A,t=yield function(e){return a(this,void 0,void 0,function*(){var t,l,n,o,a,r,d;if(!e)return null;const s=[],g=e=>{e&&!s.includes(e)&&s.push(e)};g(e);try{const t=i.DataSourceManager.getInstance();g((null==e?void 0:e.id)?t.getDataSource(e.id):null);const l=null==e?void 0:e.belongToDataSource;"string"==typeof l&&l&&g(t.getDataSource(l))}catch(e){}for(const e of s){const i=e,o=u(null!==(n=null!==(l=null!==(t="function"==typeof i.getLayer?i.getLayer():null)&&void 0!==t?t:"function"==typeof i.getJsApiLayer?i.getJsApiLayer():null)&&void 0!==l?l:"function"==typeof i.getJSAPILayer?i.getJSAPILayer():null)&&void 0!==n?n:i.layer);if(o&&"function"==typeof o.queryAttachments)return o}try{const i=e,t=null!==(r=null===(a=null===(o=null==i?void 0:i.getDataSourceJson)||void 0===o?void 0:o.call(i))||void 0===a?void 0:a.url)&&void 0!==r?r:null===(d=null==i?void 0:i.dataSourceJson)||void 0===d?void 0:d.url;if(!t||"string"!=typeof t)return null;const l=new(yield c("esri/layers/FeatureLayer"))({url:t});if("function"==typeof(null==l?void 0:l.load)&&(yield l.load().catch(()=>{})),l&&"function"==typeof l.queryAttachments)return l}catch(e){}return null})}(e);if(!t)return E([]),P(D),void L("Non riesco a risalire al FeatureLayer per leggere gli allegati (datasource/vista non espone il layer JS API).");const l=yield t.queryAttachments({objectIds:[D],returnMetadata:!0,returnUrl:!0}),n=e=>e?Array.isArray(e)?e:Array.isArray(e.attachmentInfos)?e.attachmentInfos:Array.isArray(e.attachments)?e.attachments:[]:[];let o=[];if(Array.isArray(l))for(const e of l){if(!e)continue;if((null!=e.parentObjectId?e.parentObjectId:null!=e.objectId?e.objectId:null)===D){o=n(e);break}}else if(l&&"object"==typeof l)if(Array.isArray(l.attachmentGroups))for(const e of l.attachmentGroups){if((e&&null!=e.parentObjectId?e.parentObjectId:e&&null!=e.objectId?e.objectId:null)===D){o=n(e);break}}else l[D]?o=n(l[D]):l[String(D)]?o=n(l[String(D)]):l.attachmentInfos&&(o=n(l));const r=(o||[]).map(e=>({id:Number(e.id),name:e.name,size:e.size,contentType:e.contentType,url:e.url})).filter(e=>e&&!isNaN(e.id));E(r),P(D)}catch(e){E([]),P(D),L((null==e?void 0:e.message)||String(e))}finally{W(!1)}}),[A,D]);i.React.useEffect(()=>{"allegati"===N&&null!=D&&F!==D&&G()},[N,D,F]);const[U,V]=i.React.useState({}),[K,X]=i.React.useState(!1);i.React.useEffect(()=>{var e;let i=!1;X(!1);try{const t=null===(e=null==A?void 0:A.getSchema)||void 0===e?void 0:e.call(A),l=(null==t?void 0:t.fields)||{},n={};for(const e of Object.keys(l)){const i=l[e],t=String((null==i?void 0:i.alias)||(null==i?void 0:i.label)||(null==i?void 0:i.title)||e);n[e]=t}!i&&Object.keys(n).length&&(V(n),X(!0))}catch(e){}return(()=>{a(this,void 0,void 0,function*(){var e,t,l;if(A)try{const n=(null===(e=null==A?void 0:A.getLayer)||void 0===e?void 0:e.call(A))||(null===(t=null==A?void 0:A.getJSAPILayer)||void 0===t?void 0:t.call(A))||(null==A?void 0:A.layer)||(null===(l=null==A?void 0:A.createJSAPILayerByDataSource)||void 0===l?void 0:l.call(A))||null,o=u(yield Promise.resolve(n)),a=(null==o?void 0:o.fields)||[],r={};for(const e of a){const i=String((null==e?void 0:e.name)||"");i&&(r[i]=String((null==e?void 0:e.alias)||(null==e?void 0:e.label)||(null==e?void 0:e.title)||i))}i||(Object.keys(r).length&&V(r),X(!0))}catch(e){i||X(!0)}else i||(V({}),X(!0))})})(),()=>{i=!0}},[A]);const Q=i.React.useCallback(e=>{const i=null==U?void 0:U[e];return K?i?`${i}`:e:""},[U,K]),ee=i.React.useCallback((e,i)=>x(e,i),[]),ie=i.React.useCallback(e=>{const i=`${f(e)} ${f((null==U?void 0:U[e])||"")}`.trim(),t=y(i,"nome")||i.startsWith("nome "),l=y(i,"cognome")||i.startsWith("cognome "),n=y(i,"cf")||y(i,"c f")||y(i,"c f ")||y(i,"codice fiscale")||i.includes("cod")&&i.includes("fisc");return Boolean(t||l||n)},[U]),te=i.React.useCallback(e=>{const i=`${f(e)} ${f((null==U?void 0:U[e])||"")}`.trim(),t=y(i,"ragione sociale")||y(i,"denominazione")||i.includes("ragione")&&i.includes("social"),l=y(i,"partita iva")||y(i,"p iva")||y(i,"piva")||i.includes("partita")&&i.includes("iva");return Boolean(t||l)},[U]),le=i.React.useCallback((e,i,t)=>{const l=e&&e.length?e:[],n=C&&null!=C.__tipo_soggetto_raw?C.__tipo_soggetto_raw:C&&null!=C.tipo_soggetto?C.tipo_soggetto:null,o=C&&null!=C.__tipo_soggetto_label?C.__tipo_soggetto_label:null,a="ANAGRAFICA"===i?ee(n,o):null,r="ANAGRAFICA"===i&&a?l.filter(e=>!!e&&(("PF"!==a||!te(e))&&("PG"!==a||!ie(e)))):l,d=[];for(const e of r){if(!e)continue;const i=C?C[e]:null;t&&m(i)||d.push({label:Q(e),value:i})}return d},[C,Q,ee,ie,te]),ne=C?C.presa_in_carico_DT:null,oe=C?C.dt_presa_in_carico_DT:null,ae=C?C.stato_DT:null,re=C?C.dt_stato_DT:null,de=C?C.esito_DT:null,se=C?C.dt_esito_DT:null,ue=C?C.note_DT:null,ce=C?C.presa_in_carico_DA:null,ge=C?C.dt_presa_in_carico_DA:null,pe=C?C.stato_DA:null,ve=C?C.dt_stato_DA:null,fe=C?C.esito_DA:null,be=C?C.dt_esito_DA:null,he=C?C.note_DA:null,me=(0,e.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,padding:"8px 12px",alignItems:"center",borderBottom:"1px solid rgba(0,0,0,0.08)",background:"var(--bs-body-bg, #fff)",marginTop:-z.panelPadding,marginLeft:-z.panelPadding,marginRight:-z.panelPadding,width:`calc(100% + ${2*z.panelPadding}px)`,borderTopLeftRadius:z.panelBorderRadius,borderTopRightRadius:z.panelBorderRadius},children:T&&w.map(i=>(0,e.jsx)(q,{active:N===i.id,label:i.label,onClick:()=>k(i.id)},i.id))}),ye={width:"100%",height:"100%",flex:"1 1 auto",display:"flex",flexDirection:"column",minHeight:0,boxSizing:"border-box",background:z.panelBg,border:`${z.panelBorderWidth}px solid ${z.panelBorderColor}`,borderRadius:z.panelBorderRadius,padding:z.panelPadding};let xe=null;if(T){const i=w.find(e=>e.id===N);if("azioni"===(null==i?void 0:i.id))xe=(0,e.jsx)(J,{active:_,roleCode:t.roleCode,buttonText:t.buttonText,buttonColors:t.buttonColors,ui:t.ui,editConfig:t.editConfig,motherLayerUrl:t.motherLayerUrl});else if(null==i?void 0:i.isIterTab){const t=[];t.push({label:"DT - Presa in carico",value:ne}),t.push({label:"DT - Data presa in carico",value:H(oe)}),t.push({label:"DT - Stato",value:ae}),t.push({label:"DT - Data stato",value:H(re)}),t.push({label:"DT - Esito",value:de}),t.push({label:"DT - Data esito",value:H(se)}),t.push({label:"DT - Note",value:ue}),t.push({label:"DA - Presa in carico",value:ce}),t.push({label:"DA - Data presa in carico",value:H(ge)}),t.push({label:"DA - Stato",value:pe}),t.push({label:"DA - Data stato",value:H(ve)}),t.push({label:"DA - Esito",value:fe}),t.push({label:"DA - Data esito",value:H(be)}),t.push({label:"DA - Note",value:he});(K?le(i.fields,i.id.toUpperCase(),Boolean(i.hideEmpty)):[]).forEach(e=>t.push(e)),xe=(0,e.jsx)(Y,{title:i.label,ui:z,rows:t})}else if(i){const t=K?le(i.fields,i.id.toUpperCase(),Boolean(i.hideEmpty)):[];if("allegati"===i.id){const l=A,n=u((l&&"function"==typeof l.getLayer?l.getLayer():null)||(l&&"function"==typeof l.getJsApiLayer?l.getJsApiLayer():null)||l&&l.layer||l),o=n&&n.url?String(n.url):"",a=e=>e&&e.url?String(e.url):o&&null!=D&&e&&null!=e.id?`${o}/${D}/attachments/${e.id}`:null;xe=(0,e.jsxs)("div",{style:{marginTop:8},children:[(0,e.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[(0,e.jsx)("div",{style:{fontWeight:700,fontSize:13},children:"Allegati"}),(0,e.jsx)("button",{type:"button",onClick:()=>G(),disabled:!T||O,onMouseEnter:e=>{T&&!O&&(e.currentTarget.style.background="#eaf2ff",e.currentTarget.style.borderColor="#2f6fed",e.currentTarget.style.color="#1d4ed8")},onMouseLeave:e=>{T&&!O&&(e.currentTarget.style.background="#fff",e.currentTarget.style.borderColor="rgba(0,0,0,0.12)",e.currentTarget.style.color="#111827")},style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.12)",background:"#fff",color:"#111827",cursor:!T||O?"not-allowed":"pointer",fontSize:12,fontWeight:600,transition:"all 0.15s ease"},children:"Aggiorna"})]}),!T&&(0,e.jsx)("div",{style:{opacity:.75,fontSize:12},children:"Selezionare un rapporto per vedere gli allegati."}),T&&O&&(0,e.jsx)("div",{style:{opacity:.75,fontSize:12},children:"Caricamento allegati\u2026"}),T&&!O&&$&&(0,e.jsx)("div",{style:{color:"#b00020",fontSize:12},children:$}),T&&!O&&!$&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:B&&B.length?B.map(i=>{const t=a(i),l=[i.contentType,M(i.size)].filter(Boolean).join(" \u2022 ");return(0,e.jsxs)("div",{style:{border:"1px solid rgba(0,0,0,0.08)",borderRadius:12,padding:"8px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:10},children:[(0,e.jsxs)("div",{style:{minWidth:0},children:[(0,e.jsx)("div",{style:{fontWeight:600,fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name||`Allegato #${i.id}`}),l?(0,e.jsx)("div",{style:{opacity:.7,fontSize:11},children:l}):null]}),t?(0,e.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",onMouseEnter:e=>{e.currentTarget.style.background="#eaf2ff",e.currentTarget.style.borderColor="#2f6fed",e.currentTarget.style.color="#1d4ed8"},onMouseLeave:e=>{e.currentTarget.style.background="#fff",e.currentTarget.style.borderColor="rgba(0,0,0,0.12)",e.currentTarget.style.color="#111827"},style:{padding:"6px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.12)",background:"#fff",color:"#111827",textDecoration:"none",fontSize:12,fontWeight:600,whiteSpace:"nowrap",transition:"all 0.15s ease"},children:"Apri"}):(0,e.jsx)("span",{style:{opacity:.6,fontSize:12,whiteSpace:"nowrap"},children:"URL non disponibile"})]},i.id)}):(0,e.jsx)("div",{style:{opacity:.75,fontSize:12},children:"Nessun allegato."})}),t&&t.length>0&&(0,e.jsxs)("div",{style:{marginTop:12},children:[(0,e.jsx)("div",{style:{fontWeight:700,fontSize:13,marginBottom:6},children:"Attributi"}),(0,e.jsx)(Y,{title:i.label,rows:t,emptyText:T?"Nessun campo configurato per questa tab.":"Selezionare un rapporto."})]})]})}else xe=(0,e.jsx)(Y,{title:i.label,rows:t,emptyText:T?"Nessun campo configurato per questa tab.":"Selezionare un rapporto."})}}else xe=(0,e.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",minHeight:200,fontSize:13,color:"rgba(0,0,0,0.45)"},children:"Seleziona una pratica dall'Elenco."});return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",minHeight:0,boxSizing:"border-box"},children:[(0,e.jsx)("div",{style:{height:null!==(g=z.detailTitleHeight)&&void 0!==g?g:28,paddingBottom:null!==(p=z.detailTitlePaddingBottom)&&void 0!==p?p:10,paddingLeft:null!==(v=z.detailTitlePaddingLeft)&&void 0!==v?v:0,display:"flex",alignItems:"center",boxSizing:"border-box",flex:"0 0 auto",background:z.detailTitleBg&&"transparent"!==z.detailTitleBg?z.detailTitleBg:void 0},children:(0,e.jsxs)("span",{style:{fontSize:null!==(b=z.detailTitleFontSize)&&void 0!==b?b:14,fontWeight:null!==(h=z.detailTitleFontWeight)&&void 0!==h?h:600,color:T&&I?null!==(S=z.detailTitleColor)&&void 0!==S?S:"rgba(0,0,0,0.85)":"rgba(0,0,0,0.40)"},children:[String(null!==(j=z.detailTitlePrefix)&&void 0!==j?j:"Dettaglio rapporto n.")," ",T&&I?I:"\u2013"]})}),(0,e.jsxs)("div",{style:ye,children:[(0,e.jsx)("div",{style:{flex:"0 0 auto"},children:me}),(0,e.jsx)("div",{style:{flex:"1 1 auto",minHeight:0,overflowY:"auto"},children:xe})]})]})}function re(l){var n,r,d,s,u,v,f,b,h,m,y,x,S,j,w,A,C,R,T,I,N,k,D,F,P,B,E,O,W,$;const L=l.config&&l.config.asMutable?l.config.asMutable({deep:!0}):l.config||{},M=Object.assign(Object.assign({},o),L),[U,J]=i.React.useState("");i.React.useEffect(()=>{var e;try{const i=null===(e=window.__giiUserRole)||void 0===e?void 0:e.ruoloLabel;i&&"ADMIN"!==i&&J(String(i).toUpperCase())}catch(e){}let i=0;const t=setInterval(()=>{var e;i++;try{const i=null===(e=window.__giiUserRole)||void 0===e?void 0:e.ruoloLabel;i&&"ADMIN"!==i&&(J(String(i).toUpperCase()),clearInterval(t))}catch(e){}i>=20&&clearInterval(t)},500);return()=>clearInterval(t)},[]);const H=!0===M.showDatiGenerali,q=U||String(M.roleCode||"DT").toUpperCase(),Y=String(M.buttonText||"Prendi in carico"),K={take:G(M.takeColor,o.takeColor),integrazione:G(M.integrazioneColor,o.integrazioneColor),approva:G(M.approvaColor,o.approvaColor),respingi:G(M.respingiColor,o.respingiColor),trasmetti:G(M.trasmettiColor,o.trasmettiColor)},X={panelBg:String(null!==(d=null!==(r=null!==(n=M.maskBg)&&void 0!==n?n:M.panelBg)&&void 0!==r?r:o.maskBg)&&void 0!==d?d:o.panelBg),panelBorderColor:String(null!==(v=null!==(u=null!==(s=M.maskBorderColor)&&void 0!==s?s:M.panelBorderColor)&&void 0!==u?u:o.maskBorderColor)&&void 0!==v?v:o.panelBorderColor),panelBorderWidth:Number.isFinite(Number(null!==(f=M.maskBorderWidth)&&void 0!==f?f:M.panelBorderWidth))?Number(null!==(b=M.maskBorderWidth)&&void 0!==b?b:M.panelBorderWidth):null!==(h=o.maskBorderWidth)&&void 0!==h?h:o.panelBorderWidth,panelBorderRadius:Number.isFinite(Number(null!==(m=M.maskBorderRadius)&&void 0!==m?m:M.panelBorderRadius))?Number(null!==(y=M.maskBorderRadius)&&void 0!==y?y:M.panelBorderRadius):null!==(x=o.maskBorderRadius)&&void 0!==x?x:o.panelBorderRadius,panelPadding:Number.isFinite(Number(null!==(S=M.maskInnerPadding)&&void 0!==S?S:M.panelPadding))?Number(null!==(j=M.maskInnerPadding)&&void 0!==j?j:M.panelPadding):null!==(w=o.maskInnerPadding)&&void 0!==w?w:o.panelPadding,dividerColor:String(null!==(A=M.dividerColor)&&void 0!==A?A:o.dividerColor),titleFontSize:Number.isFinite(Number(M.titleFontSize))?Number(M.titleFontSize):o.titleFontSize,statusFontSize:Number.isFinite(Number(M.statusFontSize))?Number(M.statusFontSize):o.statusFontSize,msgFontSize:Number.isFinite(Number(M.msgFontSize))?Number(M.msgFontSize):o.msgFontSize,rejectReasons:Array.isArray(M.rejectReasons)?M.rejectReasons.map(e=>String(e)):o.rejectReasons,reasonsZebraOddBg:String(null!==(C=M.reasonsZebraOddBg)&&void 0!==C?C:o.reasonsZebraOddBg),reasonsZebraEvenBg:String(null!==(R=M.reasonsZebraEvenBg)&&void 0!==R?R:o.reasonsZebraEvenBg),reasonsRowBorderColor:String(null!==(T=M.reasonsRowBorderColor)&&void 0!==T?T:o.reasonsRowBorderColor),reasonsRowBorderWidth:Number.isFinite(Number(M.reasonsRowBorderWidth))?Number(M.reasonsRowBorderWidth):o.reasonsRowBorderWidth,reasonsRowRadius:Number.isFinite(Number(M.reasonsRowRadius))?Number(M.reasonsRowRadius):o.reasonsRowRadius,detailTitlePrefix:String(null!==(I=M.detailTitlePrefix)&&void 0!==I?I:o.detailTitlePrefix),detailTitleHeight:Number.isFinite(Number(M.detailTitleHeight))?Number(M.detailTitleHeight):o.detailTitleHeight,detailTitlePaddingBottom:Number.isFinite(Number(M.detailTitlePaddingBottom))?Number(M.detailTitlePaddingBottom):o.detailTitlePaddingBottom,detailTitlePaddingLeft:Number.isFinite(Number(M.detailTitlePaddingLeft))?Number(M.detailTitlePaddingLeft):o.detailTitlePaddingLeft,detailTitleFontSize:Number.isFinite(Number(M.detailTitleFontSize))?Number(M.detailTitleFontSize):o.detailTitleFontSize,detailTitleFontWeight:Number.isFinite(Number(M.detailTitleFontWeight))?Number(M.detailTitleFontWeight):o.detailTitleFontWeight,detailTitleColor:String(null!==(N=M.detailTitleColor)&&void 0!==N?N:o.detailTitleColor),detailTitleBg:String(null!==(D=null!==(k=M.detailTitleBg)&&void 0!==k?k:o.detailTitleBg)&&void 0!==D?D:"transparent"),btnBorderRadius:Number.isFinite(Number(M.btnBorderRadius))?Number(M.btnBorderRadius):null!==(F=o.btnBorderRadius)&&void 0!==F?F:8,btnFontSize:Number.isFinite(Number(M.btnFontSize))?Number(M.btnFontSize):null!==(P=o.btnFontSize)&&void 0!==P?P:13,btnFontWeight:Number.isFinite(Number(M.btnFontWeight))?Number(M.btnFontWeight):null!==(B=o.btnFontWeight)&&void 0!==B?B:600,btnPaddingX:Number.isFinite(Number(M.btnPaddingX))?Number(M.btnPaddingX):null!==(E=o.btnPaddingX)&&void 0!==E?E:16,btnPaddingY:Number.isFinite(Number(M.btnPaddingY))?Number(M.btnPaddingY):null!==(O=o.btnPaddingY)&&void 0!==O?O:8},Q={anagrafica:V(M.anagraficaFields),violazione:V(M.violazioneFields),allegati:V(M.allegatiFields),iterExtra:V(M.iterExtraFields)},ee=Z(Q,M.tabs||[]),ie={show:!1!==M.showEditButtons,overlayColor:G(M.editOverlayColor,"#7c3aed"),pageColor:G(M.editPageColor,"#5b21b6"),pageId:String(M.editPageId||"editing-ti"),fieldStatoTI:String(M.fieldStatoTI||"stato_TI"),fieldPresaTI:String(M.fieldPresaTI||"presa_in_carico_TI"),minStato:Number.isFinite(Number(M.editMinStato))?Number(M.editMinStato):2,maxStato:Number.isFinite(Number(M.editMaxStato))?Number(M.editMaxStato):2,presaRequiredVal:Number.isFinite(Number(M.editPresaRequiredVal))?Number(M.editPresaRequiredVal):2},te=l.useDataSources||[],le=Array.isArray(te)&&te.length>0,ne=["presa_in_carico_DT","dt_presa_in_carico_DT","stato_DT","dt_stato_DT","esito_DT","dt_esito_DT","note_DT","presa_in_carico_DA","dt_presa_in_carico_DA","stato_DA","dt_stato_DA","esito_DA","dt_esito_DA","note_DA"],[re,de]=i.React.useState({}),[se,ue]=i.React.useState(null),ce=i.React.useCallback((e,i)=>{de(t=>{const l=t[e];return l&&l.ds===i.ds&&l.sig===i.sig&&l.idFieldName===i.idFieldName?t:Object.assign(Object.assign({},t),{[e]:i})}),null!=i.oid&&ue(e)},[]),ge=i.React.useMemo(()=>{var e,t;for(const i of Object.keys(re))if(null===(e=re[i])||void 0===e?void 0:e.ds)return re[i].ds;if(te.length>0)try{const e=null===(t=te[0])||void 0===t?void 0:t.dataSourceId;if(e){const t=i.DataSourceManager.getInstance().getDataSource(e);if(t)return t}}catch(e){}return null},[re,te]),pe=i.React.useMemo(()=>{var e;if(se&&null!=(null===(e=re[se])||void 0===e?void 0:e.oid))return{key:se,state:re[se]};for(let e=0;e<te.length;e++){const i=_(te[e],e),t=re[i];if(t&&null!=t.oid)return{key:i,state:t}}return null},[te,re,se]),ve=Array.isArray(M.useMapWidgetIds)?M.useMapWidgetIds[0]:null,[fe,be]=i.React.useState(null),[he,me]=i.React.useState(null);i.React.useEffect(()=>{const e=null==fe?void 0:fe.view;if(!e||"function"!=typeof e.on)return;const i=e.on("click",e=>{(()=>a(this,void 0,void 0,function*(){const i=yield function(e){return a(this,void 0,void 0,function*(){var i,t,l;if(!e)return null;const n=null===(i=null==e?void 0:e.spatialReference)||void 0===i?void 0:i.wkid;if(4326===n){const i=g(e.longitude)?e.longitude:e.x,t=g(e.latitude)?e.latitude:e.y;return g(i)&&g(t)?p(Number(i),Number(t)):null}if(3857===n||102100===n)try{const i=yield c("esri/geometry/support/webMercatorUtils"),l=null===(t=null==i?void 0:i.webMercatorToGeographic)||void 0===t?void 0:t.call(i,e);if(l)return p(Number(l.x),Number(l.y))}catch(e){}try{const i=yield c("esri/geometry/SpatialReference"),t=yield c("esri/geometry/projection");(null==t?void 0:t.load)&&(yield t.load());const n=null===(l=null==t?void 0:t.project)||void 0===l?void 0:l.call(t,e,new i({wkid:4326}));if(n)return p(Number(n.x),Number(n.y))}catch(e){}return null})}(null==e?void 0:e.mapPoint);i&&me(i)}))().catch(()=>{})});return()=>{var e;try{null===(e=null==i?void 0:i.remove)||void 0===e||e.call(i)}catch(e){}}},[fe]);const ye=!1!==M.enableCreateWithoutSelection&&!(null!=(null===(W=null==pe?void 0:pe.state)||void 0===W?void 0:W.oid));return(0,e.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",minHeight:0,boxSizing:"border-box",padding:Number.isFinite(Number(null!==($=M.maskOuterOffset)&&void 0!==$?$:0))?Number(M.maskOuterOffset):0},children:le?(0,e.jsxs)(e.Fragment,{children:[te.map((i,t)=>{const n=_(i,t);return(0,e.jsx)(z,{widgetId:l.id,uds:i,dsKey:n,watchFields:ne,onUpdate:ce},n)}),ve&&(0,e.jsx)("div",{style:{display:"none"},children:(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:ve,onActiveViewChange:e=>{be(e)}})}),ye?ge?(0,e.jsx)(oe,{ds:ge,cfg:M,showDatiGenerali:H,clickedPointWgs84:he,onClearPoint:()=>me(null),onSaved:e=>{}}):(0,e.jsx)("div",{style:{padding:12},children:"Datasource non pronto: attendi il caricamento oppure verifica la configurazione."}):(0,e.jsx)(ae,{active:pe,anyDs:ge,showDatiGenerali:H,roleCode:q,buttonText:Y,buttonColors:K,ui:X,tabFields:Q,tabs:ee,editConfig:ie,motherLayerUrl:String(M.motherLayerUrl||"").trim()||void 0})]}):(0,e.jsx)("div",{children:"Configura il data source nelle impostazioni del widget."})})}function de(e){r.p=e}})(),d})())}}});