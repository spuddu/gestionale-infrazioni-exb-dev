System.register(["jimu-core/emotion","jimu-core","jimu-ui"],function(e,t){var i={},r={},n={};return{setters:[function(e){i.Fragment=e.Fragment,i.jsx=e.jsx,i.jsxs=e.jsxs},function(e){r.DataSourceComponent=e.DataSourceComponent,r.DataSourceManager=e.DataSourceManager,r.DataSourceStatus=e.DataSourceStatus,r.Immutable=e.Immutable,r.React=e.React,r.SessionManager=e.SessionManager,r.css=e.css},function(e){n.Button=e.Button,n.Loading=e.Loading}],execute:function(){e((()=>{var e={244(e){"use strict";e.exports=r},321(e){"use strict";e.exports=n},386(e){"use strict";e.exports=i}},t={};function o(i){var r=t[i];if(void 0!==r)return r.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var l={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(l),o.d(l,{__set_webpack_public_path__:()=>N,default:()=>A});var e=o(386),t=o(244),i=o(321);const r=[{id:"col_pratica",label:"N. pratica",field:"objectid",width:120},{id:"col_data",label:"Data rilev.",field:"data_rilevazione",width:150},{id:"col_stato",label:"Stato sintetico",field:"__stato_sint__",width:220},{id:"col_ufficio",label:"Ufficio",field:"ufficio_zona",width:170},{id:"col_ultimo",label:"Ultimo agg.",field:"__ultimo_agg__",width:170},{id:"col_prossima",label:"Prossima azione",field:"__prossima__",width:240}],n=(0,t.Immutable)({filterTabs:[],columns:r,orderByField:"objectid",orderByDir:"DESC",fieldPratica:"objectid",fieldDataRilevazione:"data_rilevazione",fieldUfficio:"ufficio_zona",fieldPresaDT:"presa_in_carico_DT",fieldDtPresaDT:"dt_presa_in_carico_DT",fieldStatoDT:"stato_DT",fieldDtStatoDT:"dt_stato_DT",fieldEsitoDT:"esito_DT",fieldDtEsitoDT:"dt_esito_DT",fieldPresaDA:"presa_in_carico_DA",fieldDtPresaDA:"dt_presa_in_carico_DA",fieldStatoDA:"stato_DA",fieldDtStatoDA:"dt_stato_DA",fieldEsitoDA:"esito_DA",fieldDtEsitoDA:"dt_esito_DA",presaDaPrendereVal:1,presaPresaVal:2,labelPresaDaPrendere:"Da prendere in carico",labelPresaPresa:"Presa in carico",statoDaPrendereVal:1,statoPresaVal:2,statoIntegrazioneVal:3,statoApprovataVal:4,statoRespintaVal:5,labelStatoDaPrendere:"Da prendere",labelStatoPresa:"Presa in carico",labelStatoIntegrazione:"Integrazione richiesta",labelStatoApprovata:"Approvata",labelStatoRespinta:"Respinta",esitoIntegrazioneVal:1,esitoApprovataVal:2,esitoRespintaVal:3,labelEsitoIntegrazione:"Integrazione richiesta",labelEsitoApprovata:"Approvata",labelEsitoRespinta:"Respinta",whereClause:"1=1",pageSize:200,showHeader:!0,headerPratica:"N. pratica",headerData:"Data rilev.",headerUfficio:"Ufficio",headerStato:"Stato sintetico",headerUltimoAgg:"Ultimo agg.",headerProssima:"Prossima azione",paddingLeftFirstCol:0,gap:12,colWidths:{pratica:120,data:150,stato:220,ufficio:170,ultimo:170,prossima:240},rowGap:8,rowPaddingX:12,rowPaddingY:10,rowMinHeight:44,rowRadius:12,rowBorderWidth:1,rowBorderColor:"rgba(0,0,0,0.08)",zebraEvenBg:"#ffffff",zebraOddBg:"#fbfbfb",hoverBg:"#f2f6ff",selectedBg:"#eaf2ff",selectedBorderColor:"#2f6fed",selectedBorderWidth:2,emptyMessage:"Nessun record trovato (view/filtro/permessi).",errorNoDs:"Configura la fonte dati del widget.",statoChipRadius:999,statoChipPadX:10,statoChipPadY:4,statoChipBorderW:1,statoChipFontWeight:600,statoChipFontSize:12,statoChipFontStyle:"normal",statoChipTextTransform:"none",statoChipLetterSpacing:0,statoBgDaPrendere:"#fff7e6",statoTextDaPrendere:"#7a4b00",statoBorderDaPrendere:"#ffd18a",statoBgPresa:"#eaf7ef",statoTextPresa:"#1f6b3a",statoBorderPresa:"#9ad2ae",statoBgAltro:"#f2f2f2",statoTextAltro:"#333333",statoBorderAltro:"#d0d0d0",maskOuterOffset:12,maskInnerPadding:8,maskBg:"#ffffff",maskBorderColor:"rgba(0,0,0,0.12)",maskBorderWidth:1,maskRadius:12,listTitleText:"Elenco rapporti di rilevazione",listTitleHeight:28,listTitlePaddingBottom:10,listTitlePaddingLeft:0,listTitleFontSize:14,listTitleFontWeight:600,listTitleColor:"rgba(0,0,0,0.85)"});var a=function(e,t,i,r){return new(i||(i=Promise))(function(n,o){function l(e){try{s(r.next(e))}catch(e){o(e)}}function a(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(l,a)}s((r=r.apply(e,t||[])).next())})};function s(e){return new Promise((t,i)=>{const r=window.require;if(r)try{r([e],e=>t(e),e=>i(e))}catch(e){i(e)}else i(new Error("AMD require non disponibile"))})}const d="__stato_sint__",u="__ultimo_agg__",c="__prossima__";function f(e,t){const i=Number(e);return Number.isFinite(i)?i:t}function g(e){return null==e?"":String(e)}function p(e){return(null==e?void 0:e.asMutable)?e.asMutable({deep:!0}):e}function v(e){if(null==e||""===e)return null;if("number"==typeof e&&Number.isFinite(e))return e;if(e instanceof Date)return Number.isNaN(e.getTime())?null:e.getTime();const t=String(e),i=Date.parse(t);return Number.isNaN(i)?null:i}function m(e){if(null==e||""===e)return"";let t=null;if("number"==typeof e)t=new Date(e);else if("string"==typeof e){const i=Date.parse(e);Number.isNaN(i)||(t=new Date(i))}else e instanceof Date&&(t=e);return!t||Number.isNaN(t.getTime())?g(e):new Intl.DateTimeFormat("it-IT",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(t)}function h(e){var t,i,r;try{null===(t=e.selectRecordsByIds)||void 0===t||t.call(e,[])}catch(e){}try{null===(i=e.clearSelection)||void 0===i||i.call(e)}catch(e){}try{null===(r=e.setSelectedRecords)||void 0===r||r.call(e,[])}catch(e){}}function b(){try{sessionStorage.removeItem("GII_SELECTED_OID"),window.dispatchEvent(new CustomEvent("gii-selection-changed"))}catch(e){}}function S(e,t){const i=null==e||""===e,r=null==t||""===t;if(i&&r)return 0;if(i)return 1;if(r)return-1;if("number"==typeof e&&"number"==typeof t)return e-t;const n=String(e),o=String(t),l=Date.parse(n),a=Date.parse(o);return Number.isNaN(l)||Number.isNaN(a)?n.localeCompare(o,"it",{numeric:!0,sensitivity:"base"}):l-a}function _(e){return(e||[]).map(e=>`${e.field}:${e.dir}`).join("|")}function x(e){var i,r,n,o,l,a,s,d,u,c;const f=null!==(n=null===(r=null===(i=e.ds)||void 0===i?void 0:i.getRecords)||void 0===r?void 0:r.call(i))&&void 0!==n?n:[],g=null!==(d=null!==(l=null===(o=e.info)||void 0===o?void 0:o.status)&&void 0!==l?l:null===(s=null===(a=e.ds)||void 0===a?void 0:a.getStatus)||void 0===s?void 0:s.call(a))&&void 0!==d?d:t.DataSourceStatus.NotReady,p=g===t.DataSourceStatus.Loading;let v="";if(f.length>0)try{v=JSON.stringify((null===(c=(u=f[0]).getData)||void 0===c?void 0:c.call(u))||{})}catch(e){v=String(f.length)}const m=`${g}:${f.length}:${v}`,h=t.React.useRef("");return t.React.useEffect(()=>{m!==h.current&&(h.current=m,e.onUpdate(e.dsId,f,e.ds,p))},[m]),null}const D="https://services2.arcgis.com/vH5RykSdaAwiEGOJ/arcgis/rest/services/GII_uteniti/FeatureServer/0",y="https://cbsm-hub.maps.arcgis.com",I={1:"TR",2:"TI",3:"RZ",4:"RI",5:"DT",6:"DA"},T={6:100,5:90,4:80,3:70,2:60,1:10};function R(){return a(this,void 0,void 0,function*(){var e,i;try{const r=t.SessionManager.getInstance(),n=(null===(e=null==r?void 0:r.getMainSession)||void 0===e?void 0:e.call(r))||(null===(i=null==r?void 0:r.getSessionByUrl)||void 0===i?void 0:i.call(r,y));if(n){const e="string"==typeof n.token&&n.token?n.token:null;if(e)return e;if("function"==typeof n.getToken){const e=yield n.getToken(`${y}/sharing/rest`);if(e)return String(e)}}}catch(e){}try{const e=(yield s("esri/identity/IdentityManager")).credentials||[],t=e.filter(e=>String((null==e?void 0:e.server)||"").includes("cbsm-hub")||String((null==e?void 0:e.server)||"").includes("arcgis.com")),i=t.length?t:e;if(i.length){const e=i.slice().sort((e,t)=>f(null==t?void 0:t.expires,0)-f(null==e?void 0:e.expires,0))[0]||i[i.length-1];if(null==e?void 0:e.token)return e.token}}catch(e){}return""})}function C(){return a(this,void 0,void 0,function*(){var e,i,r,n,o,l,a;try{const n=t.SessionManager.getInstance(),o=(null===(e=null==n?void 0:n.getMainSession)||void 0===e?void 0:e.call(n))||(null===(i=null==n?void 0:n.getSessionByUrl)||void 0===i?void 0:i.call(n,y));if(o){const e="string"==typeof o.username&&o.username?o.username:"function"==typeof o.getUsername?yield o.getUsername():"";if(!e)return{username:"",isAdmin:!1};try{if("function"==typeof o.getUser){const t=yield o.getUser(),i="org_admin"===(null==t?void 0:t.role)||Array.isArray(null==t?void 0:t.privileges)&&t.privileges.includes("portal:admin:viewUsers")||!1;return{username:String((null==t?void 0:t.username)||e),isAdmin:i}}}catch(e){}const t=yield R();if(!t)return{username:String(e),isAdmin:!1};const i=yield fetch(`${y}/sharing/rest/community/self?f=json&token=${encodeURIComponent(t)}`),n=yield i.json(),l="org_admin"===(null==n?void 0:n.role)||(null===(r=null==n?void 0:n.privileges)||void 0===r?void 0:r.includes("portal:admin:viewUsers"))||!1;return{username:String((null==n?void 0:n.username)||e),isAdmin:l}}}catch(e){}try{const e=(yield s("esri/identity/IdentityManager")).credentials||[],t=e.filter(e=>String((null==e?void 0:e.server)||"").includes("cbsm-hub")||String((null==e?void 0:e.server)||"").includes("arcgis.com")),i=t.length?t:e,r=i.length?i.slice().sort((e,t)=>f(null==t?void 0:t.expires,0)-f(null==e?void 0:e.expires,0))[0]||i[i.length-1]:null,d=null!==(n=null==r?void 0:r.token)&&void 0!==n?n:"",u=null!==(l=null!==(o=null==r?void 0:r.userId)&&void 0!==o?o:null==r?void 0:r.username)&&void 0!==l?l:"";if(!u||!d)return{username:"",isAdmin:!1};const c=yield fetch(`${y}/sharing/rest/community/self?f=json&token=${encodeURIComponent(d)}`),g=yield c.json(),p="org_admin"===(null==g?void 0:g.role)||(null===(a=null==g?void 0:g.privileges)||void 0===a?void 0:a.includes("portal:admin:viewUsers"))||!1;return{username:String((null==g?void 0:g.username)||u),isAdmin:p}}catch(e){return{username:"",isAdmin:!1}}})}function w(e){return 0===e||1===e||3===e?0:2===e?1:4===e?2:5===e?3:4}function A(o){var l,y,A,N,B,$;const j=null!==(l=o.config)&&void 0!==l?l:n,E=p(null!==(y=o.useDataSources)&&void 0!==y?y:(0,t.Immutable)([])),[z,P]=t.React.useState(null),[k,M]=t.React.useState(!0),[F,U]=t.React.useState(!1);t.React.useEffect(()=>{try{const e=window;if(e.__giiSelBootCleared)return;e.__giiSelBootCleared=!0}catch(e){}b()},[]);const V=t.React.useCallback((e,t)=>a(this,void 0,void 0,function*(){if(window.__giiCurrentUsername!==e&&(ie.current={},window.__giiCurrentUsername=e),t){const t={username:e,ruolo:null,ruoloLabel:"ADMIN",area:null,settore:null,ufficio:null,gruppo:"",isAdmin:!0};P(t),U(!1);try{window.__giiUserRole=t}catch(e){}return void M(!1)}yield R();const i=yield function(e){return a(this,void 0,void 0,function*(){var t,i,r,n,o,l,a,d,u;if(!e)return null;try{const c=new(yield s("esri/layers/FeatureLayer"))({url:D});yield c.load().catch(()=>{});const f=yield c.queryFeatures({where:`username = '${e.replace(/'/g,"''")}'`,outFields:["username","ruolo","area","settore","ufficio","gruppo"],returnGeometry:!1}),g=null!==(t=null==f?void 0:f.features)&&void 0!==t?t:[];if(!g.length)return null;let p=g[0];for(const e of g){const t=Number(null!==(r=null===(i=p.attributes)||void 0===i?void 0:i.ruolo)&&void 0!==r?r:0),s=Number(null!==(o=null===(n=e.attributes)||void 0===n?void 0:n.ruolo)&&void 0!==o?o:0);(null!==(l=T[s])&&void 0!==l?l:0)>(null!==(a=T[t])&&void 0!==a?a:0)&&(p=e)}const v=p.attributes,m=null!=v.ruolo?Number(v.ruolo):null;return{username:e,ruolo:m,ruoloLabel:m&&null!==(d=I[m])&&void 0!==d?d:"",area:null!=v.area?Number(v.area):null,settore:null!=v.settore?Number(v.settore):null,ufficio:null!=v.ufficio?Number(v.ufficio):null,gruppo:String(null!==(u=v.gruppo)&&void 0!==u?u:""),isAdmin:!1}}catch(e){return null}})}(e),r=i?Object.assign(Object.assign({},i),{isAdmin:!1}):{username:e,ruolo:null,ruoloLabel:"",area:null,settore:null,ufficio:null,gruppo:"",isAdmin:!1};P(r),U(!1);try{window.__giiUserRole=r}catch(e){}M(!1),console.log("GII user loaded:",r.username,"| ruolo:",r.ruolo,"| area:",r.area,"| settore:",r.settore)}),[]);t.React.useEffect(()=>{let e=!1,t=null,i=null;return(()=>{a(this,void 0,void 0,function*(){M(!0);try{const{username:t,isAdmin:i}=yield C();if(e)return;t?(U(!1),yield V(t,i)):(U(!0),M(!1))}catch(t){e||(U(!0),M(!1))}try{const i=yield s("esri/identity/IdentityManager");if(e)return;let r=null;t=i.on("credential-create",()=>{e||(clearTimeout(r),r=setTimeout(()=>a(this,void 0,void 0,function*(){if(e)return;console.log("Credential create event: reloading user profile...");const{username:t,isAdmin:i}=yield C();t&&(U(!1),yield V(t,i))}),400))})}catch(e){}try{i=setInterval(()=>a(this,void 0,void 0,function*(){if(e)return;const t=yield C(),i=(null==t?void 0:t.username)||"",r=window.__giiCurrentUsername||"";if(!i&&r)return ie.current={},P(null),U(!0),void M(!1);i&&i!==r&&(ie.current={},U(!1),M(!0),yield V(i,(null==t?void 0:t.isAdmin)||!1))}),1500)}catch(e){}})})(),()=>{e=!0;try{i&&clearInterval(i)}catch(e){}try{null==t||t.remove()}catch(e){}}},[]),t.React.useEffect(()=>{if(z)try{window.__giiUserRole=z}catch(e){}},[z]);const W=t.React.useMemo(()=>z?function(e,i){if(!e)return null;const r=e=>{var i;try{const r=t.DataSourceManager.getInstance().getDataSource(String((null==e?void 0:e.dataSourceId)||"")),n=null===(i=null==r?void 0:r.getLabel)||void 0===i?void 0:i.call(r);return String(n||"")}catch(e){return""}},n=e=>String(e||"").toUpperCase(),o=(null!=e.area?{1:"AMM",2:"AGR",3:"TEC"}[e.area]:"")||"",l=(null!=e.settore?{1:"CR",2:"GI",3:"D1",4:"D2",5:"D3",6:"D4",7:"D5",8:"D6",9:"CS"}[e.settore]:"")||"",a=e.ruolo,s=e=>Array.from(new Set(e.map(e=>String((null==e?void 0:e.rootDataSourceId)||(null==e?void 0:e.dataSourceId)||"")).filter(Boolean)));if(e.isAdmin){const e=s(i.filter(e=>{const t=n(r(e));return t.includes("GII_VIEW_EB_ADMIN")||t.includes("VIEW_EB_ADMIN")||t.includes("_EB_ADMIN")||t.includes("EB_ADMIN")}));return e.length?e:null}const d=e=>e.includes("GII_VIEW_EB_")||e.includes("VIEW_EB_")||e.includes("_EB_"),u=i.filter(e=>{const t=n(r(e));return!!d(t)&&!t.includes("EB_ADMIN")&&!(o&&!t.includes(`EB_${o}`))&&(null!=a&&a>=1&&a<=3?"AGR"!==o||!l||t.includes(`_${l}`):!(null!=a&&a>=4&&a<=6)||"AGR"!==o||t.includes("TUTTE")||t.includes("TUTTI")||!t.includes("_D1")&&!t.includes("_D2")&&!t.includes("_D3")&&!t.includes("_D4")&&!t.includes("_D5")&&!t.includes("_D6"))});return s(u.length?u:i.filter(e=>{const t=n(r(e));return!!d(t)&&!t.includes("EB_ADMIN")&&(!o||t.includes(`EB_${o}`))}))}(z,E):null,[null==z?void 0:z.username,null==z?void 0:z.ruolo,null==z?void 0:z.area,null==z?void 0:z.settore,null==z?void 0:z.isAdmin,E.length]),O=t.React.useMemo(()=>z?function(e,i){var r;if(!e||!Array.isArray(i)||0===i.length)return null;const n=e=>String(e||"").toUpperCase(),o=(null!=e.area?{1:"AMM",2:"AGR",3:"TEC"}[e.area]:"")||"",l=(null!=e.settore?{1:"CR",2:"GI",3:"D1",4:"D2",5:"D3",6:"D4",7:"D5",8:"D6",9:"CS"}[e.settore]:"")||"",a=e.ruolo,s=n(null==e?void 0:e.ruoloLabel),d=n(null==e?void 0:e.gruppo),u=e=>{var i;try{const r=t.DataSourceManager.getInstance().getDataSource(String((null==e?void 0:e.dataSourceId)||"")),o=(null===(i=null==r?void 0:r.getDataSourceJson)||void 0===i?void 0:i.call(r))||(null==r?void 0:r.dataSourceJson),l=(String((null==o?void 0:o.url)||"").split("/rest/services/")[1]||"").split("/FeatureServer")[0]||"";return n(l)}catch(e){return""}},c=i.map(e=>({dsId:String((null==e?void 0:e.dataSourceId)||""),name:u(e)})),f=e=>{const t=c.find(t=>t.dsId&&t.name&&e(t.name));return(null==t?void 0:t.dsId)||null};if(e.isAdmin||"DA"===s||"DT"===s||"RI"===s||d.includes("ADMIN")){const e=f(e=>e.includes("EB_ADMIN")||e.includes("GII_VIEW_EB_ADMIN")||e.includes("VIEW_EB_ADMIN"));if(e)return e}if(o){if(l){const e=f(e=>e.includes(`EB_${o}_${l}`)||e.includes(`_${o}_${l}`));if(e)return e}if(null!=a&&a>=4&&a<=6){const e=f(e=>e.includes(`EB_${o}_TUTTE`)||e.includes(`EB_${o}_TUTTI`));if(e)return e}const e=f(e=>e.includes(`EB_${o}`)||e.includes(`_${o}`));if(e)return e}return f(e=>e.includes("EB_ADMIN")||e.includes("GII_VIEW_EB_ADMIN")||e.includes("VIEW_EB_ADMIN"))||(null===(r=c[0])||void 0===r?void 0:r.dsId)||null}(z,E):null,[null==z?void 0:z.username,null==z?void 0:z.ruolo,null==z?void 0:z.area,null==z?void 0:z.settore,null==z?void 0:z.isAdmin,null==z?void 0:z.gruppo,E.length]),L=t.React.useMemo(()=>{if(!z||k||F)return E;if(O){const e=E.find(e=>String((null==e?void 0:e.dataSourceId)||"")===O);return e?[e]:E}return null===W?E:E.filter(e=>{const t=String((null==e?void 0:e.rootDataSourceId)||"");return W.includes(t)})},[z,k,F,O,W,E.length]),G=(null==z?void 0:z.isAdmin)?null:(null==z?void 0:z.ruoloLabel)?function(e){const t=e.toUpperCase();return"TR"===t?"stato_TR":"TI"===t?"stato_TI":"RZ"===t?"stato_RZ":"RI"===t?"stato_RI":"DT"===t?"stato_DT":"DA"===t?"stato_DA":"stato_DT"}(z.ruoloLabel):null,[Z,H]=t.React.useState("tutte"),J=t.React.useCallback(e=>G&&"tutte"!==Z?e.filter(e=>{var t;const i=((null===(t=e.getData)||void 0===t?void 0:t.call(e))||{})[G],r=null!=i?Number(i):null;return"attesa_mia"===Z?0===r||1===r||3===r:"attesa_altri"!==Z||(2===r||4===r)}):e,[G,Z]),q=t.React.useCallback(e=>G?[...e].sort((e,t)=>{var i,r;const n=(null===(i=e.getData)||void 0===i?void 0:i.call(e))||{},o=(null===(r=t.getData)||void 0===r?void 0:r.call(t))||{};return w(null!=n[G]?Number(n[G]):null)-w(null!=o[G]?Number(o[G]):null)}):e,[G]),X=t.React.useMemo(()=>{const e=p(j.filterTabs)||[],i=[],r=new Map;return L.forEach((n,o)=>{const l=String((null==n?void 0:n.dataSourceId)||""),a=e.find(e=>String((null==e?void 0:e.dataSourceId)||"")===l),s=String((null==a?void 0:a.label)||function(e,i){var r;try{const n=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),o=null===(r=null==n?void 0:n.getLabel)||void 0===r?void 0:r.call(n);return o&&String(o).trim()?String(o):i}catch(e){return i}}(n,`Filtro ${o+1}`));r.has(s)?i[r.get(s)].dsIndices.push(o):(r.set(s,i.length),i.push({label:s,dsIndices:[o]}))}),i},[L.length,j.filterTabs]),Y=X.length>1,[K,Q]=t.React.useState(0),[ee,te]=t.React.useState({}),ie=t.React.useRef({}),[re,ne]=t.React.useState(0),oe=t.React.useCallback((e,t,i,r)=>{ie.current[e]={recs:t,ds:i,loading:r},ne(e=>e+1)},[]);t.React.useEffect(()=>{const e=[300,800,2e3,4e3].map(e=>setTimeout(()=>{let e=!1;Object.entries(ie.current).forEach(([t,i])=>{var r,n,o;if(i.ds){const l=null!==(o=null===(n=(r=i.ds).getRecords)||void 0===n?void 0:n.call(r))&&void 0!==o?o:[];l.length>0&&(ie.current[t]=Object.assign(Object.assign({},i),{recs:l,loading:!1}),e=!0)}}),e&&ne(e=>e+1)},e));return()=>e.forEach(e=>clearTimeout(e))},[E.length,null==z?void 0:z.username]);const le=t.React.useMemo(()=>[{field:g(j.orderByField||"objectid"),dir:"ASC"===g(j.orderByDir||"DESC").toUpperCase()?"ASC":"DESC"}],[j.orderByField,j.orderByDir]),[ae,se]=t.React.useState(le);t.React.useEffect(()=>{_(ae)!==_(le)||se(le)},[_(le)]);const de=Math.min(K,Math.max(0,X.length-1)),ue=X[de]||X[0],ce=o.useDataSources,fe=g(j.whereClause||"1=1"),ge=f(j.pageSize,200),pe=!F&&!k&&!!(null==z?void 0:z.username),ve=t.React.useMemo(()=>({where:pe?fe:"1=0",pageSize:ge}),[pe,fe,ge]),me=g(j.fieldPratica||"objectid"),he=g(j.fieldDataRilevazione||"data_rilevazione"),be=g(j.fieldUfficio||"ufficio_zona"),Se=f(j.presaDaPrendereVal,1),_e=f(j.presaPresaVal,2),xe=f(j.statoDaPrendereVal,1),De=f(j.statoPresaVal,2),ye=f(j.statoIntegrazioneVal,3),Ie=f(j.statoApprovataVal,4),Te=f(j.statoRespintaVal,5),Re=f(j.esitoIntegrazioneVal,1),Ce=f(j.esitoApprovataVal,2),we=f(j.esitoRespintaVal,3),Ae=e=>{const t=Number(e);return Number.isFinite(t)?t===xe?g(j.labelStatoDaPrendere||"Da prendere"):t===De?g(j.labelStatoPresa||"Presa in carico"):t===ye?g(j.labelStatoIntegrazione||"Integrazione richiesta"):t===Ie?g(j.labelStatoApprovata||"Approvata"):t===Te?g(j.labelStatoRespinta||"Respinta"):String(t):g(e)},Ne=e=>{const t=Number(e);return Number.isFinite(t)?t===Re?g(j.labelEsitoIntegrazione||"Integrazione richiesta"):t===Ce?g(j.labelEsitoApprovata||"Approvata"):t===we?g(j.labelEsitoRespinta||"Respinta"):String(t):g(e)},Be=e=>e===Re?ye:e===Ce?Ie:e===we?Te:Ie,$e=(e,t)=>{const i=e[`presa_in_carico_${t}`],r=e[`stato_${t}`],n=e[`esito_${t}`];return null!=i&&""!==i||null!=r&&""!==r||null!=n&&""!==n},je=e=>{const t=["DA","DT","RI","RZ","TI","TR"];for(const i of t){if(!$e(e,i))continue;const t=e[`presa_in_carico_${i}`],r=e[`stato_${i}`],n=e[`esito_${i}`],o=null!=t&&""!==t?Number(t):null,l=null!=r&&""!==r?Number(r):null,a=null!=n&&""!==n?Number(n):null;if(null!==a&&Number.isFinite(a))return{ruolo:i,label:`${Ne(a)} (${i})`,statoForChip:Be(a)};if(null!==l&&Number.isFinite(l))return l===xe?{ruolo:i,label:`Trasmessa a ${i}`,statoForChip:xe}:l===De?{ruolo:i,label:`In lavorazione ${i}`,statoForChip:De}:{ruolo:i,label:`${Ae(l)} (${i})`,statoForChip:l};if(null!==o&&Number.isFinite(o)){if(o===Se)return{ruolo:i,label:`Trasmessa a ${i}`,statoForChip:xe};if(o===_e)return{ruolo:i,label:`In lavorazione ${i}`,statoForChip:De}}return{ruolo:i,label:`In carico ${i}`,statoForChip:null}}const i=e.origine_pratica;return 2===(null!=i&&""!==i?Number(i):null)?{ruolo:"TI",label:"In lavorazione TI",statoForChip:De}:{ruolo:"RZ",label:"Trasmessa a RZ",statoForChip:xe}},Ee=e=>{const t=["TR","TI","RZ","RI","DT","DA"],i=[];for(const r of t){const t=v(e[`dt_presa_in_carico_${r}`]),n=v(e[`dt_stato_${r}`]),o=v(e[`dt_esito_${r}`]);null!==t&&i.push(t),null!==n&&i.push(n),null!==o&&i.push(o)}return 0===i.length?null:Math.max(...i)},ze=(e,t)=>{if(!t){const t=e.origine_pratica;return 2===(null!=t&&""!==t?Number(t):null)?"Trasmettere a RZ (TI)":"Prendere in carico (RZ)"}const i=e[`presa_in_carico_${t}`],r=e[`stato_${t}`],n=e[`esito_${t}`],o=null!=i&&""!==i?Number(i):null,l=null!=r&&""!==r?Number(r):null,a=null!=n&&""!==n?Number(n):null;if(null!==a){if(a===Ce)return"DT"===t?"Trasmettere a DA (DT)":`Chiusa \u2013 approvata (${t})`;if(a===we)return`Chiusa \u2013 respinta (${t})`;if(a===Re)return`Attendere integrazione (${t})`}if(null!==l){if(l===xe)return`Prendere in carico (${t})`;if(l===De)return"RZ"===t?"Approvare o richiedere integrazione (RZ)":"TI"===t?"Trasmettere a RZ (TI)":"RI"===t?"Validare e trasmettere a DT (RI)":"DT"===t?"Esprimere esito (DT)":"DA"===t?"Esprimere esito finale (DA)":`Esprimere esito (${t})`;if(l===ye)return`Gestire integrazione (${t})`;if(l===Ie)return"DT"===t?"Trasmettere a DA (DT)":`Chiusa \u2013 approvata (${t})`;if(l===Te)return`Chiusa \u2013 respinta (${t})`}if(null!==o){if(o===Se)return`Prendere in carico (${t})`;if(o===_e)return"RZ"===t?"Approvare o richiedere integrazione (RZ)":"TI"===t?"Trasmettere a RZ (TI)":"RI"===t?"Validare e trasmettere a DT (RI)":"DT"===t?"Esprimere esito (DT)":"DA"===t?"Esprimere esito finale (DA)":`Esprimere esito (${t})`}return"RZ"===t?"Prendere in carico (RZ)":"TI"===t?"Trasmettere a RZ (TI)":`Verificare stato (${t})`},Pe=(e,t)=>{var i;const r=(null===(i=e.getData)||void 0===i?void 0:i.call(e))||{};if(t===d)return je(r).label;if(t===u)return Ee(r);if(t===c){const e=je(r);return ze(r,e.ruolo)}return r[t]},ke=_(ae)!==_(le),Me=t.React.useMemo(()=>{var e;if(!ue)return[];const t=[];for(const i of ue.dsIndices){const r=String((null===(e=L[i])||void 0===e?void 0:e.dataSourceId)||""),n=ie.current[r];(null==n?void 0:n.recs)&&t.push(...n.recs)}const i=J(t);return((e,t)=>{if(!t||0===t.length)return e;const i=[...e];return i.sort((e,i)=>{for(const r of t){const t=S(Pe(e,r.field),Pe(i,r.field));if(0!==t)return"ASC"===r.dir?t:-t}return 0}),i})(q(i),ae)},[ue,re,ae,Z,G]),Fe=t.React.useMemo(()=>{var e;const t=new WeakMap;if(!ue)return t;for(const i of ue.dsIndices){const r=String((null===(e=L[i])||void 0===e?void 0:e.dataSourceId)||""),n=ie.current[r];if(null==n?void 0:n.recs)for(const e of n.recs)t.set(e,r)}return t},[ue,re]),Ue=null!==(A=null==ue?void 0:ue.dsIndices.every(e=>{var t;const i=String((null===(t=L[e])||void 0===t?void 0:t.dataSourceId)||""),r=ie.current[i];return!r||r.loading}))&&void 0!==A&&A,Ve=f(j.gap,12),We=f(j.paddingLeftFirstCol,0),Oe=function(e){const t=p(null==e?void 0:e.columns);return Array.isArray(t)&&t.length>0?t.map(e=>({id:String(e.id||""),label:String(e.label||""),field:String(e.field||""),width:f(e.width,150)})):r.map(e=>Object.assign({},e))}(p(j)),Le=Oe.map(e=>`${e.width}px`).join(" "),Ge=Oe.reduce((e,t)=>e+t.width,0)+Ve*Math.max(0,Oe.length-1)+24,Ze=f(j.rowGap,8),He=f(j.rowPaddingX,12),Je=f(j.rowPaddingY,10),qe=f(j.rowMinHeight,44),Xe=f(j.rowRadius,12),Ye=f(j.rowBorderWidth,1),Ke=g(j.rowBorderColor||"rgba(0,0,0,0.08)"),Qe=f(j.statoChipRadius,999),et=f(j.statoChipPadX,10),tt=f(j.statoChipPadY,4),it=f(j.statoChipBorderW,1),rt=f(j.statoChipFontWeight,600),nt=f(j.statoChipFontSize,12),ot="italic"===j.statoChipFontStyle?"italic":"normal",lt=["none","uppercase","lowercase","capitalize"].includes(j.statoChipTextTransform)?j.statoChipTextTransform:"none",at=f(j.statoChipLetterSpacing,0),st=t.css`
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;

    .tabBar {
      display: ${Y?"flex":"none"};
      gap: 8px;
      padding: 8px 12px;
      border-bottom: 1px solid rgba(0,0,0,0.08);
      background: var(--bs-body-bg, #fff);
    }
    .tabBtn {
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(0,0,0,0.02);
      color: #111827;
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      font-size: 12px;
      white-space: nowrap;
    }
    .tabBtn.active {
      background: #eaf2ff;
      border-color: #2f6fed;
      color: #1d4ed8;
    }

    .viewport { flex: 1; min-height: 0; overflow: auto; }
    .content { min-width: ${Ge}px; padding: 0 12px 10px; }

    .headerWrap {
      position: sticky;
      top: 0;
      z-index: 2;
      background: var(--bs-body-bg, #fff);
      border-bottom: 1px solid rgba(0,0,0,0.08);
      padding: 6px 12px;
      margin: 0 0 8px 0;
    }

    .gridHeader {
      display: grid;
      grid-template-columns: ${Le};
      column-gap: ${Ve}px;
      align-items: center;
      min-height: 28px;
    }

    .headerCell {
      display: flex;
      align-items: center;
      min-width: 0;
      font-weight: 700;
      font-size: 12px;
      color: rgba(0,0,0,0.65);
    }

    .hdrBtn {
      width: 100%;
      border: none;
      background: transparent;
      padding: 0;
      margin: 0;
      text-align: left;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: inherit;
      font: inherit;
      line-height: 1;
    }
    .hdrBtn:hover { color: rgba(0,0,0,0.9); }

    .sortBadge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      opacity: 0.85;
    }
    .sortPri {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 4px;
      background: rgba(0,0,0,0.07);
      font-weight: 800;
    }

    .resetBtn {
      padding: 0 10px !important;
      height: 28px !important;
      min-height: 28px !important;
      line-height: 1 !important;
      white-space: nowrap !important;
      font-size: 12px !important;
      font-weight: 700 !important;
    }

    .first { padding-left: ${We}px; }

    .list { display: flex; flex-direction: column; }

    .rowCard {
      display: grid;
      grid-template-columns: ${Le};
      column-gap: ${Ve}px;
      align-items: center;

      padding: ${Je}px ${He}px;
      min-height: ${qe}px;

      border-radius: ${Xe}px;
      border: ${Ye}px solid ${Ke};

      margin-bottom: ${Ze}px;
      cursor: pointer;
    }
    .rowCard.even { background: ${g(j.zebraEvenBg||"#ffffff")}; }
    .rowCard.odd  { background: ${g(j.zebraOddBg||"#fbfbfb")}; }
    .rowCard:hover { background: ${g(j.hoverBg||"#f2f6ff")}; }

    .rowCard.selected {
      border-color: ${g(j.selectedBorderColor||"#2f6fed")};
      box-shadow: 0 0 0 ${f(j.selectedBorderWidth,2)}px rgba(47,111,237,0.18);
      background: ${g(j.selectedBg||"#eaf2ff")};
    }

    .cell {
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      padding: ${tt}px ${et}px;
      border-radius: ${Qe}px;
      border: ${it}px solid rgba(0,0,0,0.12);
      font-weight: ${rt};
      font-size: ${nt}px;
      font-style: ${ot};
      text-transform: ${lt};
      letter-spacing: ${at}px;
      line-height: 1;
      white-space: nowrap;
      max-width: 100%;
    }

    .empty { padding: 14px; color: rgba(0,0,0,0.65); }
  `,dt=t=>{const i=ae.findIndex(e=>e.field===t.field),r=i>=0?ae[i]:null,n=null==r?void 0:r.dir,o=r?(0,e.jsxs)("span",{className:"sortBadge","aria-hidden":!0,children:[(0,e.jsx)("span",{className:"sortPri",children:i+1}),(0,e.jsx)("span",{children:"ASC"===n?"\u2191":"\u2193"})]}):(0,e.jsx)("span",{className:"sortBadge",style:{opacity:.35},"aria-hidden":!0,children:"\u2195"});return(0,e.jsx)("div",{className:"headerCell "+(t.first?"first":""),children:(0,e.jsxs)("button",{type:"button",className:"hdrBtn",onClick:e=>{return i=t.field,r=!0===e.shiftKey,void se(e=>{const t=[...e],n=t.findIndex(e=>e.field===i);if(n>=0){const e="ASC"===t[n].dir?"DESC":"ASC";return t[n]={field:i,dir:e},r?t:[t[n]]}const o={field:i,dir:"ASC"};return r?[...t,o]:[o]});var i,r},title:"Click: ordina. Shift+Click: ordinamento multiplo.",children:[(0,e.jsx)("span",{children:t.label}),o]})})},ut=Number.isFinite(Number(j.maskOuterOffset))?Number(j.maskOuterOffset):12,ct=Number.isFinite(Number(j.maskInnerPadding))?Number(j.maskInnerPadding):8,ft=String(null!==(N=j.maskBg)&&void 0!==N?N:"#ffffff"),gt=String(null!==(B=j.maskBorderColor)&&void 0!==B?B:"rgba(0,0,0,0.12)"),pt=Number.isFinite(Number(j.maskBorderWidth))?Number(j.maskBorderWidth):1,vt=Number.isFinite(Number(j.maskRadius))?Number(j.maskRadius):12;if(!E.length)return(0,e.jsx)("div",{style:{padding:12},children:g(j.errorNoDs||"Configura la fonte dati del widget.")});const mt=g(j.listTitleText||"Elenco rapporti di rilevazione"),ht=f(j.listTitleHeight,28),bt=f(j.listTitlePaddingBottom,10),St=f(j.listTitlePaddingLeft,0),_t=f(j.listTitleFontSize,14),xt=f(j.listTitleFontWeight,600),Dt=g(j.listTitleColor||"rgba(0,0,0,0.85)");return(0,e.jsxs)("div",{style:{width:"100%",height:"100%",boxSizing:"border-box",padding:ut,display:"flex",flexDirection:"column",minHeight:0},children:[mt&&(0,e.jsx)("div",{style:{height:ht,paddingBottom:bt,paddingLeft:St,display:"flex",alignItems:"center",boxSizing:"border-box",flex:"0 0 auto"},children:(0,e.jsx)("span",{style:{fontSize:_t,fontWeight:xt,color:Dt},children:mt})}),(0,e.jsx)("div",{style:{width:"100%",flex:"1 1 auto",minHeight:0,boxSizing:"border-box",border:`${pt}px solid ${gt}`,borderRadius:vt,background:ft,padding:ct,overflow:"hidden"},children:(0,e.jsxs)("div",{css:st,style:{width:"100%",height:"100%"},children:[(F||k)&&(0,e.jsx)("div",{style:{position:"absolute",inset:0,zIndex:100,background:"rgba(255,255,255,0.97)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:16,padding:32,textAlign:"center",borderRadius:vt,pointerEvents:"all"},children:k?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.Loading,{}),(0,e.jsx)("div",{style:{fontSize:13,color:"#6b7280"},children:"Verifica accesso in corso\u2026"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{fontSize:32},children:"\u{1f512}"}),(0,e.jsx)("div",{style:{fontSize:15,fontWeight:700,color:"#111827"},children:"Accesso richiesto"}),(0,e.jsx)("div",{style:{fontSize:13,color:"#6b7280",maxWidth:300,lineHeight:1.5},children:"Utilizza il pulsante di accesso in alto a destra per entrare con le credenziali CBSM."})]})}),E.map((i,r)=>(0,e.jsx)(t.DataSourceComponent,{useDataSource:null==ce?void 0:ce[r],query:ve,widgetId:o.id,children:(t,r)=>(0,e.jsx)(x,{ds:t,dsId:String((null==i?void 0:i.dataSourceId)||""),info:r,onUpdate:oe})},`${(null==i?void 0:i.dataSourceId)||r}-${(null==z?void 0:z.username)||"anon"}`)),!k&&G&&(0,e.jsxs)("div",{style:{display:"flex",gap:8,padding:"8px 12px",borderBottom:"1px solid rgba(0,0,0,0.08)",alignItems:"center",flexWrap:"wrap"},children:[(0,e.jsx)("span",{style:{fontSize:11,color:"#6b7280",marginRight:4},children:(null==z?void 0:z.isAdmin)?"\u{1f464} Admin":`\u{1f464} ${null!==($=null==z?void 0:z.ruoloLabel)&&void 0!==$?$:""}`}),[{id:"tutte",label:"Tutte le pratiche"},{id:"attesa_mia",label:"In attesa mia"},{id:"attesa_altri",label:"In attesa altri"}].map(t=>(0,e.jsxs)("button",{type:"button",className:"tabBtn "+(Z===t.id?"active":""),onClick:()=>H(t.id),children:[t.label,(()=>{var i;if(!ue)return null;const r=[];for(const e of ue.dsIndices){const t=String((null===(i=L[e])||void 0===i?void 0:i.dataSourceId)||""),n=ie.current[t];(null==n?void 0:n.recs)&&r.push(...n.recs)}const n="tutte"===t.id?r.length:r.filter(e=>{var i;const r=(null===(i=e.getData)||void 0===i?void 0:i.call(e))||{},n=null!=r[G]?Number(r[G]):null;return"attesa_mia"===t.id?0===n||1===n||3===n:"attesa_altri"===t.id&&(2===n||4===n)}).length;return n>0?(0,e.jsx)("span",{style:{marginLeft:6,background:Z===t.id?"#2f6fed":"rgba(0,0,0,0.1)",color:Z===t.id?"#fff":"#374151",borderRadius:999,padding:"1px 7px",fontSize:11,fontWeight:700},children:n}):null})()]},t.id))]}),!k&&(null==z?void 0:z.isAdmin)&&(0,e.jsx)("div",{style:{padding:"6px 12px",fontSize:11,color:"#6b7280",borderBottom:"1px solid rgba(0,0,0,0.06)",background:"#fafafa"},children:"\u{1f464} Admin \u2014 visualizzazione completa senza filtri ruolo"}),k&&!F&&(0,e.jsx)("div",{style:{padding:"6px 12px",fontSize:11,color:"#6b7280"},children:"Rilevamento ruolo utente\u2026"}),Y&&!G&&(0,e.jsx)("div",{className:"tabBar",children:X.map((t,i)=>(0,e.jsx)("button",{type:"button",className:"tabBtn "+(i===K?"active":""),onClick:()=>{const e=X[K];e&&(e.dsIndices.forEach(e=>{var t;const i=String((null===(t=L[e])||void 0===t?void 0:t.dataSourceId)||""),r=ie.current[i];(null==r?void 0:r.ds)&&h(r.ds)}),b(),te(t=>{const i=Object.assign({},t);return e.dsIndices.forEach(e=>{var t;delete i[String((null===(t=L[e])||void 0===t?void 0:t.dataSourceId)||"")]}),i})),Q(i)},title:t.label,children:t.label},t.label))}),(0,e.jsx)("div",{className:"viewport",children:(0,e.jsxs)("div",{className:"content",children:[Ue&&(0,e.jsx)(i.Loading,{}),!Ue&&0===Me.length&&(0,e.jsx)("div",{className:"empty",children:g(j.emptyMessage||"Nessun record trovato.")}),Me.length>0&&(0,e.jsxs)(e.Fragment,{children:[!1!==j.showHeader&&(0,e.jsxs)("div",{className:"headerWrap",children:[(0,e.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:6},children:ke&&(0,e.jsx)(i.Button,{size:"sm",type:"tertiary",className:"resetBtn",onClick:()=>se(le),title:"Ripristina ordinamento di default","aria-label":"Reset ordinamento",children:"Reset"})}),(0,e.jsx)("div",{className:"gridHeader",children:Oe.map((t,i)=>(0,e.jsx)(dt,{first:0===i,label:t.label,field:t.field},t.id))})]}),(0,e.jsx)("div",{className:"list",children:Me.map((i,r)=>{var n,o,l;const a=(null===(n=i.getData)||void 0===n?void 0:n.call(i))||{},s=Number(a.OBJECTID),f=String(null!==(l=null===(o=i.getId)||void 0===o?void 0:o.call(i))&&void 0!==l?l:s),p=Fe.get(i)||"",v=String(me||"").toLowerCase(),S="objectid"===v||"oid"===v||"object_id"===v?function(e){var t,i,r,n,o;const l=(null===(t=null==e?void 0:e.getData)||void 0===t?void 0:t.call(e))||{},a=null!==(n=null!==(r=null!==(i=null==l?void 0:l.OBJECTID)&&void 0!==i?i:null==l?void 0:l.ObjectId)&&void 0!==r?r:null==l?void 0:l.objectid)&&void 0!==n?n:null==l?void 0:l.objectId;let s="TR";const d=null==l?void 0:l.origine_pratica;if(2===d||"2"===d)s="TI";else if(1===d||"1"===d)s="TR";else{const t=String((null===(o=null==e?void 0:e.dataSource)||void 0===o?void 0:o.id)||"").toLowerCase();(t.includes("gii_pratiche")||t.includes("schema")||t.includes("ti"))&&(s="TI")}return null!=a?`${s}-${a}`:`${s}-?`}(i):g(a[me]),_=(m(a[he]),g(a[be]),je(a)),x=g(_.label),D=_.statoForChip,y=Ee(a),I=y?m(y):"\u2014",T=ze(a,_.ruolo),R=ee[p]===f,C=r%2==0;return(0,e.jsx)("div",{className:`rowCard ${C?"even":"odd"} ${R?"selected":""}`,onClick:()=>{var e,r,n,o;if(R)te({}),Object.keys(ie.current).forEach(e=>{const t=ie.current[e];(null==t?void 0:t.ds)&&h(t.ds)}),L.forEach(e=>{var i,r,n;const o=String((null==e?void 0:e.dataSourceId)||"");try{const e=t.DataSourceManager.getInstance().getDataSource(o);e&&h(e);const l=(null===(i=null==e?void 0:e.parentDataSource)||void 0===i?void 0:i.id)||(null===(n=null===(r=null==e?void 0:e.getMainDataSource)||void 0===r?void 0:r.call(e))||void 0===n?void 0:n.id);if(l){const e=t.DataSourceManager.getInstance().getDataSource(l);e&&h(e)}}catch(e){}}),b();else{Object.keys(ie.current).forEach(e=>{const t=ie.current[e];(null==t?void 0:t.ds)&&h(t.ds)}),b(),te({[p]:f});const l=ie.current[p];(null==l?void 0:l.ds)&&function(e,t,i){var r,n,o;try{null===(r=e.selectRecordsByIds)||void 0===r||r.call(e,[i])}catch(e){}try{null===(n=e.selectRecordById)||void 0===n||n.call(e,i)}catch(e){}try{null===(o=e.setSelectedRecords)||void 0===o||o.call(e,[t])}catch(e){}}(l.ds,i,f);try{const t=Number(null!==(o=null===(e=i.getData)||void 0===e?void 0:e.call(i)[(null===(n=null===(r=null==l?void 0:l.ds)||void 0===r?void 0:r.getIdField)||void 0===n?void 0:n.call(r))||"OBJECTID"])&&void 0!==o?o:f);sessionStorage.setItem("GII_SELECTED_OID",String(t)),window.dispatchEvent(new CustomEvent("gii-selection-changed"))}catch(e){}ue&&ue.dsIndices.forEach(e=>{var r,n,o,l,a,s,d;const u=String((null===(r=L[e])||void 0===r?void 0:r.dataSourceId)||"");if(u===p)return;const c=ie.current[u];if(null==c?void 0:c.ds){try{null===(o=(n=c.ds).setSelectedRecords)||void 0===o||o.call(n,[i])}catch(e){}try{null===(a=(l=c.ds).selectRecordsByIds)||void 0===a||a.call(l,[f])}catch(e){}}try{const e=t.DataSourceManager.getInstance().getDataSource(u),r=(null==e?void 0:e.parentDataSource)||(null===(s=null==e?void 0:e.getMainDataSource)||void 0===s?void 0:s.call(e));if(r)try{null===(d=r.setSelectedRecords)||void 0===d||d.call(r,[i])}catch(e){}}catch(e){}})}},children:Oe.map((t,i)=>{const r=t.field;if(r===d)return(0,e.jsx)("div",{className:0===i?"cell first":"cell",title:x,children:(0,e.jsx)("span",{className:"chip",style:(n=Number.isFinite(Number(D))?Number(D):null,n===xe?{background:g(j.statoBgDaPrendere||"#fff7e6"),color:g(j.statoTextDaPrendere||"#7a4b00"),borderColor:g(j.statoBorderDaPrendere||"#ffd18a")}:n===De?{background:g(j.statoBgPresa||"#eaf7ef"),color:g(j.statoTextPresa||"#1f6b3a"),borderColor:g(j.statoBorderPresa||"#9ad2ae")}:n===ye?{background:g(j.statoBgIntegrazione||"#fffbeb"),color:g(j.statoTextIntegrazione||"#92400e"),borderColor:g(j.statoBorderIntegrazione||"#fbbf24")}:n===Ie?{background:g(j.statoBgApprovata||"#dcfce7"),color:g(j.statoTextApprovata||"#14532d"),borderColor:g(j.statoBorderApprovata||"#4ade80")}:n===Te?{background:g(j.statoBgRespinta||"#fee2e2"),color:g(j.statoTextRespinta||"#7f1d1d"),borderColor:g(j.statoBorderRespinta||"#f87171")}:{background:g(j.statoBgAltro||"#f2f2f2"),color:g(j.statoTextAltro||"#333333"),borderColor:g(j.statoBorderAltro||"#d0d0d0")}),children:x})},t.id);var n;if(r===u)return(0,e.jsx)("div",{className:0===i?"cell first":"cell",title:I,children:I},t.id);if(r===c)return(0,e.jsx)("div",{className:0===i?"cell first":"cell",title:T,children:T},t.id);const o=r.toLowerCase();if("objectid"===o||"oid"===o||"object_id"===o)return(0,e.jsx)("div",{className:0===i?"cell first":"cell",title:S,children:S},t.id);if(o.startsWith("data_")||o.startsWith("dt_")){const n=m(a[r]);return(0,e.jsx)("div",{className:0===i?"cell first":"cell",title:n,children:n},t.id)}const l=g(a[r]);return(0,e.jsx)("div",{className:0===i?"cell first":"cell",title:l,children:l},t.id)})},`${p}_${f}`)})})]})]})})]})})]})}function N(e){o.p=e}})(),l})())}}});